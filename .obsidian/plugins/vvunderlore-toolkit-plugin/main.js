/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var rn=Object.create;var Ze=Object.defineProperty;var on=Object.getOwnPropertyDescriptor;var an=Object.getOwnPropertyNames;var ln=Object.getPrototypeOf,cn=Object.prototype.hasOwnProperty;var Et=(e,n)=>{for(var t in n)Ze(e,t,{get:n[t],enumerable:!0})},ms=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of an(n))!cn.call(e,i)&&i!==t&&Ze(e,i,{get:()=>n[i],enumerable:!(r=on(n,i))||r.enumerable});return e};var pn=(e,n,t)=>(t=e!=null?rn(ln(e)):{},ms(n||!e||!e.__esModule?Ze(t,"default",{value:e,enumerable:!0}):t,e)),un=e=>ms(Ze({},"__esModule",{value:!0}),e);var Ei={};Et(Ei,{InstallingModal:()=>ut,default:()=>ft});module.exports=un(Ei);var U=require("obsidian");var G=require("obsidian");var Fe=require("obsidian");var ve=[{id:"none",label:"None",repo:"",parser:"",sourceUrl:""},{id:"5e-2014",label:"D&D 5e (2014)",repo:"5etools-mirror-3/5etools-2014-src",parser:"5e-2014",sourceUrl:"https://raw.githubusercontent.com/5etools-mirror-3/5etools-2014-src/main/data",categories:[""]},{id:"5e-2025",label:"D&D 5e (2025)",repo:"5etools-mirror-3/5etools-src",parser:"5e-2025",sourceUrl:"https://raw.githubusercontent.com/5etools-mirror-3/5etools-src/main/data"}];var _t={};Et(_t,{importEditionData:()=>Un});var me=require("obsidian");var fn={PHB:"Player's Handbook",MM:"Monster Manual",DMG:"Dungeon Master's Guide",CoS:"Curse of Strahd",OotA:"Out of the Abyss",PotA:"Princes of the Apocalypse",HotDQ:"Hoard of the Dragon Queen",RoT:"Rise of Tiamat",SKT:"Storm King's Thunder",TftYP:"Tales from the Yawning Portal",ToA:"Tomb of Annihilation",XGE:"Xanathar's Guide to Everything",VGM:"Volo's Guide to Monsters",TCE:"Tasha's Cauldron of Everything",EGW:"Eberron: Rising from the Last War",ERLW:"Explorer's Guide to Wildemount",MTF:"Monsters of the Multiverse",VRGR:"Van Richten's Guide to Ravenloft",AAG:"Astral Adventurer\u2019s Guide",AI:"Acquisitions Incorporated",AitFRAVFT:"Adventures in the Forgotten Realms: A Visual Field Test",BMT:"Big Monster Tome",DoDk:"Dragon of Darkkeep",FTD:"Fizban\u2019s Treasury of Dragons",GGR:"Guildmaster\u2019s Guide to Ravnica",GHLoE:"Ghosts of the Horizon: Light Over Elensaria",IDRotF:"Icewind Dale: Rime of the Frostmaiden",LLK:"Lost Laboratory of Kwalish",SatO:"Sapphire of Truth",SCC:"Strixhaven: Curriculum of Chaos",TDCSR:"The Dungeon Coach\u2019s Rulebook",JttRC:"Journeys through the Radiant Citadel","AitFR-AVT":"Adventures in the Forgotten Realms: A Verdant Tomb","AitFR-FCD":"Adventures in the Forgotten Realms: From Cyan Depths",RMR:"Dungeons and Dragons: Rick and Morty",SCAG:"Sword Coast Adventurer's Guide",EEPC:"Elemental Evil Player's Companion",MOT:"Mythic Odysseys of Theros",WBtW:"The Wild Beyond the Witchlight",BGDIA:"Baldur's Gate: Descent Into Avernus",ToFW:"Turn of Fortune's Wheel",CoA:"Chains of Asmodeus",CRCotN:"Critical Role: Call of the Netherdeep",ToD:"Tyranny of Dragons",MPMM:"Mordenkainen Presents: Monsters of the Multiverse",LoX:"Light of Xaryxis",QftIS:"Quests from the Infinite Staircase",WDH:"Waterdeep: Dragon Heist",WDMM:"Waterdeep: Dungeon of the Mad Mage",PaBTSO:"Phandelver and Below: The Shattered Obelisk",CM:"Candlekeep Mysteries",GoS:"Ghosts of Saltmarsh",DSotDQ:"Dragonlance: Shadow of the Dragon Queen",KftGV:"Keys from the Golden Vault",SDW:"Essentials Kit: Sleeping Dragon's Wake",DoSI:"Dragons of Stormwreck Isle",GotSF:"Giants of the Star Forge",DIP:"Essentials Kit: Dragon of Icespire Peak",SLW:"Essentials Kit: Storm Lord's Wrath",IMR:"Infernal Machine Rebuild",VEoR:"Vecna: Eve of Ruin",PSI:"Plane Shift: Innistrad",AATM:"Adventure Atlas: The Mortuary",PSZ:"Plane Shift: Zendikar",DC:"Essentials Kit: Divine Contention",LMoP:"Lost Mine of Phandelver",RMBRE:"The Lost Dungeon of Rickedness: Big Rick Energy",HftT:"Hunt for the Thessalhydra",PSX:"Plane Shift: Ixalan",HFStCM:"Heroes' Feast: Saving the Childrens Menu",SjA:"Spelljammer Academy",LK:"Lightning Keep",RtG:"Return to the Glory",TTP:"The Tortle Package",LR:"Locathah Rising",PSA:"Plane Shift: Amonkhet",OGA:"One Grung Above","NRH-TLT":"Nerds Restoring Harmony: The Lost Tomb","NRH-AT":"Nerds Restoring Harmony: Adventure Together",BGG:"Bigby Presents: Glory of the Giants",RoTOS:"The Rise of Tiamat Online Supplement",XMtS:"X Marks the Spot","HAT-LMI":"Honor Among Theives: Legendary Magic Items",DitLCoT:"Descent into the Lost Caverns of Tsojcanth","AitFR-DN":"Adventures in the Forgotten Realms: Deepest Night","AitFR-THP":"Adventures in the Forgotten Realms: The Hidden Pages",BAM:"Boo's Astral Menagerie",AZfyT:"A Zib for Your Thougts",MCV2DC:"Monstrous Compendium Volume 2: Dragonlance Creatures",PSK:"Plane Shift: Kaladesh",PSD:"Plane Shift: Dominaria",AWM:"Adventure with Muk",UATheMysticClass:"Unearthed Arcana: The Mystic Class",ALCurseOfStrahd:"Adventurers League: Curse of Strahd",ALElementalEvil:"Adventurers League: Elemental Evil",ALRageOfDemons:"Adventurers League: Rage of Demons"};function Ie(e,n){let t=fn[e]??e;return e==="PHB"&&(n?.includes("2014")?t+=" (2014)":n?.includes("2025")&&(t+=" (2025)")),t}function O(e){let n;return Array.isArray(e)?n=e.join(" "):typeof e=="string"?n=e:n=String(e??""),n.replace(/\{@(spell|item|creature|race) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${bt(i)}]]`).replace(/\{@(condition|status|action|skill) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${ys(r)}s#${i}|${bt(i)}]]`).replace(/\{@classFeature ([^|}]+)\|([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${i}#${r}]]`).replace(/\{@(book|filter) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>i).replace(/\{@note ([^}]+)\}/g,(t,r)=>`*${r}*`).replace(/\{@(damage|dice|dc|hit|sense) ([^}]+)\}/g,(t,r,i)=>i).replace(/\{@chance ([^|}]+)(?:\|[^}]+)?\}/g,(t,r)=>`${r}%`).replace(/\{@quickref ([^|}]+)(?:\|[^|]*\|[^}]*)?\}/g,(t,r)=>["difficult terrain","total cover","half cover","three-quarters cover","heavily obscured","lightly obscured"].includes(r.toLowerCase())?`[[Rules#${bt(r)}]]`:r).replace(/\{\@5etools\s+([^|}]+)\|[^}]+\}/g,"$1").replace(/\{@recharge\s*([^}]+)\}/g,(t,r)=>`(recharge: ${r.trim()})`).replace(/\{@(scaledice|scaledamage)[^}]*\|([^|}]+)\}/g,(t,r,i)=>i).replace(/\{@d20[^}]*\}/g,"").replace(/\{@[^}]+\}/g,"")}function ys(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function bt(e){return e.split(" ").map(ys).join(" ")}function Ce(e){if(e.type!=="table"||!Array.isArray(e.rows))return"";let n=e.caption?`##### ${e.caption}
`:"",t=(e.colLabels??[]).map(s=>O(s.trim())),r=`| ${t.join(" | ")} |`,i=`| ${t.map(()=>":--").join(" | ")} |`,o=e.rows.map(s=>`| ${s.map(a=>typeof a=="string"?O(a):typeof a=="object"?a.roll?.exact!==void 0?`${a.roll.exact}`:a.roll?.min!==void 0&&a.roll?.max!==void 0?`${a.roll.min}\u2013${a.roll.max}`:O(JSON.stringify(a)):O(String(a))).join(" | ")} |`);return`${n}${r}
${i}
${o.join(`
`)}`}function te(e){if(typeof e=="string"){let n=e.trim();return!n||n==="}"?"":O(n)}if(e.type==="entries"&&Array.isArray(e.entries)){let n=e.entries.map(te).filter(t=>t.trim().length>0).join(`

`);return e.name?`##### ${e.name}
${n}`:n}if(e.type==="list"&&Array.isArray(e.items))return e.items.map(n=>`- ${O(typeof n=="string"?n:JSON.stringify(n))}`).join(`
`);if(e.type==="table"&&Array.isArray(e.rows))return Ce(e);if(e.type==="quote"&&Array.isArray(e.entries)){let n=e.entries.map(te).join(" ").trim(),t=e.by?` \u2014 ${e.by}`:"";return`*"${n}${t}"*`}if(e.type==="inset"&&Array.isArray(e.entries))return`> ${e.entries.map(te).join(`
`).trim().replace(/\n/g,`
> `)}`;if(e.type==="refClassFeature"&&typeof e.classFeature=="string"){let[n]=e.classFeature.split("|");return`[[#${n.replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").toLowerCase()}]]`}return""}var hn=[],dn={T:"Tiny",S:"Small",M:"Medium",L:"Large",H:"Huge",G:"Gargantuan"},gn={L:"Lawful",N:"Neutral",C:"Chaotic",G:"Good",E:"Evil",U:"Unaligned"};function wt(e){let n=String(e||"");return n.charAt(0).toUpperCase()+n.slice(1)}function mn(e){return dn[e]||e}function Ct(e){return e.trim().split(/\s+/).map(n=>gn[n]||n).join(" ")}var yn=["Abjurer","Acolyte","Apprentice Wizard","Archdruid","Archer","Archmage","Assassin","Bandit","Bandit Captain","Bard","Berserker","Blackguard","Champion","Commoner","Conjurer","Cult Fanatic","Cultist","Diviner","Druid (NPC)","Druid NPC","Enchanter","Evoker","Gladiator","Guard","Illusionist","Knight","Kraken Priest","Mage","Martial Arts Adept","Master Thief","Necromancer","Noble","Priest","Scout","Spy","Swashbuckler","Thug","Transmuter","Tribal Warrior","Veteran","War Priest","Warlock of the Archfey","Warlock of the Fiend","Warlock of the Great Old One","Warlord"],An=new Set(yn.map(e=>As(e)));function As(e){return e.replace(/\s+/g," ").trim().toLowerCase()}function Sn(e){let n=e.type,t=e.name,r=typeof n=="string"?n.toLowerCase():n?.type?.toLowerCase()||String(n).toLowerCase(),i=As(t);return e.isNpc||e.isNamedCreature?"Story NPCs":r==="beast"?"Beasts":r==="humanoid"&&An.has(i)?"Non-Beasts":"Monsters"}function En(e,n,t,r,i,o){return["| STR | DEX | CON | INT | WIS | CHA |","| --- | --- | --- | --- | --- | --- |",`| ${e} | ${n} | ${t} | ${r} | ${i} | ${o} |`].join(`
`)}function et(e){let n=e.name,t=[];Array.isArray(e.entries)?t=e.entries:typeof e.entries=="string"?t=[e.entries]:Array.isArray(e.desc)?t=e.desc:typeof e.desc=="string"&&(t=[e.desc]);let r=t.join(" "),i=O(r);return`***${n}.*** ${i}`}function Ss(e,n){if(!e.monster)return[];e._editionId=n;let t=e.monster.filter(s=>{let l=Array.isArray(s.ac)?s.ac[0]?.ac??s.ac[0]:typeof s.ac=="object"?s.ac?.ac??null:s.ac,a=typeof s.hp=="object"?s.hp?.average??s.hp?.hp??null:s.hp;return l!=null&&a!=null&&!isNaN(Number(l))&&!isNaN(Number(a))}),r=new Set(e.monster.map(s=>s.name)),i=new Set(t.map(s=>s.name)),o=[...r].filter(s=>!i.has(s));return t.map(s=>{let l=s.name,a=l.replace(/\//g,"-"),c=s.size||"M",p=Array.isArray(s.alignment)?s.alignment.join(" "):s.alignment||"N",u="Unknown";if(typeof s.type=="string")u=wt(s.type);else if(s.type?.type){let E=wt(s.type.type),D=s.type.tags?.length?` (${s.type.tags.map(wt).join(", ")})`:"";u=`${E}${D}`}s._parsedType=u;let f=Array.isArray(s.ac)?s.ac[0].ac:s.ac,h=s.hp?.average??s.hp,F=s.cr;if(!f&&!h)return hn.push(s.name),null;let M=Array.isArray(s.ability)?s.ability:[s.str,s.dex,s.con,s.int,s.wis,s.cha],[d=10,A=10,k=10,_=10,B=10,H=10]=M,K=[];if(typeof s.speed=="object"){for(let[E,D]of Object.entries(s.speed))if(E!=="canHover")if(D&&typeof D=="object"&&"number"in D){let L=D.number,b=D.condition?` ${D.condition}`:"";K.push(`${E} ${L} ft.${b}`)}else K.push(`${E} ${D} ft.`)}else K.push(`${s.speed} ft.`);let W=K.join(", "),C=Ie(s.source,n);C=C.replace(/:/g," -");let g=Sn(s),w=pe(s,vt),P=ue(w,vt),I=w[re.SAVING_THROWS]||[],N=w[re.SKILLS]||[],j=w[re.SENSES]||[],y=w[re.LANGUAGES]||[],S=`# ${l}

${mn(c)} ${u}, ${Ct(p)}

**Armor Class**: ${f}
**Hit Points**: ${h}
**Speed**: ${W}
`+(I.length?`**Saving Throws**: ${I.join(", ")}
`:"")+(N.length?`**Skills**: ${N.join(", ")}
`:"")+(j.length?`**Senses**: ${j.join(", ")}
`:"")+(y.length?`**Languages**: ${y.join(", ")}
`:"")+`**Challenge**: ${F}

`+En(d,A,k,_,B,H);s.trait&&(S+=`

### Traits
${s.trait.map(et).join(`

`)}`),s.action&&(S+=`

### Actions
${s.action.map(et).join(`

`)}`),s.reaction&&(S+=`

### Reactions
${s.reaction.map(et).join(`

`)}`),s.legendary&&(S+=`

### Legendary Actions
${s.legendary.map(et).join(`

`)}`);let m=`---
${P}
---

${S}`;return{path:`${g}/${a}.md`,content:m}})}function tt(e){if(typeof e!="string"||e.length===0)return"";let n=e.trim();return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}var Es={P:"Piercing",B:"Bludgeoning",S:"Slashing",N:"Necrotic",R:"Radiant",F:"Fire",C:"Cold",L:"Lightning",T:"Thunder",A:"Acid",H:"Healing",U:"Force",V:"Psychic"},$t={A:"Ammunition",F:"Finesse",H:"Heavy",L:"Light",R:"Reload",S:"Special","2H":"Two-Handed",T:"Thrown",V:"Versatile"},_e={$C:"Currency",$G:"Gem",A:"Ammunition","AIR|DMG":"Vehicle (air)","AF|DMG":"Future Ammo",AT:"Artisan Tools",EXP:"Explosive",FD:"Food and Drink",G:"Gear",GS:"Game",HA:"Heavy Armor","IDG|TDCSR":"Illicit Drug",INS:"Instrument",LA:"Light Armor",M:"Weapon",MA:"Medium Armor",MNT:"Mounts and Vehicles",ODH:"Miscellaneous",P:"Consumable",R:"Ranged Weapon",RD:"Rod",RG:"Ring",S:"Shield",SC:"Scroll",SCF:"Spell Casting Focus",SHP:"Ship",T:"Tool",TAH:"Mounts and Vehicles",TG:"Trade Goods",VEH:"Mounts and Vehicles",WD:"Wand"},bn={A:"Weapons and Armor/Ammunition",M:"Weapons and Armor/Weapons",R:"Weapons and Armor/Ranged Weapons",S:"Weapons and Armor/Shields",LA:"Weapons and Armor/Armor/Light Armor",MA:"Weapons and Armor/Armor/Medium Armor",HA:"Weapons and Armor/Armor/Heavy Armor",EXP:"Weapons and Armor/Weapons/Explosives",AF:"Weapons and Armor/Ammunition/Future Ammo",RD:"Magical Items/Rods",RG:"Magical Items/Rings",SC:"Magical Items/Scrolls",SCF:"Magical Items/Spell Casting Focus",WD:"Magical Items/Wands",$G:"Valuables/Gems",C:"Valuables/Currency",TG:"Valuables/Trade Goods",AT:"Artisan Goods/Tools",T:"Artisan Goods/Tools",INS:"Artisan Goods/Instruments",GS:"Artisan Goods/Games",G:"Gear",MNT:"Gear/Mounts and Vehicles",TAH:"Gear/Mounts and Vehicles",VEH:"Gear/Mounts and Vehicles",AIR:"Gear/Mounts and Vehicles/Air",P:"Consumables",FD:"Consumables/Food and Drink",IDG:"Gear/Illicit Drugs",ODH:"Gear/Miscellaneous"};function bs(e,n){let t=[];if(Array.isArray(e.baseitem)&&t.push(...e.baseitem),Array.isArray(e.item)&&t.push(...e.item),Array.isArray(e.object)&&t.push(...e.object),Array.isArray(e.vehicle)&&t.push(...e.vehicle),!t.length)return[];let r=new Set(Array.isArray(e.baseitem)?e.baseitem.map(o=>o.name):[]),i=[];for(let o of t){let s=o.name,l=s.replace(/[\/\\:]/g,"-"),a=(o.type||"").split("|")[0].split("|")[0].replace(/^\$/,""),c=bn[a]??"Miscellaneous";if(o.bonusWeapon)c=`${c}/Variants`;else if(!!o.wondrous||!!o.reqAttune||!!o.req_attune||String(o.rarity).toLowerCase().includes("magic")){let[,...k]=c.split("/");c=["Magical Items",...k].join("/")}(c.startsWith("Weapons and Armor/Weapons")||c.startsWith("Weapons and Armor/Ranged Weapons"))&&o.weaponCategory&&(c=`${c}/${tt(o.weaponCategory)}`),e._editionId=n;let p=pe(o,Tt);a==="M"&&o.weaponCategory?p.type=`${tt(o.weaponCategory)} Weapon`:_e[a]&&(p.type=_e[a]),Array.isArray(p.damageTypes)&&(p.damageTypes=p.damageTypes.map(A=>Es[A]||A));let u=ue(p,Tt);if(Array.isArray(o.packContents)){u+=`
packContents:`;for(let A of o.packContents)u+=`
  - item: "${A.item}"
    quantity: ${A.quantity}`}let f=`---
${u}
---`,h=[];h.push(`# ${s}`),h.push("");let F=o.weapon?`${tt(o.weaponCategory)} Weapon`:o.armor?c.split("/").pop()||"Armor":"";if(F&&h.push(`### *${F}*`),o.weapon){h.push(`**Category**: ${tt(o.weaponCategory)}`),h.push(`**Damage**: ${o.dmg1??""}${o.dmg2?` / ${o.dmg2}`:""}`);let A=(Array.isArray(o.dmgType)?o.dmgType:[o.dmgType]).filter(k=>!!k).map(k=>Es[k]||k);if(h.push(`**Damage Type**: ${A.join(", ")}`),h.push(`**Range**: ${o.range??"\u2014"}`),h.push(`**Reload**: ${o.reload??"\u2014"}`),o.ammoType&&h.push(`**Ammo Type**: ${o.ammoType}`),Array.isArray(o.property)&&o.property.length){let k=o.property.map(_=>$t[_]||_);h.push(`**Properties**: ${k.join(", ")}`)}}o.armor&&(h.push(`**Armor Class**: ${o.ac}`),o.stealth&&h.push("**Stealth Disadvantage**: true"),h.push(""));let M=o.entries??o.desc;if(M){for(let A of Array.isArray(M)?M:[M])if(typeof A=="string"){for(let k of O(A).split(`
`))h.push(k);h.push("")}else if(A&&typeof A=="object"){h[h.length-1]===""&&h.pop(),h.push(`#### ${A.name}`);let k=Array.isArray(A.entries)?A.entries:[];for(let _ of k)for(let B of O(_).split(`
`))h.push(B);h.push("")}}let d=h.join(`
`);i.push({path:`Items/${c}/${l}.md`,content:`${f}

${d}`})}return i.sort((o,s)=>o.path.localeCompare(s.path))}function se(e){return typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1)}var wn={str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"},He={T:"Tiny",S:"Small",M:"Medium",L:"Large",H:"Huge",G:"Gargantuan"},re={ABILITY_BONUSES:"ability_bonuses",AC:"AC",ALIGNMENT:"Alignment",AMMO_TYPE:"Ammo Type",ARMOR_PROFICIENCIES:"armor-prof",ATTACK_TYPE:"attack_type",ATTUNEMENT:"Attunement",ATTUNE_REQ:"Attune_Req",CASTING_TIME:"casting_time",CHARISMA:"charisma",CHA_MOD:"cha_mod",CONCENTRATION:"concentration",CONDITION_IMM:"cond_immunity",CONSTITUTION:"constitution",CON_MOD:"con_mod",COST:"cost",COMPONENTS:"Components",CHALLENGE_RATING:"CR",DAMAGE_TYPE:"damage_type",DAMAGE_TYPES:"damageTypes",DAMAGE:"damage",DAMAGE_RES:"dmg_resistance",DAMAGE_IMM:"dmg_immunity",DEXTERITY:"dexterity",DEX_MOD:"dex_mod",DURATION:"duration",RULESET:"ruleset",HP:"HP",INTELLIGENCE:"intelligence",INT_MOD:"int_mod",LANGUAGES:"languages",LEVEL:"level",MAGICAL:"magical",MATERIAL:"material",NAME:"name",PROPERTIES:"properties",RANGE:"range",RARITY:"rarity",RELOAD:"reload",RITUAL:"ritual",SAVE:"save",SAVING_THROWS:"saving_throws",SCHOOL:"school",SENSES:"senses",SIZE:"size",SKILLS:"skills",SKILL_CHOICE_LIST:"skill_choice_list",SOMATIC:"somatic",SOURCE:"source",SPECIES:"species",SPEED:"speed",SPELL_CAST_MOD:"Spell Cast Mod",SPELL_RANGE:"Range",STEALTH_DISADVANTAGE:"stealthDisadvantage",STRENGTH:"strength",STR_MOD:"str_mod",SUBRACES:"subraces",TOOL_PROFICIENCIES:"tool-prof",TOOL_CHOICE_LIST:"tool_choice_list",TRAITS:"traits",TYPE:"type",VARIANT:"Variant",VERBAL:"verbal",WEAPON_PROFICIENCIES:"weapon-prof",WEIGHT:"weight",WISDOM:"wisdom",WIS_MOD:"wis_mod"},vn=e=>Array.isArray(e?.armor)?e.armor.map(se):Array.isArray(e)?e.map(se):[];function Ft(e){let n=Array.isArray(e?.weapons)?e.weapons:Array.isArray(e)?e:[],t=new Set;function r(i){if(Array.isArray(i)){i.forEach(r);return}if(typeof i=="string"){let o=i.trim().toLowerCase();if(o==="simple")t.add("Simple Weapons");else if(o==="martial")t.add("Martial Weapons");else{let s=i.startsWith("{@")?O(i):se(i);t.add(s)}return}if(i&&typeof i=="object"&&i.proficiency){let o=se(i.proficiency);t.add(i.optional?`${o} (optional)`:o)}}return n.forEach(r),[...t]}var Cn=e=>Array.isArray(e)?e.map(n=>({str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"})[n]??n.toUpperCase()):typeof e=="object"&&e!==null?Object.keys(e).map(n=>n.toUpperCase()):[],st=e=>{if(e&&!Array.isArray(e)&&typeof e=="object"&&Object.values(e).every(t=>typeof t=="string"||typeof t=="number"))return Object.entries(e).map(([t,r])=>`${se(t)} ${r}`.trim());if(e&&!Array.isArray(e)&&typeof e=="object"){let t=e.skills??e.skillProf??e.skillProficiencies;return st(t)}if(!Array.isArray(e))return[];let n=new Set;for(let t of e){if(t&&typeof t=="object"&&typeof t.any=="number"){n.add(`Choose ${t.any}`);continue}if(t&&typeof t=="object"&&t.choose){let r=t.choose.count??1;n.add(`Choose ${r}`)}if(t&&typeof t=="object")for(let[r,i]of Object.entries(t))i===!0&&n.add(se(r));typeof t=="string"&&n.add(se(t))}return[...n]},kt=e=>{let n=Array.isArray(e)?e:Array.isArray(e?.toolProficiencies)?e.toolProficiencies:Array.isArray(e?.tools)?e.tools:[],t=new Set,r=!1;for(let i of n){if(typeof i=="string"){t.add(se(i));continue}if(i?.choose){let o=i.choose.count??1;r=!0,t.add(`Choose ${o}`)}for(let[o,s]of Object.entries(i))if(s===!0)t.add(se(o));else if(typeof s=="number"&&o.startsWith("any")){let a=o.replace(/^any/,"").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(se).join(" ");t.add(`Choose ${s} ${a}`)}}return[...t]},Oe=[{callSign:"NAME",jsonKey:"name"},{callSign:"SOURCE",jsonKey:["source"],conv:(e,n)=>{let t=new Set;(Array.isArray(e)?e:[e]).forEach(i=>t.add(Ie(i,n._editionId)));for(let i of n.otherSources??[])t.add(Ie(i.source,n._editionId));for(let i of n.reprintedAs??[]){let[,o]=i.split("|");t.add(Ie(o,n._editionId))}return[...t]}},{callSign:"ARMOR_PROFICIENCIES",jsonKey:["armorProficiencies","armorProfs","startingProficiencies"],conv:vn},{callSign:"WEAPON_PROFICIENCIES",jsonKey:["weaponProficiencies","weaponProfs","startingProficiencies"],conv:Ft},{callSign:"TOOL_PROFICIENCIES",jsonKey:["toolProficiencies","toolProfs","startingProficiencies"],conv:kt},{callSign:"TOOL_CHOICE_LIST",jsonKey:["toolProficiencies","toolProfs","startingProficiencies"],conv:e=>(Array.isArray(e)?e:Array.isArray(e?.toolProficiencies)?e.toolProficiencies:Array.isArray(e?.tools)?e.tools:[]).find(r=>r?.choose)?.choose?.from?.map(r=>se(r))??[]},{callSign:"SAVING_THROWS",jsonKey:["save","proficiency"],conv:Cn},{callSign:"SKILLS",jsonKey:["skill","skillProf","skillProficiencies","startingProficiencies"],conv:st},{callSign:"SKILL_CHOICE_LIST",jsonKey:["skill","skillProf","skillProficiencies","startingProficiencies"],conv:e=>{let t=(Array.isArray(e)?e:Array.isArray(e?.skillProficiencies)?e.skillProficiencies:Array.isArray(e?.skills)?e.skills:Array.isArray(e?.skillProf)?e.skillProf:[]).find(r=>r?.choose||typeof r.any=="number");return t?t.choose&&Array.isArray(t.choose.from)?t.choose.from.map(se):typeof t.any=="number"?It:[]:[]}},{callSign:"SPELL_CAST_MOD",jsonKey:"spellcastingAbility",conv:e=>{let n=String(e).toLowerCase();return wn[n]||n.toUpperCase()}},{callSign:"RULESET",jsonKey:"name",conv:(e,n)=>"D&D 5e (2025)"},{callSign:"LEVEL",jsonKey:"level"},{callSign:"SCHOOL",jsonKey:"school",conv:e=>Rt[e]??e},{callSign:"CASTING_TIME",jsonKey:"time",conv:jt},{callSign:"SPELL_RANGE",jsonKey:"range",conv:Ot},{callSign:"DURATION",jsonKey:"duration",conv:Dt},{callSign:"VERBAL",jsonKey:"components",conv:e=>!!e.v},{callSign:"SOMATIC",jsonKey:"components",conv:e=>!!e.s},{callSign:"MATERIAL",jsonKey:"components",conv:e=>!!e.m},{callSign:"COMPONENTS",jsonKey:"components",conv:e=>e.m?(Array.isArray(e.m)?e.m:[e.m]).map(t=>typeof t=="string"?t:t&&typeof t=="object"&&typeof t.text=="string"?t.text:null).filter(t=>t!==null):[]},{callSign:"ATTACK_TYPE",jsonKey:"attackType"},{callSign:"DAMAGE_TYPE",jsonKey:"damageInflict",conv:e=>Array.isArray(e)?e[0]:e},{callSign:"RITUAL",jsonKey:"ritual"},{callSign:"CONCENTRATION",jsonKey:"duration",conv:e=>Array.isArray(e)&&e.some(n=>n.concentration)},{callSign:"SAVE",jsonKey:"saveAttr"},{callSign:"SPECIES",jsonKey:"name"},{callSign:"SIZE",jsonKey:"size",conv:e=>Array.isArray(e)?e.map(n=>He[n]||n):He[e]||e},{callSign:"SPEED",jsonKey:"speed",conv:e=>typeof e=="number"?[`Walk ${e} ft.`]:!e||typeof e!="object"?[]:Object.entries(e).filter(([n])=>n!=="canHover").map(([n,t])=>{let r=typeof t=="object"&&t!==null&&"number"in t?t.number:t;return`${n==="walk"?"Walk":se(n)} ${r} ft.`})},{callSign:"LANGUAGES",jsonKey:["languages","languageProficiencies"],conv:e=>{if(!Array.isArray(e))return[];let n=[];for(let t of e)if(typeof t=="string")n.push(se(t));else if(typeof t=="object")for(let[r,i]of Object.entries(t))i&&n.push(se(r));return[...new Set(n)]}},{callSign:"SENSES",jsonKey:"senses",conv:e=>Array.isArray(e)?e.map(n=>n.replace(/^\d+\s*/,"").replace(/^./,t=>t.toUpperCase())):e&&typeof e=="object"?Object.entries(e).map(([n,t])=>`${n.charAt(0).toUpperCase()+n.slice(1)} ${t}`):[]},{callSign:"TRAITS",jsonKey:["classFeatures","entries"],conv:(e,n)=>{let t=Array.isArray(n.class)?n.class[0]:n,r=typeof t.name=="string"?t.name:"",i=new Set(["Ability Score Improvement","Archetype Feature","Subclass Feature"]),o=new Set;if(Array.isArray(n.classFeatures))return n.classFeatures.flatMap(a=>{if(a&&typeof a=="object"&&a.gainSubclassFeature)return[];let p=(typeof a=="string"?a:typeof a.classFeature=="string"?a.classFeature:"").split("|")[0].trim();if(!p||i.has(p)||o.has(p))return[];o.add(p);let u=p.replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim().replace(/\b\w/g,f=>f.toUpperCase());return`[[${r}#${u}|${p}]]`});let s=Array.isArray(e)?e:[],l=s.filter(a=>a?.data?.isFeature&&typeof a.name=="string").map(a=>a.name.replace(/^Feature:\s*/,"").trim());return l.length?l:s.filter(a=>a&&typeof a.name=="string").map(a=>a.name.replace(/^Feature:\s*/,"").trim())}},{callSign:"AC",jsonKey:"ac",conv:e=>Array.isArray(e)?e[0].ac:e},{callSign:"HP",jsonKey:"hp",conv:e=>e?.average??e},{callSign:"CHALLENGE_RATING",jsonKey:"cr"},{callSign:"STRENGTH",jsonKey:"ability",conv:e=>Array.isArray(e)?e[0]:e?.str??0},{callSign:"DEXTERITY",jsonKey:"ability",conv:e=>Array.isArray(e)?e[1]:e?.dex??0},{callSign:"CONSTITUTION",jsonKey:"ability",conv:e=>Array.isArray(e)?e[2]:e?.con??0},{callSign:"INTELLIGENCE",jsonKey:"ability",conv:e=>Array.isArray(e)?e[3]:e?.int??0},{callSign:"WISDOM",jsonKey:"ability",conv:e=>Array.isArray(e)?e[4]:e?.wis??0},{callSign:"CHARISMA",jsonKey:"ability",conv:e=>Array.isArray(e)?e[5]:e?.cha??0},{callSign:"ALIGNMENT",jsonKey:"alignment",conv:e=>{let t=(Array.isArray(e)?e.join(" "):typeof e=="string"?e:String(e)).replace(/\bA\b/g,"Any").replace(/\bU\b/g,"Unaligned").replace(/\bN\b/g,"Neutral").replace(/\bL\b/g,"Lawful").replace(/\bC\b/g,"Chaotic").replace(/\bG\b/g,"Good").replace(/\bE\b/g,"Evil");return Ct(t)}},{callSign:"TYPE",jsonKey:"type",conv:e=>{if(typeof e=="string")return _e[e]??se(e);if(e&&typeof e=="object"){let n=String(e.type||"").toUpperCase();if(_e[n])return _e[n];let t=e.type?se(e.type):"Unknown",r=Array.isArray(e.tags)?e.tags.map(se):[];return r.length?`${t} (${r.join(", ")})`:t}}},{callSign:"TYPE",jsonKey:"_parsedType"},{callSign:"RARITY",jsonKey:"rarity",conv:e=>{let n=String(e||"").toLowerCase();return n&&n!=="none"?n[0].toUpperCase()+n.slice(1):void 0}},{callSign:"COST",jsonKey:"value",conv:e=>{let n=String(e).trim().toLowerCase(),t;return n.endsWith("cp")?(t=parseFloat(n),t>=100?`${Math.round(t/100*100)/100}gp`:`${t}cp`):n.endsWith("sp")?(t=parseFloat(n),t>=10?`${Math.round(t/10*100)/100}gp`:`${t}sp`):n.endsWith("gp")?(t=parseFloat(n),`${Math.round(t*100)/100}gp`):(t=parseFloat(n)||0,t>=100?`${Math.round(t/100*100)/100}gp`:`${t}cp`)}},{callSign:"WEIGHT",jsonKey:"weight"},{callSign:"MAGICAL",jsonKey:"wondrous",conv:(e,n)=>!!n.wondrous||!!n.reqAttune},{callSign:"VARIANT",jsonKey:"bonusWeapon",conv:e=>typeof e=="string"&&e.startsWith("+")},{callSign:"PROPERTIES",jsonKey:"property",conv:e=>Array.isArray(e)?e.map(n=>$t[n]||n):[]},{callSign:"DAMAGE",jsonKey:"dmg1",conv:(e,n)=>e?n.dmg2?`${e} / ${n.dmg2}`:`${e}`:void 0},{callSign:"DAMAGE_TYPES",jsonKey:"dmgType",conv:e=>e==null?[]:Array.isArray(e)?e:[e]},{callSign:"RANGE",jsonKey:"range"},{callSign:"RELOAD",jsonKey:"reload"},{callSign:"AMMO_TYPE",jsonKey:"ammoType"},{callSign:"STEALTH_DISADVANTAGE",jsonKey:"stealth"},{callSign:"ATTUNEMENT",jsonKey:["wondrous","reqAttune","req_attune","reqAttuneTags"],conv:(e,n)=>{let t=n,r=typeof t.reqAttune=="string"&&t.reqAttune.trim()!=="",i=Array.isArray(t.reqAttuneTags)&&t.reqAttuneTags.length>0;return r||i}},{callSign:"ATTUNE_REQ",jsonKey:"reqAttuneTags",conv:(e=[],n)=>{let t={A:"Any",U:"Unaligned",N:"Neutral",L:"Lawful",C:"Chaotic",G:"Good",E:"Evil"},r=[];for(let i of e)if(i.class&&Array.isArray(i.alignment)){let o=se(i.class);for(let s of i.alignment)r.push(`${t[s]||s} ${o}`)}else if(i.class)r.push(se(i.class));else if(Array.isArray(i.alignment))for(let o of i.alignment)r.push(t[o]||o);else if(i.background){let[o]=String(i.background).split("|");r.push(o.split(" ").map(se).join(" "))}else i.spellcasting&&r.push("Spellcaster");return Array.from(new Set(r))}},{callSign:"DAMAGE_RES",jsonKey:"resist",conv:e=>Array.isArray(e)?e.map(se):[]},{callSign:"RULESET",jsonKey:"_editionId"},{callSign:"STR_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].str??0:e.str??0;return n!==0?n:void 0}},{callSign:"DEX_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].dex??0:e.dex??0;return n!==0?n:void 0}},{callSign:"CON_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].con??0:e.con??0;return n!==0?n:void 0}},{callSign:"INT_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].int??0:e.int??0;return n!==0?n:void 0}},{callSign:"WIS_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].wis??0:e.wis??0;return n!==0?n:void 0}},{callSign:"CHA_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].cha??0:e.cha??0;return n!==0?n:void 0}}];function pe(e,n){let t={};for(let{callSign:r,jsonKey:i,conv:o}of n){let s=Array.isArray(i)?i:[i],l;for(let c of s)if(e[c]!=null){l=e[c];break}if(l==null)continue;let a=o?o(l,e):l;t[re[r]]=a}return t}function ue(e,n){let t={},r=Array.isArray(e[re.SKILL_CHOICE_LIST])&&e[re.SKILL_CHOICE_LIST].length>0,i=Array.isArray(e[re.TOOL_CHOICE_LIST])&&e[re.TOOL_CHOICE_LIST].length>0;for(let[s,l]of Object.entries(e))l!==void 0&&(s===re.COMPONENTS&&Array.isArray(l)&&l.length===0||(s===re.TOOL_CHOICE_LIST||s===re.SKILL_CHOICE_LIST)&&Array.isArray(l)&&l.length===0||(t[s]=l));let o;return n?(o=n.map(l=>re[l.callSign]).filter(l=>l in t),o.push(...Object.keys(t).filter(l=>!o.includes(l)))):o=Object.keys(t),o.map(s=>{let l=t[s];if(Array.isArray(l)){let a=l.map(c=>JSON.stringify(c)).join(", ");return`${s}: [${a}]`}return typeof l=="string"?`${s}: "${l}"`:`${s}: ${l}`}).join(`
`)}var It=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"];var Tn=["NAME","LEVEL","SCHOOL","CASTING_TIME","SPELL_RANGE","DURATION","VERBAL","SOMATIC","MATERIAL","COMPONENTS","CONCENTRATION","SOURCE","RULESET"],$n=["SPECIES","SIZE","SPEED","LANGUAGES","TRAITS","SKILLS","STR_MOD","DEX_MOD","CON_MOD","INT_MOD","WIS_MOD","CHA_MOD","SKILL_CHOICE_LIST","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","WEAPON_PROFICIENCIES","SENSES","DAMAGE_RES","SOURCE","RULESET"],Fn=["NAME","TYPE","RARITY","COST","WEIGHT","PROPERTIES","DAMAGE","DAMAGE_TYPES","RANGE","RELOAD","AMMO_TYPE","AC","STEALTH_DISADVANTAGE","MAGICAL","ATTUNEMENT","ATTUNE_REQ","SOURCE","RULESET"],kn=["NAME","SIZE","TYPE","ALIGNMENT","AC","HP","SPEED","STRENGTH","DEXTERITY","CONSTITUTION","INTELLIGENCE","WISDOM","CHARISMA","SAVING_THROWS","SKILLS","SENSES","LANGUAGES","CHALLENGE_RATING","SOURCE","RULESET"],In=["NAME","SPELL_CAST_MOD","ARMOR_PROFICIENCIES","WEAPON_PROFICIENCIES","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","SAVING_THROWS","SKILLS","SKILL_CHOICE_LIST","TRAITS","SOURCE","RULESET"],Pn=["NAME","SKILLS","SKILL_CHOICE_LIST","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","TRAITS","SOURCE","RULESET"],Mn=["SOURCE","RULESET"],Pt=Tn.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for SPELL_KEY ${e}`);return n}),We=$n.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for SPECIES_KEY ${e}`);return n}),Tt=Fn.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for ITEM_KEY ${e}`);return n}),vt=kn.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BESTIARY_KEY ${e}`);return n}),Mt=In.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for CLASS_KEY ${e}`);return n}),xt=Pn.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BACKGROUND_KEY ${e}`);return n}),Lt=Mn.map(e=>{let n=Oe.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BACKGROUND_KEY ${e}`);return n});var Rt={A:"Abjuration",C:"Conjuration",D:"Divination",E:"Enchantment",V:"Evocation",I:"Illusion",N:"Necromancy",T:"Transmutation"};function xn(e){return`${e}${e===1?"st":e===2?"nd":e===3?"rd":"th"}`}function Ot(e){if(!e)return"";if(typeof e=="string")return e;if(e.type==="special")return"Special";if(e.type==="point"&&e.distance){let n=e.distance;if(n.type==="touch")return"Touch";if(n.type==="self")return"Self";if(n.type==="sight")return"Sight";if(n.amount)return`${n.amount} ${n.type}`}return"Varies"}function jt(e){return Array.isArray(e)?e.map(n=>`${n.number} ${n.unit}`).join(", "):""}function Dt(e){return Array.isArray(e)?e.map(n=>n.type==="instant"?"Instantaneous":n.type==="timed"&&n.duration?`${n.duration.amount} ${n.duration.type}${n.concentration?" (concentration)":""}`:n.type==="permanent"?"Permanent":"Special").join(", "):""}function Ln(e){if(!e)return"";let n=[];if(e.v&&n.push("V"),e.s&&n.push("S"),e.m){let t=[];Array.isArray(e.m)?t=e.m.map(i=>typeof i=="string"?i:i&&typeof i.text=="string"?i.text:null).filter(i=>!!i):typeof e.m=="string"?t=[e.m]:e.m.text&&(t=[e.m.text]);let r=t.length>0?`M (${t.join(", ")})`:"M";n.push(r)}return n.join(", ")}function ws(e,n){return e.spell?(e._editionId=n,e.spell.map(t=>{let r=t.source?Array.isArray(t.source)?t.source:[t.source]:["unknown"],i=t.name,o=Rt[t.school]??t.school,s=t.level,l=Ot(t.range),a=jt(t.time),c=Dt(t.duration),p=r.map(C=>Ie(C,n)),u=t.attackType||"",f=t.damageInflict?.[0]||"Teleportation",h=t.ritual===!0,F=t.duration?.some(C=>C.concentration)??!1,M=pe(t,Pt),d=ue(M,Pt),A=i.replace(/\//g,"-"),k=`# ${i}`,B=`### *${s===0?`${o} Cantrip`:`${xn(s)}-level ${o} Spell`}*${F?" *(Concentration)*":""}`,H=[k,B,`**Casting Time:** ${a}`,`**Range:** ${l}`,`**Components:** ${Ln(t.components)}`,`**Duration:** ${c}`],K=[...(t.entries??[]).map(C=>te(C)),...(t.entriesHigherLevel??[]).map(C=>te(C))],W=["---",`**Source:** ${p.join(", ")}`];return{path:`${A}.md`,content:[`---
${d}
---`,H.join(`
`),"",K.join(`

`),"",W.join(`
`)].join(`
`)}})):[]}function vs(e){return e.replace(/;/g,":").replace(/[\/:"]/g,":").trim()}var Rn=["Age","Size","Languages","Creature Type","Speed"];function Cs(e,n){if(!Array.isArray(e.race))return[];e._editionId=n;let t=e.race.filter(s=>!("reprintedAs"in s)&&!/\((?:Kaladesh|Zendikar|Amonkhet|Innistrad|Ixalan)\)$/.test(s.name)),r=new Map;for(let s of t){let l=r.get(s.name)??[];l.push(s),r.set(s.name,l)}let i=Array.isArray(e.subrace)?e.subrace:[],o=[];for(let[s,l]of r.entries()){let a=vs(s),c=l.reduce((C,g)=>Object.keys(g).length>Object.keys(C).length?g:C,l[0]);if(!c.ability){let C=i.find(g=>g.raceName===s&&g.raceSource===c.source&&!("name"in g)&&Array.isArray(g.ability));C&&(c.ability=C.ability)}let p=pe(c,We),u=[];c.darkvision&&u.push(`Darkvision ${c.darkvision} ft.`),c.blindsight&&u.push(`Blindsight ${c.blindsight} ft.`),c.tremorsense&&u.push(`Tremorsense ${c.tremorsense} ft.`),c.truesight&&u.push(`Truesight ${c.truesight} ft.`),u.length&&(p.senses=u),Array.isArray(p.traits)&&(p.traits=p.traits.filter(C=>!Rn.includes(C)));let f=ue(p,We),h=[];h.push(`# ${s}`,"## Stats");let F=Array.isArray(c.size)?c.size.map(C=>He[C]||C).join("/"):He[c.size]??c.size;h.push(`**Size:** ${F}`);let M=typeof c.speed=="number"?c.speed:c.speed?.walk??c.speed?.base??0;h.push(`**Speed:** ${M} ft. walking`);let d=i.filter(C=>C.name&&C.raceName===s&&C.raceSource===c.source),A=Array.isArray(c.ability)?c.ability:Array.isArray(d[0]?.ability)?d[0].ability:[];if(Array.isArray(A)&&A.length){let C={str:0,dex:0,con:0,int:0,wis:0,cha:0},g=null;for(let I of A)if("choose"in I)g=I.choose;else for(let[N,j]of Object.entries(I))C[N]+=j;let P=Object.entries(C).filter(([,I])=>I!==0).map(([I,N])=>`${I.toUpperCase()} ${N>=0?"+":""}${N}`);g?.count&&Array.isArray(g.from)&&P.push(`CHOOSE ${g.count} from ${g.from.map(I=>I.toUpperCase()).join(", ")}`),P.length&&h.push(`**Ability Scores:** ${P.join(", ")}`)}let k=p.languages;if(k?.length&&h.push(`**Languages:** ${k.join(", ")}`),Array.isArray(c.skillProficiencies)){let C=[];for(let g of c.skillProficiencies)if(g.choose?.from)C.push(`Choose from: ${g.choose.from.map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(", ")}`);else{let w=g.proficiency??g.name??g;typeof w=="string"&&C.push(w.charAt(0).toUpperCase()+w.slice(1))}C.length&&h.push(`**Skill Proficiencies:** ${C.join("; ")}`)}let _=p[re.TOOL_PROFICIENCIES],B=p[re.WEAPON_PROFICIENCIES],H=p[re.ARMOR_PROFICIENCIES];_?.length&&h.push(`**Tool Proficiencies:** ${_.join(", ")}`),B?.length&&h.push(`**Weapon Proficiencies:** ${B.join(", ")}`),H?.length&&h.push(`**Armor Proficiencies:** ${H.join(", ")}`),h.push("## Traits");let K=new Set;for(let C of p.traits||[]){h.push(`##### ${C}`);let g=c.entries?.find(w=>w.name===C);g?.entries&&g.entries.forEach((w,P)=>{let I;w.type==="table"?I=Ce(w):w.type==="list"?I=w.items.map(N=>typeof N=="string"?`- ${O(N)}`:`- ${N.name}`).join(`
`):typeof w=="string"&&(I=O(w)),I&&!K.has(I)&&(h.push(I),K.add(I),g.entries.length>1&&P<g.entries.length-1&&h.push(""))})}let W=d;if(W.length){o.push({path:`Species/${a}/${a}.md`,content:`---
${f}
---

${h.join(`
`)}`});let C=`Species/${a}/Subspecies`;for(let g of W){let P=[`# ${g.name.replace(/;/g,":")}`];if(Array.isArray(g.ability)){let N={str:0,dex:0,con:0,int:0,wis:0,cha:0},j=null;for(let m of g.ability)if("choose"in m)j=m.choose;else for(let[E,D]of Object.entries(m))N[E]+=D;let S=Object.entries(N).filter(([,m])=>m!==0).map(([m,E])=>`${m.toUpperCase()} ${E>=0?"+":""}${E}`);j?.count&&S.push(`CHOOSE ${j.count} from ${j.from.map(m=>m.toUpperCase()).join(", ")}`),S.length&&P.push(`**Ability Scores:** ${S.join(", ")}`)}for(let N of g.entries||[])P.push(te(N)),P.push("");let I=ue(pe(g,We),We);o.push({path:`${C}/${vs(g.name)}.md`,content:`---
${I}
---

${P.join(`
`)}`})}}else o.push({path:`Species/${a}.md`,content:`---
${f}
---

${h.join(`
`)}`})}return o.sort((s,l)=>s.path.localeCompare(l.path))}function On(e){return["Ability Score Improvement","Archetype Feature","Subclass Feature"].some(r=>e.toLowerCase().includes(r.toLowerCase()))?e:`[[#${e.replace(/[^\w\s]/g,"").replace(/-/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,r=>r.toUpperCase())}]]`}var Ts={AI:"Artificer Infusion",ED:"Elemental Discipline",EI:"Eldritch Invocation",MM:"Metamagic",MV:"Maneuver","MV:B":"Maneuver, Battle Master","MV:C2-UA":"Maneuver, Cavalier V2 (UA)","AS:V1-UA":"Arcane Shot, V1 (UA)","AS:V2-UA":"Arcane Shot, V2 (UA)",AS:"Arcane Shot",OTH:"Other","FS:F":"Fighting Style; Fighter","FS:B":"Fighting Style; Bard","FS:P":"Fighting Style; Paladin","FS:R":"Fighting Style; Ranger",PB:"Pact Boon",OR:"Onomancy Resonant",RN:"Rune Knight Rune",AF:"Alchemical Formula",TT:"Traveler's Trick"};function $s(e,n,t,r){e._editionId=n;let i=Array.isArray(e.class)?e.class[0]:e,o=typeof i.name=="string"?i.name:t?t.replace(/^class-/,"").replace(/\.json$/,""):"Unknown",s=[],l=["+2","+2","+2","+2","+3","+3","+3","+3","+4","+4","+4","+4","+5","+5","+5","+5","+6","+6","+6","+6"],a=i.hd?.number??1,c=i.hd?.faces??6,p=`${a}d${c}`,u=a*c,f=Math.ceil((c+1)/2),F={...pe(i,Mt),hd:p},M=ue(F,Mt),d=[];d.push(`# ${o}`),i.source&&d.push(`**Source:** ${i.source}`),d.push(""),d.push("---"),d.push("## Hit Points"),d.push(`**Hit Dice:** ${p} per ${o} level`),d.push(`**Hit Points at 1st Level:** ${u} + your Constitution modifier`),d.push(`**Hit Points at Higher Levels:** ${p} (or ${f}) + your Constitution modifier per level after 1st`),d.push(""),d.push("---"),d.push("## Proficiencies");let A=i.startingProficiencies??{};Array.isArray(A.armor)&&A.armor.length&&d.push(`- **Armor:** ${A.armor.join(", ")}`);let k=Ft(A);k.length&&d.push(`- **Weapons:** ${k.join(", ")}`);let _=kt(A);_.length&&d.push(`- **Tools:** ${_.join(", ")}`);let B=Array.isArray(i.proficiency)?i.proficiency.map(y=>({str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"})[y]||y.toUpperCase()):[];B.length&&d.push(`- **Saving Throws:** ${B.join(", ")}`);{let S=(Array.isArray(A.skillProficiencies)?A.skillProficiencies:Array.isArray(A.skills)?A.skills:Array.isArray(A.skillProf)?A.skillProf:[]).find(m=>m&&(typeof m.choose=="object"||typeof m.any=="number"));if(S){let m=S.choose?.count??S.any??1,E=Array.isArray(S.choose?.from)?S.choose.from.map(D=>D.split(" ").map(L=>L[0].toUpperCase()+L.slice(1)).join(" ")):It;d.push(`- **Skills (Choose ${m}):** ${E.join(", ")}`)}else{let m=st(A);m.length&&d.push(`- **Skills:** ${m.join(", ")}`)}}Array.isArray(i.startingEquipment)&&(d.push(`
### Equipment`),i.startingEquipment.filter(y=>typeof y=="string").forEach(y=>d.push(`- ${y}`)));let H=i.classTableGroups??[],K=20;if(!H.length)d.push("*(No class table provided for this class.)*");else{let y={};for(let b of i.classFeatures??[]){let Y=typeof b=="object"&&b.classFeature?b.classFeature:String(b),[$,,,v]=Y.split("|"),T=Number(v??0);y[T]||(y[T]=[]),y[T].push($)}let S=new Set,m={};for(let b of H){let Y=Array.isArray(b.colLabels)?b.colLabels.map(v=>O(v)):[],$=Array.isArray(b.rows)?b.rows:Array.isArray(b.rowsSpellProgression)?b.rowsSpellProgression:[];if(!(!Y.length||!$.length))for(let v=0;v<$.length;v++){let T=v+1;m[T]||(m[T]={});let q=m[T],Q=$[v];for(let V=0;V<Y.length;V++){let J=Y[V],ee="",X=Q[V];Array.isArray(X)?ee=X.join(", "):X&&typeof X=="object"&&"value"in X?ee=String(X.value):ee=String(X??""),S.add(J),q[J]=ee}}}let E=Array.from(S).filter(b=>!/Cantrips Known|Spells Known|\d+(st|nd|rd|th)/.test(b)),D=["Level","Proficiency Bonus","Class Features",...E],L=[];for(let b=1;b<=K;b++){let Y=(y[b]??[]).map(On),$=m[b]??{};L.push([b.toString(),l[b-1]||"",Y.join(", ").replace(/\|/g,"&#124;"),...E.map(v=>$[v]??"")])}d.push(`
> [!example]- Class Progression Table`),d.push(Ce({type:"table",caption:"",colLabels:D,rows:L}))}let W=H.find(y=>Array.isArray(y.colLabels)&&y.colLabels.some(S=>/Cantrips Known|Spells Known/.test(String(S)))),C=H.find(y=>Array.isArray(y.colLabels)&&y.title==="Spell Slots per Spell Level");if(W&&C){let y=W.colLabels.map(b=>O(b)),S=C.colLabels.map(b=>O(b)),m=W.rows||[],E=C.rowsSpellProgression||[],D=["Level",...y,...S],L=[];for(let b=0;b<Math.max(m.length,E.length);b++){let Y=String(b+1),$=m[b]?m[b].map(String):y.map(T=>""),v=E[b]?E[b].map(String):S.map(T=>"");L.push([Y,...$,...v])}d.push(`
> [!tip]- Spell Progression Table`),d.push(Ce({type:"table",caption:"",colLabels:D,rows:L}))}let g=Array.isArray(e.subclass)?e.subclass:[],w=Array.isArray(e.subclassFeature)?e.subclassFeature:e.lookup?.subclassFeature??[];for(let y of g){let S=y.name,m=[];m.push(`# ${S}`),m.push(`**Parent Class:** [[${o}]]`),y.source&&m.push(`**Source:** ${y.source}`),m.push("");let E=w.find($=>$.name===y.name&&$.level===3&&$.subclassShortName===y.shortName&&$.subclassSource===y.source);if(E?.entries?.length){let $=Array.isArray(E.entries)?E.entries.map(v=>typeof v=="string"?O(v):te(v)).join(`

`):te(E.entries);m.push($,"")}let D=Object.entries(Ts).find(([,$])=>$.toLowerCase().includes(S.toLowerCase()))?.[0];if(D){let $=r.filter(v=>Array.isArray(v.featureType)&&v.featureType.includes(D));if($.length){m.push(`## ${S} Optional Features`);for(let v of $){for(let T of v.entries){let q=typeof T=="string"?O(T):te(T);m.push(`**${v.name}:** ${q}`)}m.push("")}}}let L=y.subclassTableGroups??[];if(L.length){let $=new Set,v={};for(let q of L){let Q=(q.colLabels??[]).map(O);(Array.isArray(q.rows)?q.rows:Array.isArray(q.rowsSpellProgression)?q.rowsSpellProgression:[]).forEach((J,ee)=>{let X=ee+1;v[X]??(v[X]={}),J.forEach((ae,Le)=>{let de=Q[Le];de&&($.add(de),v[X][de]=typeof ae=="object"&&ae!==null&&"value"in ae?String(ae.value):String(ae??""))})})}let T=Array.from($);m.push("## Subclass Progression"),m.push(Ce({type:"table",caption:"",colLabels:["Level",...T],rows:Array.from({length:20},(q,Q)=>{let V=Q+1;return[String(V),...T.map(J=>v[V]?.[J]??"")]})}))}let b={};for(let $ of w)if($.subclassShortName===y.shortName&&$.subclassSource===y.source&&$.className===o){let v=$.level??0;(b[v]??(b[v]=[])).push($)}for(let $ of Object.keys(b).map(Number).sort((v,T)=>v-T)){m.push("---",`## Level ${$}`);for(let v of b[$]){m.push(`### ${v.name}`);for(let T of Array.isArray(v.entries)?v.entries:[v.entries]){if(typeof T=="string"){m.push(O(T));continue}if(T.type==="entries"&&/^Maneuvers$/i.test(T.name)){m.push(`##### ${T.name}`);for(let V of Array.isArray(T.entries)?T.entries:[T.entries])m.push(typeof V=="string"?O(V):te(V));let Q=Object.entries(Ts).find(([,V])=>V.toLowerCase().includes(S.toLowerCase()))?.[0];if(Q){let V=r.filter(J=>Array.isArray(J.featureType)&&J.featureType.includes(Q));for(let J of V){for(let ee of J.entries){let X=typeof ee=="string"?O(ee):te(ee);m.push(`**${J.name}:** ${X}`)}m.push("")}}continue}if(T.type==="entries"&&T.name){m.push(`##### ${T.name}`);for(let Q of Array.isArray(T.entries)?T.entries:[T.entries])m.push(te(Q));continue}if(T.type==="inset"&&T.name){let Q=Array.isArray(T.entries)?T.entries:[T.entries];m.push(`> **${T.name}**`),Q.forEach(V=>m.push(`> ${te(V)}`));continue}let q=te(T);q&&m.push(q)}}}let Y=m.join(`

`).replace(/\n{3,}/g,`

`);s.push({path:`Classes/${o}/Subclasses/${S}.md`,content:Y})}if(g.length){let y=g.map(S=>`[[Subclasses/${S.name.replace(/[\\/]/g,"-")}|${S.name}]]`);d.push(`
**Subclasses:** ${y.join(", ")}`)}let P=Array.isArray(e.classFeature)?e.classFeature:e.lookup?.classFeature??[],I={};for(let y of P){if(y.className!==o)continue;let S=y.level??0;I[S]||(I[S]=[]),I[S].push(y)}d.push(""),d.push("---"),d.push("## Level Features");let N=Object.keys(I).map(y=>+y).sort((y,S)=>y-S);for(let y of N){d.push(`### Level ${y}`);for(let S of I[y]){d.push(`#### ${S.name}`);let m=Array.isArray(S.entries)?S.entries:[S.entries];for(let E of m){if(typeof E=="string"){let L=te(E).trim();if(L==="{"||L==="}")continue;d.push(L);continue}if(E.type==="list"&&Array.isArray(E.items)){for(let L of E.items)d.push(`- ${O(L)}`);continue}if(E.type==="options"){E.count&&(d.push(""),d.push(`**Choose ${E.count} of the following options:**`),d.push(""));for(let L of Array.isArray(E.entries)?E.entries:[E.entries])if(L.type==="refOptionalfeature"){let[b,Y]=L.optionalfeature.split("|"),$=r.find(v=>v.name===b&&(!Y||v.source===Y));$?($.entries.forEach((v,T)=>{let q=typeof v=="string"?O(v):te(v);T===0?d.push(`- **${$.name}:** ${q}`):d.push(`  - ${q}`)}),d.push("")):d.push(`**${b}:**`)}else{let b=te(L);b&&d.push(`- ${b}`)}continue}if(E.type==="refOptionalfeature"){let[L]=E.optionalfeature.split("|");d.push(`- [[${L}|${L}]]`);continue}if(E.type==="entries"&&E.name){d.push(`##### ${E.name}`);let L=Array.isArray(E.entries)?E.entries:[E.entries];for(let b of L)d.push(te(b));continue}let D=te(E);D&&d.push(D)}d.push("")}d.push("---")}let j=`---
${M}
---

${d.join(`
`)}`;return j=O(j),j=j.replace(/\n{3,}/g,`

`).replace(/\n +\n/g,`

`),[{path:`Classes/${o}/${o}.md`,content:j},...s]}function Fs(e,n){if(!Array.isArray(e.action))return[];let t=[];for(let i of e.action){t.push(`## ${i.name}`);let o=Array.isArray(i.entries)?i.entries:[i.entries];for(let s of o)if(s)if(typeof s=="string"){let l=s.split(/\n{2,}/);for(let a of l){let c=a.trim();c&&(t.push(O(c)),t.push(""))}}else if(s.type==="list"&&Array.isArray(s.items)){for(let l of s.items)t.push(`- ${O(l)}`);t.push("")}else if((s.type==="entries"||s.type==="inset")&&Array.isArray(s.entries)){t.push(`### ${s.name}`);for(let l of s.entries)if(typeof l=="string"){let a=l.split(/\n{2,}/);for(let c of a){let p=c.trim();p&&(t.push(O(p)),t.push(""))}}else if(l.type==="list"&&Array.isArray(l.items)){for(let a of l.items)t.push(`- ${O(a)}`);t.push("")}else{let a=Array.isArray(l)?l.join(" "):typeof l=="object"?JSON.stringify(l):String(l);t.push(O(a)),t.push("")}}else if(s.type==="table"&&Array.isArray(s.rows)){let l=s.colLabels||[];t.push(`| ${l.join(" | ")} |`),t.push(`| ${l.map(()=>"---").join(" | ")} |`);for(let a of s.rows)t.push(`| ${a.join(" | ")} |`);t.push("")}else{let l=Array.isArray(s)?s.join(" "):typeof s=="object"?JSON.stringify(s):String(s);t.push(O(l)),t.push("")}t.push("---")}return[{path:"Rules and Reference/Actions.md",content:t.reduce((i,o)=>o===""&&i.length&&i[i.length-1]===""?i:i.concat(o),[]).join(`
`).trim()+`
`}]}function ks(e,n){let t=[],r=(i,o)=>{let s=[];for(let a of i){s.push(`## ${a.name}`);let c=Array.isArray(a.entries)?a.entries:[a.entries];for(let p of c)if(p)if(typeof p=="string"){let u=p.split(/\n{2,}/);for(let f of u){let h=f.trim();h&&(s.push(O(h)),s.push(""))}}else if(p.type==="list"&&Array.isArray(p.items)){for(let u of p.items)s.push(`- ${O(u)}`);s.push("")}else if(p.type==="table"&&Array.isArray(p.rows)){let u=p.colLabels||[];s.push(`| ${u.join(" | ")} |`),s.push(`| ${u.map(()=>"---").join(" | ")} |`);for(let f of p.rows)s.push(`| ${f.join(" | ")} |`);s.push("")}else if(p.type==="entries"&&Array.isArray(p.entries)){s.push(`### ${p.name}`);for(let u of p.entries){let f=typeof u=="string"?u:String(u);s.push(O(f)),s.push("")}}else{let u=Array.isArray(p)?p.join(" "):String(p);s.push(O(u)),s.push("")}s.push("---")}let l=s.reduce((a,c)=>c===""&&a.length&&a[a.length-1]===""?a:a.concat(c),[]);t.push({path:o,content:l.join(`
`).trim()+`
`})};return r(e.condition||[],"Rules and Reference/Conditions.md"),r(e.disease||[],"Rules and Reference/Diseases.md"),t}function Is(e,n){let t=Array.isArray(e.sense)?e.sense:Array.isArray(e.senses)?e.senses:[];if(!t.length)return[];let r=[];for(let o of t){r.push(`## ${o.name}`);let s=Array.isArray(o.entries)?o.entries:[o.entries];for(let l of s)if(l)if(typeof l=="string"){let a=l.split(/\n{2,}/);for(let c of a){let p=c.trim();p&&(r.push(O(p)),r.push(""))}}else if(l.type==="list"&&Array.isArray(l.items)){for(let a of l.items)r.push(`- ${O(a)}`);r.push("")}else if((l.type==="entries"||l.type==="inset")&&Array.isArray(l.entries)){r.push(`### ${l.name}`);for(let a of l.entries){let c=typeof a=="string"?a:String(a);r.push(O(c)),r.push("")}}else if(l.type==="table"&&Array.isArray(l.rows)){let a=l.colLabels||[];r.push(`| ${a.join(" | ")} |`),r.push(`| ${a.map(()=>"---").join(" | ")} |`);for(let c of l.rows)r.push(`| ${c.join(" | ")} |`);r.push("")}else{let a=Array.isArray(l)?l.join(" "):String(l);r.push(O(a)),r.push("")}r.push("---")}return[{path:"Rules and Reference/Senses.md",content:r.reduce((o,s)=>s===""&&o.length&&o[o.length-1]===""?o:o.concat(s),[]).join(`
`).trim()+`
`}]}function Ps(e,n){let t=Array.isArray(e.skill)?e.skill:Array.isArray(e.skills)?e.skills:[];if(!t.length)return[];let r=[];for(let o of t){r.push(`## ${o.name}`),o.ability&&(r.push(`*Ability: ${o.ability}*`),r.push(""));let s=Array.isArray(o.entries)?o.entries:[o.entries];for(let l of s)if(l)if(typeof l=="string"){let a=l.split(/\n{2,}/);for(let c of a){let p=c.trim();p&&(r.push(O(p)),r.push(""))}}else if(l.type==="list"&&Array.isArray(l.items)){for(let a of l.items)r.push(`- ${O(a)}`);r.push("")}else{let a=Array.isArray(l)?l.join(" "):String(l);r.push(O(a)),r.push("")}r.push("---")}return[{path:"Rules and Reference/Skills.md",content:r.reduce((o,s)=>s===""&&o.length&&o[o.length-1]===""?o:o.concat(s),[]).join(`
`).trim()+`
`}]}function Ms(e,n){return(Array.isArray(e.feat)?e.feat:Array.isArray(e.feats)?e.feats:[]).map(r=>{let i=[],o=pe({...r,_editionId:n},Lt);i.push("---"),i.push(ue(o,Lt)),i.push("---",""),i.push(`# ${r.name}`,"");let s=[];return Array.isArray(r.prerequisite)&&r.prerequisite.forEach(a=>{a.level&&s.push(`Level ${a.level}`),Array.isArray(a.feat)&&a.feat.forEach(c=>{let p=c.split("|")[0].replace(/\b\w/g,u=>u.toUpperCase());s.push(`Prerequisite: [[${p}]]`)})}),r.spellcastingPrepared&&s.push("Prerequisite: Spellcaster"),Array.isArray(r.toolProficiencies)&&r.toolProficiencies.forEach(a=>{Object.entries(a).forEach(([c])=>{c==="anyArtisansTool"?s.push("Prerequisite: Proficient with an artisan's tool"):s.push(`Prerequisite: Proficient with ${c.replace(/([A-Z])/g," $1").trim()}`)})}),Array.isArray(r.armorProficiencies)&&r.armorProficiencies.forEach(a=>{let c=typeof a=="string"?a:JSON.stringify(a);s.push(`Prerequisite: Proficient with ${c.replace(/([A-Z])/g," $1").trim()}`)}),r.race&&s.push(`Prerequisite: ${r.race}`),s.length&&(i.push("**Prerequisites**"),s.forEach(a=>i.push(`- ${a}`)),i.push("")),(Array.isArray(r.entries)?r.entries:[r.entries]).forEach(a=>{if(a){if(typeof a=="string")a.split(/\n{2,}/).forEach(c=>{let p=c.trim();p&&(i.push(O(p)),i.push(""))});else if(a.type==="list"&&Array.isArray(a.items))a.items.forEach(c=>{typeof c=="string"?i.push(`- ${O(c)}`):c.type==="item"&&c.name&&(i.push(`- **${c.name}**`),(Array.isArray(c.entries)?c.entries:[c.entries]).forEach(u=>i.push(`  - ${O(typeof u=="string"?u:JSON.stringify(u))}`)))}),i.push("");else if(a.type==="inset")i.push(`- *${a.name}*`),(Array.isArray(a.entries)?a.entries:[a.entries]).forEach(p=>i.push(`  - ${O(p)}`)),i.push("");else if((a.type==="section"||a.type==="entries")&&Array.isArray(a.entries))a.name&&(i.push(`## ${a.name}`),i.push("")),a.entries.forEach(c=>{i.push(O(typeof c=="string"?c:JSON.stringify(c))),i.push("")});else if(a.type==="table"&&Array.isArray(a.rows)){let c=a.colLabels||[];i.push(`| ${c.join(" | ")} |`),i.push(`| ${c.map(()=>"---").join(" | ")} |`),a.rows.forEach(p=>i.push(`| ${p.join(" | ")} |`)),i.push("")}}}),{path:`Player Build/Feats/${r.name}.md`,content:i.join(`
`).trim()+`
`}})}function Ls(e,n){let r=(Array.isArray(e.background)?e.background:Array.isArray(e.backgrounds)?e.backgrounds:[]).filter(o=>{let s=o.name||"";return!s.startsWith("Variant")&&!s.includes("Baldur's Gate")}),i=[];return r.forEach(o=>{let s=[],l=pe(o,xt),a=Array.isArray(o.entries)?o.entries.filter(p=>p.data?.isFeature&&typeof p.name=="string").map(p=>{let u=p.name.replace(/^Feature:\s*/,"");return`[[${o.name}#${u}]]`}):[],c=ue(l,xt);if(s.push("---",c,"---",""),s.push(`# ${o.name}`,""),Array.isArray(o.skillProficiencies)&&o.skillProficiencies.length){let p=[];o.skillProficiencies.forEach(u=>{typeof u=="string"?p.push(Nt(u)):u.choose&&Array.isArray(u.choose.from)?p.push(`Choose ${u.choose.amount} from ${u.choose.from.join(", ")}`):Object.entries(u).filter(([,f])=>f===!0).forEach(([f])=>p.push(Nt(f)))}),s.push(`**Skill Proficiencies:** ${p.join(", ")}`,"")}if(Array.isArray(o.languageProficiencies)&&o.languageProficiencies.length){let p=[];o.languageProficiencies.forEach(u=>{u.anyStandard?p.push(`${u.anyStandard} of your choice`):Object.entries(u).filter(([,f])=>f===!0).forEach(([f])=>p.push(Nt(f)))}),s.push(`**Languages:** ${p.join(", ")}`,"")}if(Array.isArray(o.toolProficiencies)&&o.toolProficiencies.length){let p=[];o.toolProficiencies.forEach(u=>{if(u.choose&&Array.isArray(u.choose.from)){let f=u.choose.from.map(nt).join(", ");p.push(`Choose ${u.choose.count} from ${f}`);return}if(typeof u=="string"){p.push(nt(u));return}Object.entries(u).filter(([f,h])=>h===!0).forEach(([f])=>p.push(nt(f)))}),s.push(`**Tool Proficiencies:** ${p.join(", ")}`,"")}Array.isArray(o.startingEquipment)&&o.startingEquipment.length&&(s.push("**Equipment:**"),o.startingEquipment.forEach(p=>{Array.isArray(p._)&&p._.forEach(u=>s.push(`- ${xs(u)}`)),["a","b"].forEach(u=>{Array.isArray(p[u])&&p[u].forEach(f=>s.push(`- ${xs(f)}`))})}),s.push("")),Array.isArray(o.entries)&&o.entries.forEach(p=>{if(!(p.type==="list"&&p.style==="list-hang-notitle")){if(p.name){let u=p.data?.isFeature?p.name.replace(/^Feature:\s*/,""):p.name;s.push(`## ${u}`,"")}Array.isArray(p.entries)?p.entries.forEach(u=>{if(typeof u=="string")s.push(O(u),"");else if(u.type==="list"&&Array.isArray(u.items))u.items.forEach(f=>s.push(`- ${O(f.entry??f)}`)),s.push("");else if(u.type==="table"){let f=Ce(u);f&&s.push(f,"")}}):p.type==="list"&&Array.isArray(p.items)&&(p.items.forEach(u=>s.push(`- ${O(u.entry??u)}`)),s.push(""))}}),i.push({path:`Player Build/Backgrounds/${o.name}.md`,content:s.join(`
`).trimEnd()+`
`})}),i}function Nt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function xs(e){if(typeof e=="string")return e.includes("|")?O(`{@item ${e}}`):O(e);let n=e.containsValue??e.value;if(typeof n=="number"&&!e.item&&!e.equipmentType&&!e.special)return`${n>=100?n/100:n} gp`;if(e.item){let t=O(`{@item ${e.item}}`);if(typeof n=="number"){let r=n>=100?n/100:n;return`${t} (${r} gp)`}return t}if(typeof e.special=="string")return e.special;if(e.equipmentType)switch(e.equipmentType){case"toolArtisan":return"One type of artisan\u2019s tools (of your choice)";case"instrumentMusical":return"One type of musical instrument (of your choice)";case"setGaming":return"One set of gaming dice (of your choice)";default:return nt(e.equipmentType)}return O(JSON.stringify(e))}function nt(e){let n=e.replace(/([a-z])([A-Z])/g,"$1 $2");return n.charAt(0).toUpperCase()+n.slice(1)}var Rs=require("obsidian");async function jn(e){let n=`https://api.github.com/repos/${e}/contents/data/spells`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&i.name.startsWith("spells-")&&i.name.endsWith(".json")).map(i=>i.name)}async function Dn(e){let n=`https://api.github.com/repos/${e}/contents/data/bestiary`,r=await(await fetch(n)).json(),i=["bestiary-phb.json","bestiary-mm.json","bestiary-dmg.json","bestiary-xge.json","bestiary-vgm.json","bestiary-tce.json","bestiary-egw.json","bestiary-erlw.json","bestiary-mtf.json","bestiary-vrgr.json","bestiary-cos.json","bestiary-oota.json","bestiary-pota.json","bestiary-hotdq.json","bestiary-rot.json","bestiary-skt.json","bestiary-tftyp.json","bestiary-toa.json"];return r.filter(o=>o.type==="file"&&i.includes(o.name)).map(o=>o.name)}var Nn=["items-base.json","items.json","objects.json","vehicles.json","decks.json"];async function _n(e){let n=`https://api.github.com/repos/${e}/contents/data`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&Nn.includes(i.name)).map(i=>i.name)}async function Gn(e){let n=`https://api.github.com/repos/${e}/contents/data/class`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&i.name.startsWith("class-")&&i.name.endsWith(".json")).map(i=>i.name)}async function be(e,n){let t=n.split("/"),r="";for(let i of t){r=r?`${r}/${i}`:i;try{await e.vault.createFolder(r)}catch{}}}async function Un(e){let{app:n,edition:t,targetPath:r}=e,i=t.repo??"";{let s=await jn(i);for(let l of s)try{let c=await(await fetch(`${t.sourceUrl}/spells/${l}`)).json(),p=ws(c,t.id);for(let u of p){let f=(0,me.normalizePath)(`${r}/Spells/${u.path}`),h=f.split("/").slice(0,-1).join("/");await be(n,h),await n.vault.adapter.write(f,u.content)}}catch(a){console.warn(`Failed to import spell ${l}:`,a)}}{let s=await Dn(i);for(let l of s)try{let c=await(await fetch(`${t.sourceUrl}/bestiary/${l}`)).json(),p=Ss(c,t.id);for(let u of p){let f=(0,me.normalizePath)(`${r}/Bestiary/${u.path}`),h=f.split("/").slice(0,-1).join("/");await be(n,h),await n.vault.adapter.write(f,u.content)}}catch(a){console.warn(`Failed to import bestiary ${l}:`,a)}}{let s=await _n(i);for(let l of s)try{let c=await(await fetch(`${t.sourceUrl}/${l}`)).json(),p=bs(c,t.id);for(let u of p){let f=(0,me.normalizePath)(`${r}/${u.path}`),h=f.split("/").slice(0,-1).join("/");await be(n,h),await n.vault.adapter.write(f,u.content)}}catch(a){console.warn(`Failed to import items from ${l}:`,a)}}{let l=await(await fetch(`${t.sourceUrl}/races.json`)).json(),a=Cs(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/Player Build/${c.path}`);await be(n,p.split("/").slice(0,-1).join("/")),await n.vault.adapter.write(p,c.content)}}let o=[];try{let l=await(await fetch(`${t.sourceUrl}/optionalfeatures.json`)).json();o=Array.isArray(l.optionalfeature)?l.optionalfeature:[]}catch(s){console.warn("Failed to import optionalfeatures.json:",s)}{let s=await Gn(i);for(let l of s)try{let c=await(await fetch(`${t.sourceUrl}/class/${l}`)).json(),p=$s(c,t.id,l,o);for(let u of p){let f=(0,me.normalizePath)(`${r}/Player Build/${u.path}`);await be(n,f.split("/").slice(0,-1).join("/"));let h=n.vault.getAbstractFileByPath(f);h instanceof Rs.TFile?await n.vault.modify(h,u.content):await n.vault.create(f,u.content)}}catch(a){console.warn(`Failed to import class ${l}:`,a)}}try{let l=await(await fetch(`${t.sourceUrl}/actions.json`)).json(),a=Fs(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import actions.json:",s)}try{let l=await(await fetch(`${t.sourceUrl}/conditionsdiseases.json`)).json(),a=ks(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import conditionsdiseases.json:",s)}try{let l=await(await fetch(`${t.sourceUrl}/senses.json`)).json(),a=Is(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import senses.json:",s)}try{let l=await(await fetch(`${t.sourceUrl}/skills.json`)).json(),a=Ps(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import skills.json:",s)}try{let l=await(await fetch(`${t.sourceUrl}/feats.json`)).json(),a=Ms(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import feats.json:",s)}try{let l=await(await fetch(`${t.sourceUrl}/backgrounds.json`)).json(),a=Ls(l,t.id);for(let c of a){let p=(0,me.normalizePath)(`${r}/${c.path}`),u=p.split("/").slice(0,-1).join("/");await be(n,u),await n.vault.adapter.write(p,c.content)}}catch(s){console.warn("Failed to import backgrounds.json:",s)}}var is={};Et(is,{importEditionData:()=>yi});var ye=require("obsidian");var Vn={PHB:"Player's Handbook",MM:"Monster Manual",DMG:"Dungeon Master's Guide",CoS:"Curse of Strahd",OotA:"Out of the Abyss",PotA:"Princes of the Apocalypse",HotDQ:"Hoard of the Dragon Queen",RoT:"Rise of Tiamat",SKT:"Storm King's Thunder",TftYP:"Tales from the Yawning Portal",ToA:"Tomb of Annihilation",XGE:"Xanathar's Guide to Everything",VGM:"Volo's Guide to Monsters",TCE:"Tasha's Cauldron of Everything",EGW:"Eberron: Rising from the Last War",ERLW:"Explorer's Guide to Wildemount",MTF:"Monsters of the Multiverse",VRGR:"Van Richten's Guide to Ravenloft",AAG:"Astral Adventurer\u2019s Guide",AI:"Acquisitions Incorporated",AitFRAVFT:"Adventures in the Forgotten Realms: A Visual Field Test",BMT:"Big Monster Tome",DoDk:"Dragon of Darkkeep",FTD:"Fizban\u2019s Treasury of Dragons",GGR:"Guildmaster\u2019s Guide to Ravnica",GHLoE:"Ghosts of the Horizon: Light Over Elensaria",IDRotF:"Icewind Dale: Rime of the Frostmaiden",LLK:"Lost Laboratory of Kwalish",SatO:"Sapphire of Truth",SCC:"Strixhaven: Curriculum of Chaos",TDCSR:"The Dungeon Coach\u2019s Rulebook",JttRC:"Journeys through the Radiant Citadel","AitFR-AVT":"Adventures in the Forgotten Realms: A Verdant Tomb","AitFR-FCD":"Adventures in the Forgotten Realms: From Cyan Depths",RMR:"Dungeons and Dragons: Rick and Morty",SCAG:"Sword Coast Adventurer's Guide",EEPC:"Elemental Evil Player's Companion",MOT:"Mythic Odysseys of Theros",WBtW:"The Wild Beyond the Witchlight",BGDIA:"Baldur's Gate: Descent Into Avernus",ToFW:"Turn of Fortune's Wheel",CoA:"Chains of Asmodeus",CRCotN:"Critical Role: Call of the Netherdeep",ToD:"Tyranny of Dragons",MPMM:"Mordenkainen Presents: Monsters of the Multiverse",LoX:"Light of Xaryxis",QftIS:"Quests from the Infinite Staircase",WDH:"Waterdeep: Dragon Heist",WDMM:"Waterdeep: Dungeon of the Mad Mage",PaBTSO:"Phandelver and Below: The Shattered Obelisk",CM:"Candlekeep Mysteries",GoS:"Ghosts of Saltmarsh",DSotDQ:"Dragonlance: Shadow of the Dragon Queen",KftGV:"Keys from the Golden Vault",SDW:"Essentials Kit: Sleeping Dragon's Wake",DoSI:"Dragons of Stormwreck Isle",GotSF:"Giants of the Star Forge",DIP:"Essentials Kit: Dragon of Icespire Peak",SLW:"Essentials Kit: Storm Lord's Wrath",IMR:"Infernal Machine Rebuild",VEoR:"Vecna: Eve of Ruin",PSI:"Plane Shift: Innistrad",AATM:"Adventure Atlas: The Mortuary",PSZ:"Plane Shift: Zendikar",DC:"Essentials Kit: Divine Contention",LMoP:"Lost Mine of Phandelver",RMBRE:"The Lost Dungeon of Rickedness: Big Rick Energy",HftT:"Hunt for the Thessalhydra",PSX:"Plane Shift: Ixalan",HFStCM:"Heroes' Feast: Saving the Childrens Menu",SjA:"Spelljammer Academy",LK:"Lightning Keep",RtG:"Return to the Glory",TTP:"The Tortle Package",LR:"Locathah Rising",PSA:"Plane Shift: Amonkhet",OGA:"One Grung Above","NRH-TLT":"Nerds Restoring Harmony: The Lost Tomb","NRH-AT":"Nerds Restoring Harmony: Adventure Together",BGG:"Bigby Presents: Glory of the Giants",RoTOS:"The Rise of Tiamat Online Supplement",XMtS:"X Marks the Spot","HAT-LMI":"Honor Among Theives: Legendary Magic Items",DitLCoT:"Descent into the Lost Caverns of Tsojcanth","AitFR-DN":"Adventures in the Forgotten Realms: Deepest Night","AitFR-THP":"Adventures in the Forgotten Realms: The Hidden Pages",BAM:"Boo's Astral Menagerie",AZfyT:"A Zib for Your Thougts",MCV2DC:"Monstrous Compendium Volume 2: Dragonlance Creatures",PSK:"Plane Shift: Kaladesh",PSD:"Plane Shift: Dominaria",AWM:"Adventure with Muk",UATheMysticClass:"Unearthed Arcana: The Mystic Class",ALCurseOfStrahd:"Adventurers League: Curse of Strahd",ALElementalEvil:"Adventurers League: Elemental Evil",ALRageOfDemons:"Adventurers League: Rage of Demons"};function Pe(e,n){let t=Vn[e]??e;return e==="PHB"&&(n?.includes("2014")?t+=" (2014)":n?.includes("2025")&&(t+=" (2025)")),t}function x(e){let n;return Array.isArray(e)?n=e.join(" "):typeof e=="string"?n=e:n=String(e??""),n.replace(/\{@(spell|item|creature|race) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${Gt(i)}]]`).replace(/\{@(condition|status|action|skill) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${Os(r)}s#${i}|${Gt(i)}]]`).replace(/\{@classFeature ([^|}]+)\|([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>`[[${i}#${r}]]`).replace(/\{@(book|filter) ([^|}]+)(?:\|[^}]+)?\}/g,(t,r,i)=>i).replace(/\{@note ([^}]+)\}/g,(t,r)=>`*${r}*`).replace(/\{@(damage|dice|dc|hit|sense) ([^}]+)\}/g,(t,r,i)=>i).replace(/\{@chance ([^|}]+)(?:\|[^}]+)?\}/g,(t,r)=>`${r}%`).replace(/\{@quickref ([^|}]+)(?:\|[^|]*\|[^}]*)?\}/g,(t,r)=>["difficult terrain","total cover","half cover","three-quarters cover","heavily obscured","lightly obscured"].includes(r.toLowerCase())?`[[Rules#${Gt(r)}]]`:r).replace(/\{\@5etools\s+([^|}]+)\|[^}]+\}/g,"$1").replace(/\{@recharge\s*([^}]+)\}/g,(t,r)=>`(recharge: ${r.trim()})`).replace(/\{@(scaledice|scaledamage)[^}]*\|([^|}]+)\}/g,(t,r,i)=>i).replace(/\{@d20[^}]*\}/g,"").replace(/\{@[^}]+\}/g,"")}function Os(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function Gt(e){return e.split(" ").map(Os).join(" ")}function Te(e){if(e.type!=="table"||!Array.isArray(e.rows))return"";let n=e.caption?`##### ${e.caption}
`:"",t=(e.colLabels??[]).map(s=>x(s.trim())),r=`| ${t.join(" | ")} |`,i=`| ${t.map(()=>":--").join(" | ")} |`,o=e.rows.map(s=>`| ${s.map(a=>typeof a=="string"?x(a):typeof a=="object"?a.roll?.exact!==void 0?`${a.roll.exact}`:a.roll?.min!==void 0&&a.roll?.max!==void 0?`${a.roll.min}\u2013${a.roll.max}`:x(JSON.stringify(a)):x(String(a))).join(" | ")} |`);return`${n}${r}
${i}
${o.join(`
`)}`}function Ge(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)&&typeof e.type=="string"}function ne(e){if(typeof e=="string"){let n=e.trim();return!n||n==="}"?"":x(n)}if(Ge(e)&&e.type==="entries"&&Array.isArray(e.entries)){let n=e.entries.map(ne).filter(t=>t.trim().length>0).join(`

`);return e.name?`##### ${e.name}
${n}`:n}if(Ge(e)&&e.type==="list"&&Array.isArray(e.items))return e.items.map(n=>`- ${x(typeof n=="string"?n:JSON.stringify(n))}`).join(`
`);if(Ge(e)&&e.type==="table"&&Array.isArray(e.rows))return Te(e);if(Ge(e)&&e.type==="quote"&&Array.isArray(e.entries)){let n=e.entries.map(ne).join(" ").trim(),t=e.by?` \u2014 ${e.by}`:"";return`*"${n}${t}"*`}if(Ge(e)&&e.type==="inset"&&Array.isArray(e.entries))return`> ${e.entries.map(ne).join(`
`).trim().replace(/\n/g,`
> `)}`;if(Ge(e)&&e.type==="refClassFeature"&&typeof e.classFeature=="string"){let[n]=e.classFeature.split("|");return`[[#${n.replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").toLowerCase()}]]`}return""}var Bn=[],Kn={T:"Tiny",S:"Small",M:"Medium",L:"Large",H:"Huge",G:"Gargantuan"},Hn={L:"Lawful",N:"Neutral",C:"Chaotic",G:"Good",E:"Evil",U:"Unaligned"};function Ut(e){let n=String(e||"");return n.charAt(0).toUpperCase()+n.slice(1)}function Wn(e){return Kn[e]||e}function Bt(e){return e.trim().split(/\s+/).map(n=>Hn[n]||n).join(" ")}var qn=["Abjurer","Acolyte","Apprentice Wizard","Archdruid","Archer","Archmage","Assassin","Bandit","Bandit Captain","Bard","Berserker","Blackguard","Champion","Commoner","Conjurer","Cult Fanatic","Cultist","Diviner","Druid (NPC)","Druid NPC","Enchanter","Evoker","Gladiator","Guard","Illusionist","Knight","Kraken Priest","Mage","Martial Arts Adept","Master Thief","Necromancer","Noble","Priest","Scout","Spy","Swashbuckler","Thug","Transmuter","Tribal Warrior","Veteran","War Priest","Warlock of the Archfey","Warlock of the Fiend","Warlock of the Great Old One","Warlord"],zn=new Set(qn.map(e=>js(e)));function js(e){return e.replace(/\s+/g," ").trim().toLowerCase()}function Yn(e){let n=e.type,t=e.name,r=typeof n=="string"?n.toLowerCase():n?.type?.toLowerCase()||String(n).toLowerCase(),i=js(t);return e.isNpc||e.isNamedCreature?"Story NPCs":r==="beast"?"Beasts":r==="humanoid"&&zn.has(i)?"Non-Beasts":"Monsters"}function Xn(e,n,t,r,i,o){return["| STR | DEX | CON | INT | WIS | CHA |","| --- | --- | --- | --- | --- | --- |",`| ${e} | ${n} | ${t} | ${r} | ${i} | ${o} |`].join(`
`)}function it(e){let n=e.name,t=[];Array.isArray(e.entries)?t=e.entries:typeof e.entries=="string"?t=[e.entries]:Array.isArray(e.desc)?t=e.desc:typeof e.desc=="string"&&(t=[e.desc]);let r=t.join(" "),i=x(r);return`***${n}.*** ${i}`}function Ds(e,n){if(!e.monster)return[];e._editionId=n;let t=e.monster.filter(s=>{let l=Array.isArray(s.ac)?s.ac[0]?.ac??s.ac[0]:typeof s.ac=="object"?s.ac?.ac??null:s.ac,a=typeof s.hp=="object"?s.hp?.average??s.hp?.hp??null:s.hp;return l!=null&&a!=null&&!isNaN(Number(l))&&!isNaN(Number(a))}),r=new Set(e.monster.map(s=>s.name)),i=new Set(t.map(s=>s.name)),o=[...r].filter(s=>!i.has(s));return t.map(s=>{let l=s.name,a=l.replace(/\//g,"-"),c=s.size||"M",p=Array.isArray(s.alignment)?s.alignment.join(" "):s.alignment||"N",u="Unknown";if(typeof s.type=="string")u=Ut(s.type);else if(s.type?.type){let E=Ut(s.type.type),D=s.type.tags?.length?` (${s.type.tags.map(Ut).join(", ")})`:"";u=`${E}${D}`}s._parsedType=u;let f=Array.isArray(s.ac)?s.ac[0].ac:s.ac,h=s.hp?.average??s.hp,F=s.cr;if(!f&&!h)return Bn.push(s.name),null;let M=Array.isArray(s.ability)?s.ability:[s.str,s.dex,s.con,s.int,s.wis,s.cha],[d=10,A=10,k=10,_=10,B=10,H=10]=M,K=[];if(typeof s.speed=="object"){for(let[E,D]of Object.entries(s.speed))if(E!=="canHover")if(D&&typeof D=="object"&&"number"in D){let L=D.number,b=D.condition?` ${D.condition}`:"";K.push(`${E} ${L} ft.${b}`)}else K.push(`${E} ${D} ft.`)}else K.push(`${s.speed} ft.`);let W=K.join(", "),C=Pe(s.source,n);C=C.replace(/:/g," -");let g=Yn(s),w=fe(s,Vt),P=he(w,Vt),I=w[oe.SAVING_THROWS]||[],N=w[oe.SKILLS]||[],j=w[oe.SENSES]||[],y=w[oe.LANGUAGES]||[],S=`# ${l}

${Wn(c)} ${u}, ${Bt(p)}

**Armor Class**: ${f}
**Hit Points**: ${h}
**Speed**: ${W}
`+(I.length?`**Saving Throws**: ${I.join(", ")}
`:"")+(N.length?`**Skills**: ${N.join(", ")}
`:"")+(j.length?`**Senses**: ${j.join(", ")}
`:"")+(y.length?`**Languages**: ${y.join(", ")}
`:"")+`**Challenge**: ${F}

`+Xn(d,A,k,_,B,H);s.trait&&(S+=`

### Traits
${s.trait.map(it).join(`

`)}`),s.action&&(S+=`

### Actions
${s.action.map(it).join(`

`)}`),s.reaction&&(S+=`

### Reactions
${s.reaction.map(it).join(`

`)}`),s.legendary&&(S+=`

### Legendary Actions
${s.legendary.map(it).join(`

`)}`);let m=`---
${P}
---

${S}`;return{path:`${g}/${a}.md`,content:m}})}function rt(e){if(typeof e!="string"||e.length===0)return"";let n=e.trim();return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}var Ns={P:"Piercing",B:"Bludgeoning",S:"Slashing",N:"Necrotic",R:"Radiant",F:"Fire",C:"Cold",L:"Lightning",T:"Thunder",A:"Acid",H:"Healing",U:"Force",V:"Psychic"},Ht={A:"Ammunition",F:"Finesse",H:"Heavy",L:"Light",R:"Reload",S:"Special","2H":"Two-Handed",T:"Thrown",V:"Versatile"},Ue={$C:"Currency",$G:"Gem",A:"Ammunition","AIR|DMG":"Vehicle (air)","AF|DMG":"Future Ammo",AT:"Artisan Tools",EXP:"Explosive",FD:"Food and Drink",G:"Gear",GS:"Game",HA:"Heavy Armor","IDG|TDCSR":"Illicit Drug",INS:"Instrument",LA:"Light Armor",M:"Weapon",MA:"Medium Armor",MNT:"Mounts and Vehicles",ODH:"Miscellaneous",P:"Consumable",R:"Ranged Weapon",RD:"Rod",RG:"Ring",S:"Shield",SC:"Scroll",SCF:"Spell Casting Focus",SHP:"Ship",T:"Tool",TAH:"Mounts and Vehicles",TG:"Trade Goods",VEH:"Mounts and Vehicles",WD:"Wand"},Qn={A:"Weapons and Armor/Ammunition",M:"Weapons and Armor/Weapons",R:"Weapons and Armor/Ranged Weapons",S:"Weapons and Armor/Shields",LA:"Weapons and Armor/Armor/Light Armor",MA:"Weapons and Armor/Armor/Medium Armor",HA:"Weapons and Armor/Armor/Heavy Armor",EXP:"Weapons and Armor/Weapons/Explosives",AF:"Weapons and Armor/Ammunition/Future Ammo",RD:"Magical Items/Rods",RG:"Magical Items/Rings",SC:"Magical Items/Scrolls",SCF:"Magical Items/Spell Casting Focus",WD:"Magical Items/Wands",$G:"Valuables/Gems",C:"Valuables/Currency",TG:"Valuables/Trade Goods",AT:"Artisan Goods/Tools",T:"Artisan Goods/Tools",INS:"Artisan Goods/Instruments",GS:"Artisan Goods/Games",G:"Gear",MNT:"Gear/Mounts and Vehicles",TAH:"Gear/Mounts and Vehicles",VEH:"Gear/Mounts and Vehicles",AIR:"Gear/Mounts and Vehicles/Air",P:"Consumables",FD:"Consumables/Food and Drink",IDG:"Gear/Illicit Drugs",ODH:"Gear/Miscellaneous"};function _s(e,n){let t=[];if(Array.isArray(e.baseitem)&&t.push(...e.baseitem),Array.isArray(e.item)&&t.push(...e.item),Array.isArray(e.object)&&t.push(...e.object),Array.isArray(e.vehicle)&&t.push(...e.vehicle),!t.length)return[];let r=new Set(Array.isArray(e.baseitem)?e.baseitem.map(o=>o.name):[]),i=[];for(let o of t){let s=o.name,l=s.replace(/[\/\\:]/g,"-"),a=(o.type||"").split("|")[0].split("|")[0].replace(/^\$/,""),c=Qn[a]??"Miscellaneous";if(o.bonusWeapon)c=`${c}/Variants`;else if(!!o.wondrous||!!o.reqAttune||!!o.req_attune||String(o.rarity).toLowerCase().includes("magic")){let[,...k]=c.split("/");c=["Magical Items",...k].join("/")}(c.startsWith("Weapons and Armor/Weapons")||c.startsWith("Weapons and Armor/Ranged Weapons"))&&o.weaponCategory&&(c=`${c}/${rt(o.weaponCategory)}`),e._editionId=n;let p=fe(o,Kt);a==="M"&&o.weaponCategory?p.type=`${rt(o.weaponCategory)} Weapon`:Ue[a]&&(p.type=Ue[a]),Array.isArray(p.damageTypes)&&(p.damageTypes=p.damageTypes.map(A=>Ns[A]||A));let u=he(p,Kt);if(Array.isArray(o.packContents)){u+=`
packContents:`;for(let A of o.packContents)u+=`
  - item: "${A.item}"
    quantity: ${A.quantity}`}let f=`---
${u}
---`,h=[];h.push(`# ${s}`),h.push("");let F=o.weapon?`${rt(o.weaponCategory)} Weapon`:o.armor?c.split("/").pop()||"Armor":"";if(F&&h.push(`### *${F}*`),o.weapon){h.push(`**Category**: ${rt(o.weaponCategory)}`),h.push(`**Damage**: ${o.dmg1??""}${o.dmg2?` / ${o.dmg2}`:""}`);let A=(Array.isArray(o.dmgType)?o.dmgType:[o.dmgType]).filter(k=>!!k).map(k=>Ns[k]||k);if(h.push(`**Damage Type**: ${A.join(", ")}`),h.push(`**Range**: ${o.range??"\u2014"}`),h.push(`**Reload**: ${o.reload??"\u2014"}`),o.ammoType&&h.push(`**Ammo Type**: ${o.ammoType}`),Array.isArray(o.property)&&o.property.length){let k=o.property.map(_=>Ht[_]||_);h.push(`**Properties**: ${k.join(", ")}`)}}o.armor&&(h.push(`**Armor Class**: ${o.ac}`),o.stealth&&h.push("**Stealth Disadvantage**: true"),h.push(""));let M=o.entries??o.desc;if(M){for(let A of Array.isArray(M)?M:[M])if(typeof A=="string"){for(let k of x(A).split(`
`))h.push(k);h.push("")}else if(A&&typeof A=="object"){h[h.length-1]===""&&h.pop(),h.push(`#### ${A.name}`);let k=Array.isArray(A.entries)?A.entries:[];for(let _ of k)for(let B of x(_).split(`
`))h.push(B);h.push("")}}let d=h.join(`
`);i.push({path:`Items/${c}/${l}.md`,content:`${f}

${d}`})}return i.sort((o,s)=>o.path.localeCompare(s.path))}function ie(e){return typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1)}var Jn={str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"},qe={T:"Tiny",S:"Small",M:"Medium",L:"Large",H:"Huge",G:"Gargantuan"},oe={ABILITY_BONUSES:"ability_bonuses",AC:"AC",ALIGNMENT:"Alignment",AMMO_TYPE:"Ammo Type",ARMOR_PROFICIENCIES:"armor-prof",ATTACK_TYPE:"attack_type",ATTUNEMENT:"Attunement",ATTUNE_REQ:"Attune_Req",CASTING_TIME:"casting_time",CHARISMA:"charisma",CHA_MOD:"cha_mod",CONCENTRATION:"concentration",CONDITION_IMM:"cond_immunity",CONSTITUTION:"constitution",CON_MOD:"con_mod",COST:"cost",COMPONENTS:"Components",CHALLENGE_RATING:"CR",DAMAGE_TYPE:"damage_type",DAMAGE_TYPES:"damageTypes",DAMAGE:"damage",DAMAGE_RES:"dmg_resistance",DAMAGE_IMM:"dmg_immunity",DEXTERITY:"dexterity",DEX_MOD:"dex_mod",DURATION:"duration",RULESET:"ruleset",HP:"HP",INTELLIGENCE:"intelligence",INT_MOD:"int_mod",LANGUAGES:"languages",LEVEL:"level",MAGICAL:"magical",MATERIAL:"material",NAME:"name",PROPERTIES:"properties",RANGE:"range",RARITY:"rarity",RELOAD:"reload",RITUAL:"ritual",SAVE:"save",SAVING_THROWS:"saving_throws",SCHOOL:"school",SENSES:"senses",SIZE:"size",SKILLS:"skills",SKILL_CHOICE_LIST:"skill_choice_list",SOMATIC:"somatic",SOURCE:"source",SPECIES:"species",SPEED:"speed",SPELL_CAST_MOD:"Spell Cast Mod",SPELL_RANGE:"Range",STEALTH_DISADVANTAGE:"stealthDisadvantage",STRENGTH:"strength",STR_MOD:"str_mod",SUBRACES:"subraces",TOOL_PROFICIENCIES:"tool-prof",TOOL_CHOICE_LIST:"tool_choice_list",TRAITS:"traits",TYPE:"type",VARIANT:"Variant",VERBAL:"verbal",WEAPON_PROFICIENCIES:"weapon-prof",WEIGHT:"weight",WISDOM:"wisdom",WIS_MOD:"wis_mod"},Zn=e=>Array.isArray(e?.armor)?e.armor.map(ie):Array.isArray(e)?e.map(ie):[];function Wt(e){let n=Array.isArray(e?.weapons)?e.weapons:Array.isArray(e)?e:[],t=new Set;function r(i){if(Array.isArray(i)){i.forEach(r);return}if(typeof i=="string"){let o=i.trim().toLowerCase();if(o==="simple")t.add("Simple Weapons");else if(o==="martial")t.add("Martial Weapons");else{let s=i.startsWith("{@")?x(i):ie(i);t.add(s)}return}if(i&&typeof i=="object"&&i.proficiency){let o=ie(i.proficiency);t.add(i.optional?`${o} (optional)`:o)}}return n.forEach(r),[...t]}var ei=e=>Array.isArray(e)?e.map(n=>({str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"})[n]??n.toUpperCase()):typeof e=="object"&&e!==null?Object.keys(e).map(n=>n.toUpperCase()):[],ot=e=>{if(e&&!Array.isArray(e)&&typeof e=="object"&&Object.values(e).every(t=>typeof t=="string"||typeof t=="number"))return Object.entries(e).map(([t,r])=>`${ie(t)} ${r}`.trim());if(e&&!Array.isArray(e)&&typeof e=="object"){let t=e.skills??e.skillProf??e.skillProficiencies;return ot(t)}if(!Array.isArray(e))return[];let n=new Set;for(let t of e){if(t&&typeof t=="object"&&typeof t.any=="number"){n.add(`Choose ${t.any}`);continue}if(t&&typeof t=="object"&&t.choose){let r=t.choose.count??1;n.add(`Choose ${r}`)}if(t&&typeof t=="object")for(let[r,i]of Object.entries(t))i===!0&&n.add(ie(r));typeof t=="string"&&n.add(ie(t))}return[...n]},qt=e=>{let n=Array.isArray(e)?e:Array.isArray(e?.toolProficiencies)?e.toolProficiencies:Array.isArray(e?.tools)?e.tools:[],t=new Set,r=!1;for(let i of n){if(typeof i=="string"){t.add(ie(i));continue}if(i?.choose){let o=i.choose.count??1;r=!0,t.add(`Choose ${o}`)}for(let[o,s]of Object.entries(i))if(s===!0)t.add(ie(o));else if(typeof s=="number"&&o.startsWith("any")){let a=o.replace(/^any/,"").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(ie).join(" ");t.add(`Choose ${s} ${a}`)}}return[...t]},je=[{callSign:"NAME",jsonKey:"name"},{callSign:"SOURCE",jsonKey:["source"],conv:(e,n)=>{let t=new Set,r=n._editionId;(Array.isArray(e)?e:[e]).forEach(o=>{t.add(Pe(o,r))});for(let o of n.otherSources??[])o&&typeof o.source=="string"&&t.add(Pe(o.source,r));for(let o of n.reprintedAs??[]){let l=(typeof o=="string"?o:String(o)).split("|"),a=l[1]??l[0];t.add(Pe(a,r))}return[...t]}},{callSign:"ARMOR_PROFICIENCIES",jsonKey:["armorProficiencies","armorProfs","startingProficiencies"],conv:Zn},{callSign:"WEAPON_PROFICIENCIES",jsonKey:["weaponProficiencies","weaponProfs","startingProficiencies"],conv:Wt},{callSign:"TOOL_PROFICIENCIES",jsonKey:["toolProficiencies","toolProfs","startingProficiencies"],conv:qt},{callSign:"TOOL_CHOICE_LIST",jsonKey:["toolProficiencies","toolProfs","startingProficiencies"],conv:e=>(Array.isArray(e)?e:Array.isArray(e?.toolProficiencies)?e.toolProficiencies:Array.isArray(e?.tools)?e.tools:[]).find(r=>r?.choose)?.choose?.from?.map(r=>ie(r))??[]},{callSign:"SAVING_THROWS",jsonKey:["save","proficiency"],conv:ei},{callSign:"SKILLS",jsonKey:["skill","skillProf","skillProficiencies","startingProficiencies"],conv:ot},{callSign:"SKILL_CHOICE_LIST",jsonKey:["skill","skillProf","skillProficiencies","startingProficiencies"],conv:e=>{let t=(Array.isArray(e)?e:Array.isArray(e?.skillProficiencies)?e.skillProficiencies:Array.isArray(e?.skills)?e.skills:Array.isArray(e?.skillProf)?e.skillProf:[]).find(r=>r?.choose||typeof r.any=="number");return t?t.choose&&Array.isArray(t.choose.from)?t.choose.from.map(ie):typeof t.any=="number"?zt:[]:[]}},{callSign:"SPELL_CAST_MOD",jsonKey:"spellcastingAbility",conv:e=>{let n=String(e).toLowerCase();return Jn[n]||n.toUpperCase()}},{callSign:"LEVEL",jsonKey:"level"},{callSign:"SCHOOL",jsonKey:"school",conv:e=>Zt[e]??e},{callSign:"CASTING_TIME",jsonKey:"time",conv:ts},{callSign:"SPELL_RANGE",jsonKey:"range",conv:es},{callSign:"DURATION",jsonKey:"duration",conv:ss},{callSign:"VERBAL",jsonKey:"components",conv:e=>!!e.v},{callSign:"SOMATIC",jsonKey:"components",conv:e=>!!e.s},{callSign:"MATERIAL",jsonKey:"components",conv:e=>!!e.m},{callSign:"COMPONENTS",jsonKey:"components",conv:e=>e.m?(Array.isArray(e.m)?e.m:[e.m]).map(t=>typeof t=="string"?t:t&&typeof t=="object"&&typeof t.text=="string"?t.text:null).filter(t=>t!==null):[]},{callSign:"ATTACK_TYPE",jsonKey:"attackType"},{callSign:"DAMAGE_TYPE",jsonKey:"damageInflict",conv:e=>Array.isArray(e)?e[0]:e},{callSign:"RITUAL",jsonKey:"ritual"},{callSign:"CONCENTRATION",jsonKey:"duration",conv:e=>Array.isArray(e)&&e.some(n=>n.concentration)},{callSign:"SAVE",jsonKey:"saveAttr"},{callSign:"SPECIES",jsonKey:"name"},{callSign:"SIZE",jsonKey:"size",conv:e=>Array.isArray(e)?e.map(n=>qe[n]||n):qe[e]||e},{callSign:"SPEED",jsonKey:"speed",conv:e=>typeof e=="number"?[`Walk ${e} ft.`]:!e||typeof e!="object"?[]:Object.entries(e).filter(([n])=>n!=="canHover").map(([n,t])=>{let r=typeof t=="object"&&t!==null&&"number"in t?t.number:t;return`${n==="walk"?"Walk":ie(n)} ${r} ft.`})},{callSign:"LANGUAGES",jsonKey:["languages","languageProficiencies"],conv:e=>{if(!Array.isArray(e))return[];let n=[];for(let t of e)if(typeof t=="string")n.push(ie(t));else if(typeof t=="object")for(let[r,i]of Object.entries(t))i&&n.push(ie(r));return[...new Set(n)]}},{callSign:"SENSES",jsonKey:"senses",conv:e=>Array.isArray(e)?e.map(n=>n.replace(/^\d+\s*/,"").replace(/^./,t=>t.toUpperCase())):e&&typeof e=="object"?Object.entries(e).map(([n,t])=>`${n.charAt(0).toUpperCase()+n.slice(1)} ${t}`):[]},{callSign:"TRAITS",jsonKey:["classFeatures","entries"],conv:(e,n)=>{let t=Array.isArray(n.class)?n.class[0]:n,r=typeof t.name=="string"?t.name:"",i=new Set(["Ability Score Improvement","Archetype Feature","Subclass Feature"]),o=new Set;if(Array.isArray(n.classFeatures))return n.classFeatures.flatMap(a=>{if(a&&typeof a=="object"&&a.gainSubclassFeature)return[];let p=(typeof a=="string"?a:typeof a.classFeature=="string"?a.classFeature:"").split("|")[0].trim();if(!p||i.has(p)||o.has(p))return[];o.add(p);let u=p.replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim().replace(/\b\w/g,f=>f.toUpperCase());return`[[${r}#${u}|${p}]]`});let s=Array.isArray(e)?e:[],l=s.filter(a=>a?.data?.isFeature&&typeof a.name=="string").map(a=>a.name.replace(/^Feature:\s*/,"").trim());return l.length?l:s.filter(a=>a&&typeof a.name=="string").map(a=>a.name.replace(/^Feature:\s*/,"").trim())}},{callSign:"AC",jsonKey:"ac",conv:e=>Array.isArray(e)?e[0].ac:e},{callSign:"HP",jsonKey:"hp",conv:e=>e?.average??e},{callSign:"CHALLENGE_RATING",jsonKey:"cr"},{callSign:"STRENGTH",jsonKey:"ability",conv:e=>Array.isArray(e)?e[0]:e?.str??0},{callSign:"DEXTERITY",jsonKey:"ability",conv:e=>Array.isArray(e)?e[1]:e?.dex??0},{callSign:"CONSTITUTION",jsonKey:"ability",conv:e=>Array.isArray(e)?e[2]:e?.con??0},{callSign:"INTELLIGENCE",jsonKey:"ability",conv:e=>Array.isArray(e)?e[3]:e?.int??0},{callSign:"WISDOM",jsonKey:"ability",conv:e=>Array.isArray(e)?e[4]:e?.wis??0},{callSign:"CHARISMA",jsonKey:"ability",conv:e=>Array.isArray(e)?e[5]:e?.cha??0},{callSign:"ALIGNMENT",jsonKey:"alignment",conv:e=>{let t=(Array.isArray(e)?e.join(" "):typeof e=="string"?e:String(e)).replace(/\bA\b/g,"Any").replace(/\bU\b/g,"Unaligned").replace(/\bN\b/g,"Neutral").replace(/\bL\b/g,"Lawful").replace(/\bC\b/g,"Chaotic").replace(/\bG\b/g,"Good").replace(/\bE\b/g,"Evil");return Bt(t)}},{callSign:"TYPE",jsonKey:"type",conv:e=>{if(typeof e=="string")return Ue[e]??ie(e);if(e&&typeof e=="object"){let n=String(e.type||"").toUpperCase();if(Ue[n])return Ue[n];let t=e.type?ie(e.type):"Unknown",r=Array.isArray(e.tags)?e.tags.map(ie):[];return r.length?`${t} (${r.join(", ")})`:t}}},{callSign:"TYPE",jsonKey:"_parsedType"},{callSign:"RARITY",jsonKey:"rarity",conv:e=>{let n=String(e||"").toLowerCase();return n&&n!=="none"?n[0].toUpperCase()+n.slice(1):void 0}},{callSign:"COST",jsonKey:"value",conv:e=>{let n=String(e).trim().toLowerCase(),t;return n.endsWith("cp")?(t=parseFloat(n),t>=100?`${Math.round(t/100*100)/100}gp`:`${t}cp`):n.endsWith("sp")?(t=parseFloat(n),t>=10?`${Math.round(t/10*100)/100}gp`:`${t}sp`):n.endsWith("gp")?(t=parseFloat(n),`${Math.round(t*100)/100}gp`):(t=parseFloat(n)||0,t>=100?`${Math.round(t/100*100)/100}gp`:`${t}cp`)}},{callSign:"WEIGHT",jsonKey:"weight"},{callSign:"MAGICAL",jsonKey:"wondrous",conv:(e,n)=>!!n.wondrous||!!n.reqAttune},{callSign:"VARIANT",jsonKey:"bonusWeapon",conv:e=>typeof e=="string"&&e.startsWith("+")},{callSign:"PROPERTIES",jsonKey:"property",conv:e=>Array.isArray(e)?e.map(n=>Ht[n]||n):[]},{callSign:"DAMAGE",jsonKey:"dmg1",conv:(e,n)=>e?n.dmg2?`${e} / ${n.dmg2}`:`${e}`:void 0},{callSign:"DAMAGE_TYPES",jsonKey:"dmgType",conv:e=>e==null?[]:Array.isArray(e)?e:[e]},{callSign:"RANGE",jsonKey:"range"},{callSign:"RELOAD",jsonKey:"reload"},{callSign:"AMMO_TYPE",jsonKey:"ammoType"},{callSign:"STEALTH_DISADVANTAGE",jsonKey:"stealth"},{callSign:"ATTUNEMENT",jsonKey:["wondrous","reqAttune","req_attune","reqAttuneTags"],conv:(e,n)=>{let t=n,r=typeof t.reqAttune=="string"&&t.reqAttune.trim()!=="",i=Array.isArray(t.reqAttuneTags)&&t.reqAttuneTags.length>0;return r||i}},{callSign:"ATTUNE_REQ",jsonKey:"reqAttuneTags",conv:(e=[],n)=>{let t={A:"Any",U:"Unaligned",N:"Neutral",L:"Lawful",C:"Chaotic",G:"Good",E:"Evil"},r=[];for(let i of e)if(i.class&&Array.isArray(i.alignment)){let o=ie(i.class);for(let s of i.alignment)r.push(`${t[s]||s} ${o}`)}else if(i.class)r.push(ie(i.class));else if(Array.isArray(i.alignment))for(let o of i.alignment)r.push(t[o]||o);else if(i.background){let[o]=String(i.background).split("|");r.push(o.split(" ").map(ie).join(" "))}else i.spellcasting&&r.push("Spellcaster");return Array.from(new Set(r))}},{callSign:"DAMAGE_RES",jsonKey:"resist",conv:e=>Array.isArray(e)?e.map(ie):[]},{callSign:"RULESET",jsonKey:"name",conv:(e,n)=>"D&D 5e (2025)"},{callSign:"STR_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].str??0:e.str??0;return n!==0?n:void 0}},{callSign:"DEX_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].dex??0:e.dex??0;return n!==0?n:void 0}},{callSign:"CON_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].con??0:e.con??0;return n!==0?n:void 0}},{callSign:"INT_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].int??0:e.int??0;return n!==0?n:void 0}},{callSign:"WIS_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].wis??0:e.wis??0;return n!==0?n:void 0}},{callSign:"CHA_MOD",jsonKey:"ability",conv:e=>{let n=Array.isArray(e)?e[0].cha??0:e.cha??0;return n!==0?n:void 0}}];function fe(e,n){let t={};for(let{callSign:r,jsonKey:i,conv:o}of n){let s=Array.isArray(i)?i:[i],l;for(let c of s)if(e[c]!=null){l=e[c];break}if(l==null)continue;let a=o?o(l,e):l;t[oe[r]]=a}return t}function he(e,n){let t={},r=Array.isArray(e[oe.SKILL_CHOICE_LIST])&&e[oe.SKILL_CHOICE_LIST].length>0,i=Array.isArray(e[oe.TOOL_CHOICE_LIST])&&e[oe.TOOL_CHOICE_LIST].length>0;for(let[s,l]of Object.entries(e))l!==void 0&&(s===oe.COMPONENTS&&Array.isArray(l)&&l.length===0||(s===oe.TOOL_CHOICE_LIST||s===oe.SKILL_CHOICE_LIST)&&Array.isArray(l)&&l.length===0||(t[s]=l));let o;return n?(o=n.map(l=>oe[l.callSign]).filter(l=>l in t),o.push(...Object.keys(t).filter(l=>!o.includes(l)))):o=Object.keys(t),o.map(s=>{let l=t[s];if(Array.isArray(l)){let a=l.map(c=>JSON.stringify(c)).join(", ");return`${s}: [${a}]`}return typeof l=="string"?`${s}: "${l}"`:`${s}: ${l}`}).join(`
`)}var zt=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"];var ti=["NAME","LEVEL","SCHOOL","CASTING_TIME","SPELL_RANGE","DURATION","VERBAL","SOMATIC","MATERIAL","COMPONENTS","CONCENTRATION","SOURCE","RULESET"],si=["SPECIES","SIZE","SPEED","LANGUAGES","TRAITS","SKILLS","STR_MOD","DEX_MOD","CON_MOD","INT_MOD","WIS_MOD","CHA_MOD","SKILL_CHOICE_LIST","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","WEAPON_PROFICIENCIES","SENSES","DAMAGE_RES","SOURCE","RULESET"],ni=["NAME","TYPE","RARITY","COST","WEIGHT","PROPERTIES","DAMAGE","DAMAGE_TYPES","RANGE","RELOAD","AMMO_TYPE","AC","STEALTH_DISADVANTAGE","MAGICAL","ATTUNEMENT","ATTUNE_REQ","SOURCE","RULESET"],ii=["NAME","SIZE","TYPE","ALIGNMENT","AC","HP","SPEED","STRENGTH","DEXTERITY","CONSTITUTION","INTELLIGENCE","WISDOM","CHARISMA","SAVING_THROWS","SKILLS","SENSES","LANGUAGES","CHALLENGE_RATING","SOURCE","RULESET"],ri=["NAME","SPELL_CAST_MOD","ARMOR_PROFICIENCIES","WEAPON_PROFICIENCIES","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","SAVING_THROWS","SKILLS","SKILL_CHOICE_LIST","TRAITS","SOURCE","RULESET"],oi=["NAME","SKILLS","SKILL_CHOICE_LIST","TOOL_PROFICIENCIES","TOOL_CHOICE_LIST","TRAITS","SOURCE","RULESET"],ai=["SOURCE","RULESET"],Yt=ti.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for SPELL_KEY ${e}`);return n}),ze=si.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for SPECIES_KEY ${e}`);return n}),Kt=ni.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for ITEM_KEY ${e}`);return n}),Vt=ii.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BESTIARY_KEY ${e}`);return n}),Xt=ri.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for CLASS_KEY ${e}`);return n}),Qt=oi.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BACKGROUND_KEY ${e}`);return n}),Jt=ai.map(e=>{let n=je.find(t=>t.callSign===e);if(!n)throw new Error(`Missing FieldDef for BACKGROUND_KEY ${e}`);return n});var Zt={A:"Abjuration",C:"Conjuration",D:"Divination",E:"Enchantment",V:"Evocation",I:"Illusion",N:"Necromancy",T:"Transmutation"};function li(e){return`${e}${e===1?"st":e===2?"nd":e===3?"rd":"th"}`}function es(e){if(!e)return"";if(typeof e=="string")return e;if(e.type==="special")return"Special";if(e.type==="point"&&e.distance){let n=e.distance;if(n.type==="touch")return"Touch";if(n.type==="self")return"Self";if(n.type==="sight")return"Sight";if(n.amount)return`${n.amount} ${n.type}`}return"Varies"}function ts(e){return Array.isArray(e)?e.map(n=>`${n.number} ${n.unit}`).join(", "):""}function ss(e){return Array.isArray(e)?e.map(n=>n.type==="instant"?"Instantaneous":n.type==="timed"&&n.duration?`${n.duration.amount} ${n.duration.type}${n.concentration?" (concentration)":""}`:n.type==="permanent"?"Permanent":"Special").join(", "):""}function ci(e){if(!e)return"";let n=[];if(e.v&&n.push("V"),e.s&&n.push("S"),e.m){let t=[];Array.isArray(e.m)?t=e.m.map(i=>typeof i=="string"?i:i&&typeof i.text=="string"?i.text:null).filter(i=>!!i):typeof e.m=="string"?t=[e.m]:e.m.text&&(t=[e.m.text]);let r=t.length>0?`M (${t.join(", ")})`:"M";n.push(r)}return n.join(", ")}function Gs(e,n){return e.spell?(e._editionId=n,e.spell.map(t=>{let r=t.source?Array.isArray(t.source)?t.source:[t.source]:["unknown"],i=t.name,o=Zt[t.school]??t.school,s=t.level,l=es(t.range),a=ts(t.time),c=ss(t.duration),p=r.map(C=>Pe(C,n)),u=t.attackType||"",f=t.damageInflict?.[0]||"Teleportation",h=t.ritual===!0,F=t.duration?.some(C=>C.concentration)??!1,M=fe(t,Yt),d=he(M,Yt),A=i.replace(/\//g,"-"),k=`# ${i}`,B=`### *${s===0?`${o} Cantrip`:`${li(s)}-level ${o} Spell`}*${F?" *(Concentration)*":""}`,H=[k,B,`**Casting Time:** ${a}`,`**Range:** ${l}`,`**Components:** ${ci(t.components)}`,`**Duration:** ${c}`],K=[...(t.entries??[]).map(C=>ne(C)),...(t.entriesHigherLevel??[]).map(C=>ne(C))],W=["---",`**Source:** ${p.join(", ")}`];return{path:`${A}.md`,content:[`---
${d}
---`,H.join(`
`),"",K.join(`

`),"",W.join(`
`)].join(`
`)}})):[]}function Us(e){return e.replace(/;/g,":").replace(/[\/:"]/g,":").trim()}var pi=["Age","Size","Languages","Creature Type","Speed"];function Vs(e,n){if(!Array.isArray(e.race))return[];e._editionId=n;let t=e.race.filter(s=>(s.basicRules===!0||s.basicRules2024===!0)&&!/\((?:Kaladesh|Zendikar|Amonkhet|Innistrad|Ixalan)\)$/.test(s.name)),r=new Map;for(let s of t){let l=r.get(s.name)??[];l.push(s),r.set(s.name,l)}let i=Array.isArray(e.subrace)?e.subrace:[],o=[];for(let[s,l]of r.entries()){let a=Us(s),c=l.reduce((C,g)=>Object.keys(g).length>Object.keys(C).length?g:C,l[0]);if(!c.ability){let C=i.find(g=>g.raceName===s&&g.raceSource===c.source&&!("name"in g)&&Array.isArray(g.ability));C&&(c.ability=C.ability)}let p=fe(c,ze),u=[];c.darkvision&&u.push(`Darkvision ${c.darkvision} ft.`),c.blindsight&&u.push(`Blindsight ${c.blindsight} ft.`),c.tremorsense&&u.push(`Tremorsense ${c.tremorsense} ft.`),c.truesight&&u.push(`Truesight ${c.truesight} ft.`),u.length&&(p.senses=u),Array.isArray(p.traits)&&(p.traits=p.traits.filter(C=>!pi.includes(C)));let f=he(p,ze),h=[];h.push(`# ${s}`,"## Stats");let F=Array.isArray(c.size)?c.size.map(C=>qe[C]||C).join("/"):qe[c.size]??c.size;h.push(`**Size:** ${F}`);let M=typeof c.speed=="number"?c.speed:c.speed?.walk??c.speed?.base??0;h.push(`**Speed:** ${M} ft. walking`);let d=i.filter(C=>C.name&&C.raceName===s&&C.raceSource===c.source),A=Array.isArray(c.ability)?c.ability:Array.isArray(d[0]?.ability)?d[0].ability:[];if(Array.isArray(A)&&A.length){let C={str:0,dex:0,con:0,int:0,wis:0,cha:0},g=null;for(let I of A)if("choose"in I)g=I.choose;else for(let[N,j]of Object.entries(I))C[N]+=j;let P=Object.entries(C).filter(([,I])=>I!==0).map(([I,N])=>`${I.toUpperCase()} ${N>=0?"+":""}${N}`);g?.count&&Array.isArray(g.from)&&P.push(`CHOOSE ${g.count} from ${g.from.map(I=>I.toUpperCase()).join(", ")}`),P.length&&h.push(`**Ability Scores:** ${P.join(", ")}`)}let k=p.languages;if(k?.length&&h.push(`**Languages:** ${k.join(", ")}`),Array.isArray(c.skillProficiencies)){let C=[];for(let g of c.skillProficiencies)if(g.choose?.from)C.push(`Choose from: ${g.choose.from.map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(", ")}`);else{let w=g.proficiency??g.name??g;typeof w=="string"&&C.push(w.charAt(0).toUpperCase()+w.slice(1))}C.length&&h.push(`**Skill Proficiencies:** ${C.join("; ")}`)}let _=p[oe.TOOL_PROFICIENCIES],B=p[oe.WEAPON_PROFICIENCIES],H=p[oe.ARMOR_PROFICIENCIES];_?.length&&h.push(`**Tool Proficiencies:** ${_.join(", ")}`),B?.length&&h.push(`**Weapon Proficiencies:** ${B.join(", ")}`),H?.length&&h.push(`**Armor Proficiencies:** ${H.join(", ")}`),h.push("## Traits");let K=new Set;for(let C of p.traits||[]){h.push(`##### ${C}`);let g=c.entries?.find(w=>w.name===C);g?.entries&&g.entries.forEach((w,P)=>{let I;w.type==="table"?I=Te(w):w.type==="list"?I=w.items.map(N=>typeof N=="string"?`- ${x(N)}`:`- ${N.name}`).join(`
`):typeof w=="string"&&(I=x(w)),I&&!K.has(I)&&(h.push(I),K.add(I),g.entries.length>1&&P<g.entries.length-1&&h.push(""))})}let W=d;if(W.length){o.push({path:`Species/${a}/${a}.md`,content:`---
${f}
---

${h.join(`
`)}`});let C=`Species/${a}/Subspecies`;for(let g of W){let P=[`# ${g.name.replace(/;/g,":")}`];if(Array.isArray(g.ability)){let N={str:0,dex:0,con:0,int:0,wis:0,cha:0},j=null;for(let m of g.ability)if("choose"in m)j=m.choose;else for(let[E,D]of Object.entries(m))N[E]+=D;let S=Object.entries(N).filter(([,m])=>m!==0).map(([m,E])=>`${m.toUpperCase()} ${E>=0?"+":""}${E}`);j?.count&&S.push(`CHOOSE ${j.count} from ${j.from.map(m=>m.toUpperCase()).join(", ")}`),S.length&&P.push(`**Ability Scores:** ${S.join(", ")}`)}for(let N of g.entries||[])P.push(ne(N)),P.push("");let I=he(fe(g,ze),ze);o.push({path:`${C}/${Us(g.name)}.md`,content:`---
${I}
---

${P.join(`
`)}`})}}else o.push({path:`Species/${a}.md`,content:`---
${f}
---

${h.join(`
`)}`})}return o.sort((s,l)=>s.path.localeCompare(l.path))}function De(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)&&typeof e.type=="string"}function ui(e){return["Ability Score Improvement","Archetype Feature","Subclass Feature"].some(r=>e.toLowerCase().includes(r.toLowerCase()))?e:`[[#${e.replace(/[^\w\s]/g,"").replace(/-/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,r=>r.toUpperCase())}]]`}var Bs={AI:"Artificer Infusion",ED:"Elemental Discipline",EI:"Eldritch Invocation",MM:"Metamagic",MV:"Maneuver","MV:B":"Maneuver, Battle Master","MV:C2-UA":"Maneuver, Cavalier V2 (UA)","AS:V1-UA":"Arcane Shot, V1 (UA)","AS:V2-UA":"Arcane Shot, V2 (UA)",AS:"Arcane Shot",OTH:"Other","FS:F":"Fighting Style; Fighter","FS:B":"Fighting Style; Bard","FS:P":"Fighting Style; Paladin","FS:R":"Fighting Style; Ranger",PB:"Pact Boon",OR:"Onomancy Resonant",RN:"Rune Knight Rune",AF:"Alchemical Formula",TT:"Traveler's Trick"};function Ks(e,n,t,r){e._editionId=n;let i=Array.isArray(e.class)?e.class[0]:e,o=typeof i.name=="string"?i.name:t?t.replace(/^class-/,"").replace(/\.json$/,""):"Unknown",s=[],l=["+2","+2","+2","+2","+3","+3","+3","+3","+4","+4","+4","+4","+5","+5","+5","+5","+6","+6","+6","+6"],a=i.hd?.number??1,c=i.hd?.faces??6,p=`${a}d${c}`,u=a*c,f=Math.ceil((c+1)/2),F={...fe(i,Xt),hd:p},M=he(F,Xt),d=[];d.push(`# ${o}`),i.source&&d.push(`**Source:** ${i.source}`),d.push(""),d.push("---"),d.push("## Hit Points"),d.push(`**Hit Dice:** ${p} per ${o} level`),d.push(`**Hit Points at 1st Level:** ${u} + your Constitution modifier`),d.push(`**Hit Points at Higher Levels:** ${p} (or ${f}) + your Constitution modifier per level after 1st`),d.push(""),d.push("---"),d.push("## Proficiencies");let A=i.startingProficiencies??{};Array.isArray(A.armor)&&A.armor.length&&d.push(`- **Armor:** ${A.armor.join(", ")}`);let k=Wt(A);k.length&&d.push(`- **Weapons:** ${k.join(", ")}`);let _=qt(A);_.length&&d.push(`- **Tools:** ${_.join(", ")}`);let B=Array.isArray(i.proficiency)?i.proficiency.map(y=>({str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"})[y]||y.toUpperCase()):[];B.length&&d.push(`- **Saving Throws:** ${B.join(", ")}`);{let S=(Array.isArray(A.skillProficiencies)?A.skillProficiencies:Array.isArray(A.skills)?A.skills:Array.isArray(A.skillProf)?A.skillProf:[]).find(m=>m&&(typeof m.choose=="object"||typeof m.any=="number"));if(S){let m=S.choose?.count??S.any??1,E=Array.isArray(S.choose?.from)?S.choose.from.map(D=>D.split(" ").map(L=>L[0].toUpperCase()+L.slice(1)).join(" ")):zt;d.push(`- **Skills (Choose ${m}):** ${E.join(", ")}`)}else{let m=ot(A);m.length&&d.push(`- **Skills:** ${m.join(", ")}`)}}Array.isArray(i.startingEquipment)&&(d.push(`
### Equipment`),i.startingEquipment.filter(y=>typeof y=="string").forEach(y=>d.push(`- ${y}`)));let H=i.classTableGroups??[],K=20;if(!H.length)d.push("*(No class table provided for this class.)*");else{let y={};for(let b of i.classFeatures??[]){let Y=typeof b=="object"&&b.classFeature?b.classFeature:String(b),[$,,,v]=Y.split("|"),T=Number(v??0);y[T]||(y[T]=[]),y[T].push($)}let S=new Set,m={};for(let b of H){let Y=Array.isArray(b.colLabels)?b.colLabels.map(v=>x(v)):[],$=Array.isArray(b.rows)?b.rows:Array.isArray(b.rowsSpellProgression)?b.rowsSpellProgression:[];if(!(!Y.length||!$.length))for(let v=0;v<$.length;v++){let T=v+1;m[T]||(m[T]={});let q=m[T],Q=$[v];for(let V=0;V<Y.length;V++){let J=Y[V],ee="",X=Q[V];Array.isArray(X)?ee=X.join(", "):X&&typeof X=="object"&&"value"in X?ee=String(X.value):ee=String(X??""),S.add(J),q[J]=ee}}}let E=Array.from(S).filter(b=>!/Cantrips Known|Spells Known|\d+(st|nd|rd|th)/.test(b)),D=["Level","Proficiency Bonus","Class Features",...E],L=[];for(let b=1;b<=K;b++){let Y=(y[b]??[]).map(ui),$=m[b]??{};L.push([b.toString(),l[b-1]||"",Y.join(", ").replace(/\|/g,"&#124;"),...E.map(v=>$[v]??"")])}d.push(`
> [!example]- Class Progression Table`),d.push(Te({type:"table",caption:"",colLabels:D,rows:L}))}let W=H.find(y=>Array.isArray(y.colLabels)&&y.colLabels.some(S=>/Cantrips Known|Spells Known/.test(String(S)))),C=H.find(y=>Array.isArray(y.colLabels)&&y.title==="Spell Slots per Spell Level");if(W&&C){let y=W.colLabels.map(b=>x(b)),S=C.colLabels.map(b=>x(b)),m=W.rows||[],E=C.rowsSpellProgression||[],D=["Level",...y,...S],L=[];for(let b=0;b<Math.max(m.length,E.length);b++){let Y=String(b+1),$=m[b]?m[b].map(String):y.map(T=>""),v=E[b]?E[b].map(String):S.map(T=>"");L.push([Y,...$,...v])}d.push(`
> [!tip]- Spell Progression Table`),d.push(Te({type:"table",caption:"",colLabels:D,rows:L}))}let g=Array.isArray(e.subclass)?e.subclass:[],w=Array.isArray(e.subclassFeature)?e.subclassFeature:e.lookup?.subclassFeature??[];for(let y of g){let S=y.name,m=[];m.push(`# ${S}`),m.push(`**Parent Class:** [[${o}]]`),y.source&&m.push(`**Source:** ${y.source}`),m.push("");let E=w.find($=>$.name===y.name&&$.level===3&&$.subclassShortName===y.shortName&&$.subclassSource===y.source);if(E?.entries?.length){let $=Array.isArray(E.entries)?E.entries.map(v=>typeof v=="string"?x(v):ne(v)).join(`

`):ne(E.entries);m.push($,"")}let D=Object.entries(Bs).find(([,$])=>$.toLowerCase().includes(S.toLowerCase()))?.[0];if(D){let $=r.filter(v=>Array.isArray(v.featureType)&&v.featureType.includes(D));if($.length){m.push(`## ${S} Optional Features`);for(let v of $){for(let T of v.entries){let q=typeof T=="string"?x(T):ne(T);m.push(`**${v.name}:** ${q}`)}m.push("")}}}let L=y.subclassTableGroups??[];if(L.length){let $=new Set,v={};for(let q of L){let Q=(q.colLabels??[]).map(x);(Array.isArray(q.rows)?q.rows:Array.isArray(q.rowsSpellProgression)?q.rowsSpellProgression:[]).forEach((J,ee)=>{let X=ee+1;v[X]??(v[X]={}),J.forEach((ae,Le)=>{let de=Q[Le];de&&($.add(de),v[X][de]=typeof ae=="object"&&ae!==null&&"value"in ae?String(ae.value):String(ae??""))})})}let T=Array.from($);m.push("## Subclass Progression"),m.push(Te({type:"table",caption:"",colLabels:["Level",...T],rows:Array.from({length:20},(q,Q)=>{let V=Q+1;return[String(V),...T.map(J=>v[V]?.[J]??"")]})}))}let b={};for(let $ of w)if($.subclassShortName===y.shortName&&$.subclassSource===y.source&&$.className===o){let v=$.level??0;(b[v]??(b[v]=[])).push($)}for(let $ of Object.keys(b).map(Number).sort((v,T)=>v-T)){m.push("---",`## Level ${$}`);for(let v of b[$]){m.push(`### ${v.name}`);for(let T of Array.isArray(v.entries)?v.entries:[v.entries]){if(typeof T=="string"){m.push(x(T));continue}if(De(T)&&T.type==="entries"&&/^Maneuvers$/i.test(T.name)){m.push(`##### ${T.name}`);for(let V of Array.isArray(T.entries)?T.entries:[T.entries])m.push(typeof V=="string"?x(V):ne(V));let Q=Object.entries(Bs).find(([,V])=>V.toLowerCase().includes(S.toLowerCase()))?.[0];if(Q){let V=r.filter(J=>Array.isArray(J.featureType)&&J.featureType.includes(Q));for(let J of V){for(let ee of J.entries){let X=typeof ee=="string"?x(ee):ne(ee);m.push(`**${J.name}:** ${X}`)}m.push("")}}continue}if(De(T)&&T.type==="entries"&&T.name){m.push(`##### ${T.name}`);for(let Q of Array.isArray(T.entries)?T.entries:[T.entries])m.push(ne(Q));continue}if(De(T)&&T.type==="inset"&&T.name){let Q=Array.isArray(T.entries)?T.entries:[T.entries];m.push(`> **${T.name}**`),Q.forEach(V=>m.push(`> ${ne(V)}`));continue}let q=ne(T);q&&m.push(q)}}}let Y=m.join(`

`).replace(/\n{3,}/g,`

`);s.push({path:`Classes/${o}/Subclasses/${S}.md`,content:Y})}if(g.length){let y=g.map(S=>`[[Subclasses/${S.name.replace(/[\\/]/g,"-")}|${S.name}]]`);d.push(`
**Subclasses:** ${y.join(", ")}`)}let P=Array.isArray(e.classFeature)?e.classFeature:e.lookup?.classFeature??[],I={};for(let y of P){if(y.className!==o)continue;let S=y.level??0;I[S]||(I[S]=[]),I[S].push(y)}d.push(""),d.push("---"),d.push("## Level Features");let N=Object.keys(I).map(y=>+y).sort((y,S)=>y-S);for(let y of N){d.push(`### Level ${y}`);for(let S of I[y]){d.push(`#### ${S.name}`);let m=Array.isArray(S.entries)?S.entries:[S.entries];for(let E of m){if(typeof E=="string"){let L=ne(E).trim();if(L==="{"||L==="}")continue;d.push(L);continue}if(De(E)&&E.type==="list"&&Array.isArray(E.items)){for(let L of E.items)d.push(`- ${x(L)}`);continue}if(De(E)&&E.type==="options"){E.count&&(d.push(""),d.push(`**Choose ${E.count} of the following options:**`),d.push(""));for(let L of Array.isArray(E.entries)?E.entries:[E.entries])if(L.type==="refOptionalfeature"){let[b,Y]=L.optionalfeature.split("|"),$=r.find(v=>v.name===b&&(!Y||v.source===Y));$?($.entries.forEach((v,T)=>{let q=typeof v=="string"?x(v):ne(v);T===0?d.push(`- **${$.name}:** ${q}`):d.push(`  - ${q}`)}),d.push("")):d.push(`**${b}:**`)}else{let b=ne(L);b&&d.push(`- ${b}`)}continue}if(De(E)&&E.type==="refOptionalfeature"){let[L]=E.optionalfeature.split("|");d.push(`- [[${L}|${L}]]`);continue}if(De(E)&&E.type==="entries"&&E.name){d.push(`##### ${E.name}`);let L=Array.isArray(E.entries)?E.entries:[E.entries];for(let b of L)d.push(ne(b));continue}let D=ne(E);D&&d.push(D)}d.push("")}d.push("---")}let j=`---
${M}
---

${d.join(`
`)}`;return j=x(j),j=j.replace(/\n{3,}/g,`

`).replace(/\n +\n/g,`

`),[{path:`Classes/${o}/${o}.md`,content:j},...s]}function Hs(e,n){if(!Array.isArray(e.action))return[];let t=[];function r(o){if(!o)return;if(typeof o=="string"){for(let l of o.split(/\n{2,}/)){let a=l.trim();a&&(t.push(x(a)),t.push(""))}return}if(o.type==="list"&&Array.isArray(o.items)){for(let l of o.items)t.push(`- ${x(l)}`);t.push("");return}if(o.type==="table"&&Array.isArray(o.rows)){let l=o.colLabels||[];t.push(`| ${l.join(" | ")} |`),t.push(`| ${l.map(()=>"---").join(" | ")} |`);for(let a of o.rows)t.push(`| ${a.join(" | ")} |`);t.push("");return}if((o.type==="entries"||o.type==="inset")&&Array.isArray(o.entries)){o.name&&(t[t.length-1]===""&&t.pop(),t.push(`### ${o.name}`));for(let l of o.entries)r(l);return}let s=Array.isArray(o)?o.join(" "):typeof o=="object"?JSON.stringify(o):String(o);t.push(x(s)),t.push("")}for(let o of e.action){t.push(`## ${o.name}`);for(let s of Array.isArray(o.entries)?o.entries:[o.entries])r(s);if(Array.isArray(o.seeAlsoAction)){t.push("**See Also:**"),t.push("");for(let s of o.seeAlsoAction){let[l]=String(s).split("|");t.push(`- [[${l}]]`)}t.push("")}t.push("---")}return[{path:"Rules and Reference/Actions.md",content:t.reduce((o,s)=>s===""&&o.length&&o[o.length-1]===""?o:o.concat(s),[]).join(`
`).trim()+`
`}]}function Ws(e,n){let t=[],r=(i,o)=>{let s=[];for(let a of i){s.push(`## ${a.name}`);let c=Array.isArray(a.entries)?a.entries:[a.entries];for(let p of c)if(p)if(typeof p=="string")for(let u of p.split(/\n{2,}/)){let f=u.trim();f&&(s.push(x(f)),s.push(""))}else if(p.type==="list"&&Array.isArray(p.items)){for(let u of p.items)s.push(`- ${x(u)}`);s.push("")}else if(p.type==="table"&&Array.isArray(p.rows)){let u=p.colLabels||[];s.push(`| ${u.join(" | ")} |`),s.push(`| ${u.map(()=>"---").join(" | ")} |`);for(let f of p.rows)s.push(`| ${f.join(" | ")} |`);s.push("")}else if(p.type==="entries"&&Array.isArray(p.entries))if(p.name){s.push(`### ${p.name}`);for(let u of p.entries)if(u.type==="entries"&&u.name&&Array.isArray(u.entries)){s[s.length-1]===""&&s.pop(),s.push(`#### ${u.name}`);for(let f of u.entries){let h=typeof f=="string"?x(f):x(String(f));s.push(h),s.push("")}}else typeof u=="string"&&(s.push(x(u)),s.push(""))}else for(let u of p.entries)if(u.type==="entries"&&u.name&&Array.isArray(u.entries)){s[s.length-1]===""&&s.pop(),s.push(`### ${u.name}`);for(let f of u.entries){let h=typeof f=="string"?x(f):x(String(f));s.push(h),s.push("")}}else typeof u=="string"&&(s.push(x(u)),s.push(""));else{let u=Array.isArray(p)?p.join(" "):typeof p=="object"?JSON.stringify(p):String(p);s.push(x(u)),s.push("")}s.push("---")}let l=s.reduce((a,c)=>c===""&&a.length&&a[a.length-1]===""?a:a.concat(c),[]);t.push({path:o,content:l.join(`
`).trim()+`
`})};return r(e.condition||[],"Rules and Reference/Conditions.md"),r(e.disease||[],"Rules and Reference/Diseases.md"),t}function qs(e,n){let t=Array.isArray(e.sense)?e.sense:Array.isArray(e.senses)?e.senses:[];if(!t.length)return[];let r=[];function i(s){if(!s)return;if(typeof s=="string"){for(let a of s.split(/\n{2,}/)){let c=a.trim();c&&(r.push(x(c)),r.push(""))}return}if(s.type==="list"&&Array.isArray(s.items)){for(let a of s.items)if(typeof a=="string")r.push(`- ${x(a)}`),r.push("");else if(a&&typeof a=="object")if(a.name&&Array.isArray(a.entries)){r.push(`- **${a.name}**`);for(let c of a.entries)r.push(`  - ${x(c)}`);r.push("")}else r.push(`- ${x(JSON.stringify(a))}`),r.push("");return}if(s.type==="table"&&Array.isArray(s.rows)){let a=s.colLabels||[];r.push(`| ${a.join(" | ")} |`),r.push(`| ${a.map(()=>"---").join(" | ")} |`);for(let c of s.rows)r.push(`| ${c.join(" | ")} |`);r.push("");return}if((s.type==="entries"||s.type==="inset")&&Array.isArray(s.entries)){s.name&&(r[r.length-1]===""&&r.pop(),r.push(`### ${s.name}`));for(let a of s.entries)i(a);return}let l=Array.isArray(s)?s.join(" "):typeof s=="object"?JSON.stringify(s):String(s);r.push(x(l)),r.push("")}for(let s of t){r.push(`## ${s.name}`);for(let l of Array.isArray(s.entries)?s.entries:[s.entries])i(l);r.push("---")}return[{path:"Rules and Reference/Senses.md",content:r.reduce((s,l)=>l===""&&s.length&&s[s.length-1]===""?s:s.concat(l),[]).join(`
`).trim()+`
`}]}function zs(e,n){let t=Array.isArray(e.skill)?e.skill:Array.isArray(e.skills)?e.skills:[];if(!t.length)return[];let r=[];for(let o of t){r.push(`## ${o.name}`),o.ability&&(r.push(`*Ability: ${o.ability}*`),r.push(""));let s=Array.isArray(o.entries)?o.entries:[o.entries];for(let l of s)if(l)if(typeof l=="string"){let a=l.split(/\n{2,}/);for(let c of a){let p=c.trim();p&&(r.push(x(p)),r.push(""))}}else if(l.type==="list"&&Array.isArray(l.items)){for(let a of l.items)r.push(`- ${x(a)}`);r.push("")}else{let a=Array.isArray(l)?l.join(" "):String(l);r.push(x(a)),r.push("")}r.push("---")}return[{path:"Rules and Reference/Skills.md",content:r.reduce((o,s)=>s===""&&o.length&&o[o.length-1]===""?o:o.concat(s),[]).join(`
`).trim()+`
`}]}function Ys(e,n){return(Array.isArray(e.feat)?e.feat:Array.isArray(e.feats)?e.feats:[]).map(r=>{let i=[],o=fe({...r,_editionId:n},Jt);i.push("---"),i.push(he(o,Jt)),i.push("---",""),i.push(`# ${r.name}`,"");let s=[];return Array.isArray(r.prerequisite)&&r.prerequisite.forEach(a=>{a.level&&s.push(`Level ${a.level}`),Array.isArray(a.feat)&&a.feat.forEach(c=>{let p=c.split("|")[0].replace(/\b\w/g,u=>u.toUpperCase());s.push(`Prerequisite: [[${p}]]`)})}),r.spellcastingPrepared&&s.push("Prerequisite: Spellcaster"),Array.isArray(r.toolProficiencies)&&r.toolProficiencies.forEach(a=>{Object.entries(a).forEach(([c])=>{c==="anyArtisansTool"?s.push("Prerequisite: Proficient with an artisan's tool"):s.push(`Prerequisite: Proficient with ${c.replace(/([A-Z])/g," $1").trim()}`)})}),Array.isArray(r.armorProficiencies)&&r.armorProficiencies.forEach(a=>{let c=typeof a=="string"?a:JSON.stringify(a);s.push(`Prerequisite: Proficient with ${c.replace(/([A-Z])/g," $1").trim()}`)}),r.race&&s.push(`Prerequisite: ${r.race}`),s.length&&(i.push("**Prerequisites**"),s.forEach(a=>i.push(`- ${a}`)),i.push("")),(Array.isArray(r.entries)?r.entries:[r.entries]).forEach(a=>{if(a){if(typeof a=="string")a.split(/\n{2,}/).forEach(c=>{let p=c.trim();p&&(i.push(x(p)),i.push(""))});else if(a.type==="list"&&Array.isArray(a.items))a.items.forEach(c=>{typeof c=="string"?i.push(`- ${x(c)}`):c.type==="item"&&c.name&&(i.push(`- **${c.name}**`),(Array.isArray(c.entries)?c.entries:[c.entries]).forEach(u=>i.push(`  - ${x(typeof u=="string"?u:JSON.stringify(u))}`)))}),i.push("");else if(a.type==="inset")i.push(`- *${a.name}*`),(Array.isArray(a.entries)?a.entries:[a.entries]).forEach(p=>i.push(`  - ${x(p)}`)),i.push("");else if((a.type==="section"||a.type==="entries")&&Array.isArray(a.entries))a.name&&(i.push(`## ${a.name}`),i.push("")),a.entries.forEach(c=>{i.push(x(typeof c=="string"?c:JSON.stringify(c))),i.push("")});else if(a.type==="table"&&Array.isArray(a.rows)){let c=a.colLabels||[];i.push(`| ${c.join(" | ")} |`),i.push(`| ${c.map(()=>"---").join(" | ")} |`),a.rows.forEach(p=>i.push(`| ${p.join(" | ")} |`)),i.push("")}}}),{path:`Player Build/Feats/${r.name}.md`,content:i.join(`
`).trim()+`
`}})}function Qs(e,n){let r=(Array.isArray(e.background)?e.background:Array.isArray(e.backgrounds)?e.backgrounds:[]).filter(o=>{let s=o.name||"";return!s.startsWith("Variant")&&!s.includes("Baldur's Gate")}),i=[];return r.forEach(o=>{let s=[],l=fe(o,Qt),a=Array.isArray(o.entries)?o.entries.filter(p=>p.data?.isFeature&&typeof p.name=="string").map(p=>{let u=p.name.replace(/^Feature:\s*/,"");return`[[${o.name}#${u}]]`}):[],c=he(l,Qt);if(s.push("---",c,"---",""),s.push(`# ${o.name}`,""),Array.isArray(o.skillProficiencies)&&o.skillProficiencies.length){let p=[];o.skillProficiencies.forEach(u=>{typeof u=="string"?p.push(ns(u)):u.choose&&Array.isArray(u.choose.from)?p.push(`Choose ${u.choose.amount} from ${u.choose.from.join(", ")}`):Object.entries(u).filter(([,f])=>f===!0).forEach(([f])=>p.push(ns(f)))}),s.push(`**Skill Proficiencies:** ${p.join(", ")}`,"")}if(Array.isArray(o.languageProficiencies)&&o.languageProficiencies.length){let p=[];o.languageProficiencies.forEach(u=>{u.anyStandard?p.push(`${u.anyStandard} of your choice`):Object.entries(u).filter(([,f])=>f===!0).forEach(([f])=>p.push(ns(f)))}),s.push(`**Languages:** ${p.join(", ")}`,"")}if(Array.isArray(o.toolProficiencies)&&o.toolProficiencies.length){let p=[];o.toolProficiencies.forEach(u=>{if(u.choose&&Array.isArray(u.choose.from)){let f=u.choose.from.map(at).join(", ");p.push(`Choose ${u.choose.count} from ${f}`);return}if(typeof u=="string"){p.push(at(u));return}Object.entries(u).filter(([f,h])=>h===!0).forEach(([f])=>p.push(at(f)))}),s.push(`**Tool Proficiencies:** ${p.join(", ")}`,"")}Array.isArray(o.startingEquipment)&&o.startingEquipment.length&&(s.push("**Equipment:**"),o.startingEquipment.forEach(p=>{Array.isArray(p._)&&p._.forEach(u=>s.push(`- ${Xs(u)}`)),["a","b"].forEach(u=>{Array.isArray(p[u])&&p[u].forEach(f=>s.push(`- ${Xs(f)}`))})}),s.push("")),Array.isArray(o.entries)&&o.entries.forEach(p=>{if(!(p.type==="list"&&p.style==="list-hang-notitle")){if(p.name){let u=p.data?.isFeature?p.name.replace(/^Feature:\s*/,""):p.name;s.push(`## ${u}`,"")}Array.isArray(p.entries)?p.entries.forEach(u=>{if(typeof u=="string")s.push(x(u),"");else if(u.type==="list"&&Array.isArray(u.items))u.items.forEach(f=>s.push(`- ${x(f.entry??f)}`)),s.push("");else if(u.type==="table"){let f=Te(u);f&&s.push(f,"")}}):p.type==="list"&&Array.isArray(p.items)&&(p.items.forEach(u=>s.push(`- ${x(u.entry??u)}`)),s.push(""))}}),i.push({path:`Player Build/Backgrounds/${o.name}.md`,content:s.join(`
`).trimEnd()+`
`})}),i}function ns(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Xs(e){if(typeof e=="string")return e.includes("|")?x(`{@item ${e}}`):x(e);let n=e.containsValue??e.value;if(typeof n=="number"&&!e.item&&!e.equipmentType&&!e.special)return`${n>=100?n/100:n} gp`;if(e.item){let t=x(`{@item ${e.item}}`);if(typeof n=="number"){let r=n>=100?n/100:n;return`${t} (${r} gp)`}return t}if(typeof e.special=="string")return e.special;if(e.equipmentType)switch(e.equipmentType){case"toolArtisan":return"One type of artisan\u2019s tools (of your choice)";case"instrumentMusical":return"One type of musical instrument (of your choice)";case"setGaming":return"One set of gaming dice (of your choice)";default:return at(e.equipmentType)}return x(JSON.stringify(e))}function at(e){let n=e.replace(/([a-z])([A-Z])/g,"$1 $2");return n.charAt(0).toUpperCase()+n.slice(1)}var Js=require("obsidian");async function fi(e){let n=`https://api.github.com/repos/${e}/contents/data/spells`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&i.name.startsWith("spells-")&&i.name.endsWith(".json")).map(i=>i.name)}async function hi(e){let n=`https://api.github.com/repos/${e}/contents/data/bestiary`,r=await(await fetch(n)).json(),i=["bestiary-phb.json","bestiary-mm.json","bestiary-dmg.json","bestiary-xge.json","bestiary-vgm.json","bestiary-tce.json","bestiary-egw.json","bestiary-erlw.json","bestiary-mtf.json","bestiary-vrgr.json","bestiary-cos.json","bestiary-oota.json","bestiary-pota.json","bestiary-hotdq.json","bestiary-rot.json","bestiary-skt.json","bestiary-tftyp.json","bestiary-toa.json"];return r.filter(o=>o.type==="file"&&i.includes(o.name)).map(o=>o.name)}var di=["items-base.json","items.json","objects.json","vehicles.json","decks.json"];async function gi(e){let n=`https://api.github.com/repos/${e}/contents/data`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&di.includes(i.name)).map(i=>i.name)}async function mi(e){let n=`https://api.github.com/repos/${e}/contents/data/class`;return(await(await fetch(n)).json()).filter(i=>i.type==="file"&&i.name.startsWith("class-")&&i.name.endsWith(".json")).map(i=>i.name)}async function we(e,n){let t=n.split("/"),r="";for(let i of t){r=r?`${r}/${i}`:i;try{await e.vault.createFolder(r)}catch{}}}async function yi(e){let{app:n,edition:t,targetPath:r}=e,i=t.repo??"";{let o=await fi(i);for(let s of o)try{let a=await(await fetch(`${t.sourceUrl}/spells/${s}`)).json(),c=Gs(a,t.id);for(let p of c){let u=(0,ye.normalizePath)(`${r}/Spells/${p.path}`),f=u.split("/").slice(0,-1).join("/");await we(n,f),await n.vault.adapter.write(u,p.content)}}catch(l){console.warn(`Failed to import spell ${s}:`,l)}}{let o=await hi(i);for(let s of o)try{let a=await(await fetch(`${t.sourceUrl}/bestiary/${s}`)).json(),c=Ds(a,t.id);for(let p of c){let u=(0,ye.normalizePath)(`${r}/Bestiary/${p.path}`),f=u.split("/").slice(0,-1).join("/");await we(n,f),await n.vault.adapter.write(u,p.content)}}catch(l){console.warn(`Failed to import bestiary ${s}:`,l)}}{let o=await gi(i);for(let s of o)try{let a=await(await fetch(`${t.sourceUrl}/${s}`)).json(),c=_s(a,t.id);for(let p of c){let u=(0,ye.normalizePath)(`${r}/${p.path}`),f=u.split("/").slice(0,-1).join("/");await we(n,f),await n.vault.adapter.write(u,p.content)}}catch(l){console.warn(`Failed to import items from ${s}:`,l)}}{let s=await(await fetch(`${t.sourceUrl}/races.json`)).json(),l=Vs(s,t.id);for(let c of l){let p=(0,ye.normalizePath)(`${r}/Player Build/${c.path}`);await we(n,p.split("/").slice(0,-1).join("/")),await n.vault.adapter.write(p,c.content)}let a=[];try{let c=`${t.sourceUrl}/optionalfeatures.json`,u=await(await fetch(c)).text(),f=u.indexOf("{");if(f===-1)throw new Error("No JSON object found");let h=u.slice(f),F=JSON.parse(h);a=Array.isArray(F.optionalfeature)?F.optionalfeature:[]}catch(c){console.warn("Failed to import optionalfeatures.json:",c)}{let c=await mi(i);for(let p of c)try{let f=await(await fetch(`${t.sourceUrl}/class/${p}`)).json(),h=Ks(f,t.id,p,a);for(let F of h){let M=(0,ye.normalizePath)(`${r}/Player Build/${F.path}`);await we(n,M.split("/").slice(0,-1).join("/"));let d=n.vault.getAbstractFileByPath(M);d instanceof Js.TFile?await n.vault.modify(d,F.content):await n.vault.create(M,F.content)}}catch(u){console.warn(`Failed to import class ${p}:`,u)}}try{let p=await(await fetch(`${t.sourceUrl}/actions.json`)).json(),u=Hs(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import actions.json:",c)}try{let p=await(await fetch(`${t.sourceUrl}/conditionsdiseases.json`)).json(),u=Ws(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import conditionsdiseases.json:",c)}try{let p=await(await fetch(`${t.sourceUrl}/senses.json`)).json(),u=qs(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import senses.json:",c)}try{let p=await(await fetch(`${t.sourceUrl}/skills.json`)).json(),u=zs(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import skills.json:",c)}try{let p=await(await fetch(`${t.sourceUrl}/feats.json`)).json(),u=Ys(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import feats.json:",c)}try{let p=await(await fetch(`${t.sourceUrl}/backgrounds.json`)).json(),u=Qs(p,t.id);for(let f of u){let h=(0,ye.normalizePath)(`${r}/${f.path}`),F=h.split("/").slice(0,-1).join("/");await we(n,F),await n.vault.adapter.write(h,f.content)}}catch(c){console.warn("Failed to import backgrounds.json:",c)}}}async function $e(e){let{app:n,editionKey:t,targetPath:r}=e,i=ve.find(s=>s.id===t);if(!i){console.warn("Edition not found for:",t);return}if(!i.parser){console.warn("No parser defined for:",t);return}let o;switch(i.parser){case"5e-2014":o=_t;break;case"5e-2025":o=is;break;default:throw new Error(`Unknown parser: ${i.parser}`)}await o.importEditionData({app:n,edition:i,targetPath:r})}var lt=class extends Fe.Modal{constructor(n,t){super(n),this.plugin=t}onOpen(){this.contentEl.empty(),this.titleEl.setText("\u26A0\uFE0F Warning: Fresh Vault Recommended"),this.contentEl.createEl("div",{text:`The full VVunderlore install is intended for a fresh, empty Obsidian vault. If you install in a vault that already has files, any file whose path matches a VVunderlore Toolkit file will be overwritten.

Also things could just get messy.

Make a perception check and proceed with caution!`}).style.cssText=`
        white-space: pre-wrap;
        margin-bottom: 1em;
        line-height: 1.4em;
      `;let n=this.contentEl.createEl("div");n.style.cssText=`
      display: flex;
      justify-content: flex-end;
      gap: 0.5em;
    `,new Fe.ButtonComponent(n).setButtonText("Oh god, cancel!").onClick(()=>{this.close()}),new Fe.ButtonComponent(n).setButtonText("Install!!").setCta().onClick(async()=>{let t={compendium:this.plugin.settings.rulesetCompendium,references:[...this.plugin.settings.rulesetReference]};new Fe.Notice("\u23F3 Installing toolkit\u2026");let r=this.plugin.settings.rulesetCompendium,i=[...this.plugin.settings.rulesetReference];try{await this.plugin.installFullToolkit({compendium:r,references:i}),r&&await $e({app:this.app,editionKey:r,targetPath:"Compendium"})}catch(o){console.error("\u274C installToolkit() failed:",o),new Fe.Notice("\u274C Toolkit installation failed. See console.")}await this.plugin.saveSettings(),this.plugin.settingsTab.display(),this.contentEl.empty(),this.titleEl.setText("\u2705 Toolkit Installed"),this.contentEl.createEl("div",{text:"Reloading vault to finish setup. Don\u2019t touch anything."}).style.cssText=`
          font-size: 1em;
          margin-top: 1em;
          text-align: center;
        `,setTimeout(()=>{location.reload()},3e3)})}onClose(){this.contentEl.empty()}};var Me=require("obsidian"),rs=class extends Me.Modal{constructor(n){super(n)}onOpen(){this.contentEl.empty(),this.contentEl.createDiv({text:"Installing\u2026",cls:"mod-quiet"}).style.cssText="font-style: italic; color: var(--text-muted); text-align: center; padding: 1em;"}onClose(){this.contentEl.empty()}};function Zs(e,n){let t={};for(let s of n.manifestCache.folders)t[s.path]=s.key;for(let s of n.manifestCache.files)t[s.path]=s.key;let r={name:"",fullPath:"",isFolder:!0,children:{}};function i(s){let l=r,a="";for(let c of s)a=a?`${a}/${c}`:c,l.children[c]||(l.children[c]={name:c,fullPath:a,isFolder:!0,children:{}}),l=l.children[c];return l}for(let s of n.manifestCache.folders){let l=s.path.split("/");i(l)}for(let s of n.manifestCache.files){let l=s.path.split("/"),a=l.pop(),c=l.length?i(l):r;c.children[a]={name:a,fullPath:s.path,isFolder:!1,children:{}}}class o extends Me.Modal{constructor(a){super(a);this.checkboxMap={};this.currentBatchLines=[]}onOpen(){this.contentEl.empty(),this.titleEl.setText("Custom Install");let a=this.contentEl.createDiv();a.textContent="All checked items will be installed. Dependencies will be managed automatically.",a.style.cssText=`
        font-size: 0.9em;
        color: var(--text-muted);
        margin-top: 0.25em;
        margin-bottom: 0.75em;
      `;let c=this.contentEl.createDiv();Object.assign(c.style,{maxHeight:"480px",overflowY:"auto",margin:"0.5em 0",border:"1px solid var(--divider-color)",borderRadius:"4px",padding:"0.5em"});let p=c.createDiv();Object.assign(p.style,{display:"flex",flexDirection:"column",gap:"0.5em",marginBottom:"0.75em"});let u=p.createDiv();u.style.display="flex",u.style.alignItems="center",this.pluginCheckbox=u.createEl("input",{type:"checkbox"}),this.pluginCheckbox.checked=!0,this.pluginCheckbox.id="vvunderlore-checkbox-plugins",this.pluginCheckbox.style.marginRight="0.5em",u.createEl("label",{text:"Community Plugins",attr:{for:this.pluginCheckbox.id}});let f=p.createDiv();f.style.display="flex",f.style.alignItems="center",this.demoCheckbox=f.createEl("input",{type:"checkbox"}),this.demoCheckbox.checked=!0,this.demoCheckbox.id="vvunderlore-checkbox-demo",this.demoCheckbox.style.marginRight="0.5em",f.createEl("label",{text:"VVunderlore Demo Files",attr:{for:this.demoCheckbox.id}});let h=p.createDiv();h.style.display="flex",h.style.alignItems="center",this.settingsCheckbox=h.createEl("input",{type:"checkbox"}),this.settingsCheckbox.checked=!0,this.settingsCheckbox.id="vvunderlore-checkbox-settings",this.settingsCheckbox.style.marginRight="0.5em",h.createEl("label",{text:"Vault Settings (apperance, hotkeys, graph setup, etc.)",attr:{for:this.settingsCheckbox.id}});let F=c.createDiv();Object.assign(F.style,{borderTop:"1px solid var(--divider-color)",margin:"0.5em 0"});let M=c.createDiv();Object.assign(M.style,{margin:"0",padding:"0",border:"none"});let d=16,A=g=>n.manifestCache.folders.find(w=>w.path===g)||n.manifestCache.files.find(w=>w.path===g),k=()=>{M.empty(),this.checkboxMap={},this.currentBatchLines=[];let g=this.demoCheckbox.checked,w=(P,I,N=0)=>{if(P.fullPath){let j=A(P.fullPath);if(j&&j.optional&&!g)return}if(P.isFolder){let j=I.createEl("details");j.open=!0,j.style.margin="4px 0";let y=j.createEl("summary");Object.assign(y.style,{display:"flex",alignItems:"center",marginLeft:`${N*d}px`,cursor:"pointer",padding:"2px 6px",borderRadius:"4px",userSelect:"none"}),y.addEventListener("mouseenter",()=>{y.style.backgroundColor="var(--background-modifier-hover)"}),y.addEventListener("mouseleave",()=>{y.style.backgroundColor="transparent"});let S=y.createEl("input",{type:"checkbox"});S.style.marginRight="0.5em",S.checked=!0,S.style.cursor="pointer",this.checkboxMap[P.fullPath]=S;let m=y.createDiv({cls:"suggestion-icon"});(0,Me.setIcon)(m,"folder"),m.style.marginRight="0.3em",m.style.transform="scale(0.9)",m.style.opacity="0.75";let E=y.createEl("span",{text:P.name});E.style.fontWeight="600",E.style.fontSize="0.95em",S.onchange=()=>{this.toggleDescendants(P,S.checked),this.enforceDependencies(P.fullPath,S.checked),this.fadeAllExceptCurrentBatch()};let D=j.createDiv();D.style.marginTop="4px";for(let L of Object.keys(P.children).sort())w(P.children[L],D,N+1)}else{let j=I.createDiv();Object.assign(j.style,{display:"flex",alignItems:"center",marginLeft:`${N*d}px`,padding:"2px 6px",borderRadius:"4px",marginTop:"2px",marginBottom:"2px",userSelect:"none"}),j.addEventListener("mouseenter",()=>{j.style.backgroundColor="var(--background-modifier-hover)"}),j.addEventListener("mouseleave",()=>{j.style.backgroundColor="transparent"});let y=j.createEl("input",{type:"checkbox"});y.style.marginRight="0.5em",y.checked=!0,y.style.cursor="pointer",this.checkboxMap[P.fullPath]=y;let S=j.createDiv({cls:"suggestion-icon"});(0,Me.setIcon)(S,"document"),S.style.marginRight="0.3em",S.style.transform="scale(0.8)",S.style.opacity="0.5";let m=j.createEl("label",{text:P.name});m.style.fontSize="0.9em",y.onchange=()=>{this.enforceDependencies(P.fullPath,y.checked),this.fadeAllExceptCurrentBatch()}}};for(let P of Object.keys(r.children).sort())w(r.children[P],M,0)};k(),this.consoleEl=this.contentEl.createDiv({cls:"custom-console"}),Object.assign(this.consoleEl.style,{height:"140px",margin:"0.5em 0",padding:"8px",backgroundColor:"var(--background-secondary)",border:"1px solid var(--divider-color)",borderRadius:"4px",fontFamily:"monospace",fontSize:"0.82em",lineHeight:"1.4em",color:"var(--text-normal)",overflowY:"auto",whiteSpace:"pre-wrap"});let _=this.consoleEl.createDiv({text:"> Dependency errors and warnings will appear here\u2026"});Object.assign(_.style,{opacity:"0.4",fontStyle:"italic",marginBottom:"4px"}),this.pluginCheckbox.onchange=()=>{let g="vvunderlore-warning";if(this.pluginCheckbox.checked){if(this.consoleEl.querySelectorAll(`.${g}`).forEach(P=>P.remove()),this.consoleEl.children.length===0){let P=this.consoleEl.createDiv({text:"> Dependency console output will appear here\u2026"});Object.assign(P.style,{opacity:"0.4",fontStyle:"italic",marginBottom:"4px"})}this.consoleEl.scrollTop=this.consoleEl.scrollHeight}else{this.consoleEl.children.length===1&&this.consoleEl.children[0].textContent?.startsWith("> Dependency console")&&this.consoleEl.empty();let w=this.consoleEl.createDiv({text:"WARNING: The VVunderlore Toolkit will not function without all included plugins! You probably want to re-check that one."});w.addClass(g),w.style.color="#FF0000",this.consoleEl.scrollTop=this.consoleEl.scrollHeight}},this.demoCheckbox.onchange=()=>{k()};let B=this.contentEl.createDiv();Object.assign(B.style,{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"8px",borderTop:"1px solid var(--divider-color)",marginTop:"8px"});let H=B.createEl("button",{text:"Reset Selection"});H.style.cssText=`
        font-size: 0.9em;
        color: var(--text-normal);
      `,H.onclick=()=>{let g=Array.from(this.consoleEl.querySelectorAll(".vvunderlore-warning"));this.consoleEl.empty(),g.forEach(w=>{this.consoleEl.appendChild(w)}),Object.values(this.checkboxMap).forEach(w=>{w.checked=!0})};let K=B.createDiv();Object.assign(K.style,{display:"flex",gap:"0.5em"});let W=K.createEl("button",{text:"Install Selected",cls:"mod-cta"});W.onclick=async()=>{W.setAttribute("disabled",""),this.close();let g=new rs(e);g.open();let w=[];for(let[P,I]of Object.entries(this.checkboxMap))if(I.checked){let N=n.manifestCache.folders.some(j=>j.path===P);w.push({path:P,isFolder:N})}if(this.pluginCheckbox.checked){try{let I=await fetch("https://api.github.com/repos/slamwise0001/VVunderlore-Toolkit-Full/contents/.obsidian/plugins?ref=main");if(I.ok){let N=await I.json();for(let j of N){let y=`.obsidian/plugins/${j.name}`;await this.app.vault.adapter.exists(y)||(j.type==="dir"?w.push({path:y,isFolder:!0}):w.push({path:y,isFolder:!1}))}}}catch(P){console.error("Failed to enumerate .obsidian/plugins from GitHub:",P)}w.push({path:".obsidian/community-plugins.json",isFolder:!1})}if(this.settingsCheckbox.checked){let P=[".obsidian/app.json",".obsidian/appearance.json",".obsidian/graph.json",".obsidian/hotkeys.json"];for(let I of P)w.push({path:I,isFolder:!1})}try{await n.performCustomInstall(w)}catch(P){console.error("\u274C performCustomInstall() threw:",P),new Me.Notice("\u274C Custom install failed\u2014see console")}finally{g.close()}};let C=K.createEl("button",{text:"Cancel"});C.onclick=()=>this.close()}onClose(){this.contentEl.empty()}toggleDescendants(a,c){for(let p of Object.values(a.children)){let u=this.checkboxMap[p.fullPath];u&&(u.checked=c),p.isFolder&&this.toggleDescendants(p,c)}}enforceDependencies(a,c){let p=t[a];if(!p)return;let u={};for(let h of n.manifestCache.folders)u[h.path]=h.displayName??h.path.split("/").pop();for(let h of n.manifestCache.files)u[h.path]=h.displayName??h.path.split("/").pop();let f=u[a]??a.split("/").pop();if(this.currentBatchLines=[],c){let h=[p];for(;h.length;){let F=h.pop(),M=n.requiresGraph.get(F)??[];for(let d of M){let A=n.manifestCache.files.find(k=>k.key===d)||n.manifestCache.folders.find(k=>k.key===d);if(A){let k=A.path,_=this.checkboxMap[k];if(_&&!_.checked){_.checked=!0;let B=u[k]??k.split("/").pop(),H=this.appendLogLine(k,`> ${B} automatically checked (required by ${f})`);this.currentBatchLines.push(H),h.push(d)}}}}}else{let h=M=>Array.from(n.requiresGraph.entries()).filter(([,d])=>d.includes(M)).map(([d])=>d),F=[p];for(;F.length;){let M=F.pop();for(let d of h(M)){let A=n.manifestCache.files.find(k=>k.key===d)||n.manifestCache.folders.find(k=>k.key===d);if(A){let k=A.path,_=this.checkboxMap[k];if(_&&_.checked){_.checked=!1;let B=u[k]??k.split("/").pop(),H=this.appendLogLine(k,`> ${B} automatically unchecked (depends on ${f})`);this.currentBatchLines.push(H),F.push(d)}}}}}this.fadeAllExceptCurrentBatch()}appendLogLine(a,c){let p=this.consoleEl.createDiv();Object.assign(p.style,{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"2px 0",opacity:"1.0",transition:"opacity 0.2s ease"}),p.createSpan({text:c});let u=p.createEl("button",{text:"undo",cls:"mod-small"});return Object.assign(u.style,{marginLeft:"0.5em",fontSize:"0.75em",padding:"2px 4px",cursor:"pointer"}),u.onclick=()=>{let f=this.checkboxMap[a];f&&(f.checked=!f.checked,this.enforceDependencies(a,f.checked),this.fadeAllExceptCurrentBatch())},this.consoleEl.scrollTop=this.consoleEl.scrollHeight,p}fadeAllExceptCurrentBatch(){let a=this.consoleEl.children.length;for(let c=0;c<a;c++){let p=this.consoleEl.children[c];this.currentBatchLines.includes(p)?p.style.opacity="1.0":p.style.opacity="0.6"}}}new o(e).open()}var en=pn(require("path"));var os=class extends G.AbstractInputSuggest{constructor(t,r){super(t,r);this.paths=[];this.currentSuggestions=[];this.renderedSuggestions=new Map;this.inputEl=r;let i=Object.values(t.vault.getAllLoadedFiles()).filter(s=>s instanceof G.TFolder).map(s=>({path:s.path,isFolder:!0})),o=t.vault.getMarkdownFiles().map(s=>({path:s.path,isFolder:!1}));this.paths=[...i,...o],this.inputEl.addEventListener("keydown",s=>{s.key==="Enter"&&setTimeout(()=>{let l=this.containerEl;if(!l)return;let a=l.querySelector(".suggestion-item.is-selected");if(a){let c=this.renderedSuggestions.get(a);c&&this.selectSuggestion(c)}},0)})}getSuggestions(t){let r=t.toLowerCase();return this.currentSuggestions=this.paths.filter(({path:i})=>i.toLowerCase().includes(r)).map(i=>i.path),this.currentSuggestions}renderSuggestion(t,r){let i=this.paths.find(c=>c.path===t)?.isFolder;r.addClass("mod-complex");let o=r.createDiv({cls:"suggestion-icon"});(0,G.setIcon)(o,i?"folder":"document");let s=t.split("/").pop(),l=i?s:s.replace(/\.md$/,"");r.createDiv({text:l,cls:"suggestion-title"});let a=t.split("/").slice(0,-1).join("/");r.createDiv({text:a,cls:"search-suggest-info-text"}),r.addEventListener("click",c=>{c.stopPropagation(),this.selectSuggestion(t)}),this.renderedSuggestions.set(r,t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.dispatchEvent(new Event("input")),this.close()}},as=class extends G.Modal{constructor(t,r){super(t);this.content=r}onOpen(){this.contentEl.addEventListener("click",i=>i.stopPropagation()),this.contentEl.empty(),this.contentEl.createEl("h2",{text:"Toolkit Changelog"});let t=this.contentEl.createDiv(),r=new class extends G.Component{};G.MarkdownRenderer.renderMarkdown(this.content,t,"/",r)}onClose(){this.contentEl.empty()}},ct=class extends G.PluginSettingTab{constructor(t,r){super(t,r);this.versionValueEl=null;this.forceWarningEl=null;this.plugin=r}renderHeader(t){let r=t.createDiv();r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.borderBottom="1px solid var(--divider-color)",r.style.marginBottom="2em",r.style.paddingBottom="0.5em",r.createEl("h3",{text:"VVunderlore Toolkit Settings"});let i=r.createDiv();i.style.display="flex",i.style.gap="0.5em";let o=i.createEl("button",{text:"Docs"});o.onclick=()=>window.open("http://vvunderlore.com","_blank");let s=i.createEl("button",{text:"GitHub"});s.onclick=()=>window.open("https://github.com/slamwise0001/VVunderlore-Toolkit-Full","_blank");let l=i.createEl("button",{text:"\u2615 Ko-fi",cls:"mod-cta"});l.style.backgroundColor="#ff5900",l.style.color="white",l.onclick=()=>window.open("https://ko-fi.com/vvunderlore","_blank")}renderFirstRunCard(t){let r=t.createEl("div",{cls:"vvunderlore-first-run"});Object.assign(r.style,{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",marginTop:"2em",padding:"1em",border:"2px solid var(--divider-color)",borderRadius:"18px",backgroundColor:"var(--background-primary)"});let i=r.createEl("h2",{text:"\u{1F3F0} Welcome to VVunderlore",cls:"vv-card-title"});i.style.marginBottom="0.5em";let o=r.createEl("p",{text:`Get started by installing the default toolkit\u2014
or choose individual pieces to suit your vault.`,cls:"vv-card-desc"});o.style.marginBottom="1.25em";let s=this.plugin,l=r.createDiv();Object.assign(l.style,{display:"grid",gridTemplateColumns:"max-content max-content",columnGap:"1rem",rowGap:"0.25rem",justifyContent:"center",justifyItems:"center",marginBottom:"1rem"});let a=l.createEl("div",{text:"Ruleset"});a.style.fontWeight="bold";let c=l.createEl("div",{text:"Reference (optional)"});c.style.fontWeight="bold";let p=l.createDiv({attr:{style:"text-align:center"}}),u=l.createDiv({attr:{style:"text-align:center"}}),f=l.createDiv();Object.assign(f.style,{gridColumn:"1 / span 2",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"0.5rem",fontSize:"0.85em",color:"var(--text-muted)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"1rem"});let h=f.createSpan({text:`Ruleset: ${s.settings.rulesetCompendium?`D&D 5E (${s.settings.rulesetCompendium})`:""}`});h.style.fontWeight="bold",f.createSpan({text:"References:"});let F=f.createDiv();Object.assign(F.style,{display:"flex",gap:"4px"});function M(g){let w=ve.find(N=>N.id===g),P=F.createDiv({attr:{style:"background: var(--interactive-accent); color: white; padding:2px 6px; border-radius:4px; display:inline-flex; align-items:center; gap:4px;"}});P.createSpan({text:w.label});let I=P.createSpan({text:"\xD7",attr:{style:"cursor:pointer; margin-left:4px;"}});I.onclick=async()=>{s.settings.rulesetReference=s.settings.rulesetReference.filter(N=>N!==g),await s.saveSettings(),P.remove(),W()}}s.settings.rulesetReference.forEach(g=>M(g));let d=new G.DropdownComponent(p);d.addOption("","Select edition\u2026"),ve.forEach(g=>{d.addOption(g.id,g.label)}),d.setValue(this.plugin.settings.rulesetCompendium).onChange(async g=>{this.plugin.settings.rulesetCompendium=g,await this.plugin.saveSettings();let w=ve.find(P=>P.id===g);h.textContent=w?w.label:"",F.empty(),W()});let A=u.createDiv({attr:{style:"text-align:center;"}}),k=new G.SearchComponent(A);k.setPlaceholder("Add reference rules\u2026");let _=k.inputEl;new class extends G.AbstractInputSuggest{constructor(g,w){super(g,w)}getSuggestions(g){return ve.filter(w=>w.id!==s.settings.rulesetCompendium).filter(w=>w.label.toLowerCase().includes(g.toLowerCase())).map(w=>w.id)}renderSuggestion(g,w){let P=ve.find(I=>I.id===g);w.createDiv({text:P.label})}selectSuggestion(g){s.settings.rulesetReference.includes(g)||(s.settings.rulesetReference.push(g),s.saveSettings(),M(g)),this.close(),_.value="",W()}}(this.app,_);let B=r.createEl("div",{cls:"vv-button-row"});Object.assign(B.style,{display:"flex",gap:"0.75em",justifyContent:"center",marginBottom:"1.5em"});let H=B.createEl("button",{text:"Install Toolkit",cls:"mod-cta"});H.onClickEvent(()=>new lt(this.app,this.plugin).open());let K=B.createEl("button",{text:"Custom Install",cls:"mod-cta"});Object.assign(K.style,{background:"none",border:"1px solid var(--interactive-accent)",color:"var(--text-normal)"}),K.onClickEvent(()=>Zs(this.app,this.plugin));let W=()=>{let g=!!this.plugin.settings.rulesetCompendium;H.toggleAttribute("disabled",!g),K.toggleAttribute("disabled",!g)};W();let C=r.createEl("p",{cls:"vv-skip-link"});Object.assign(C.style,{textAlign:"center",marginTop:"0.25em"}),C.createEl("a",{text:"Already have the Toolkit? Show me the settings \u2192"}).onClickEvent(async()=>{let g=".vvunderlore_installed";try{await this.app.vault.adapter.exists(g)||await this.app.vault.create(g,"")}catch(w){console.error("\u274C Failed to create marker file:",w)}this.display()})}async display(){console.log("\u{1F527} display() called");let{containerEl:t}=this,r=t.scrollTop;if(t.empty(),!await this.app.vault.adapter.exists(".vvunderlore_installed")){console.log("\u{1F9EA} first-run: marker missing \u2192 show installer card"),this.renderFirstRunCard(t),t.scrollTop=r;return}this.renderHeader(t),(async()=>{let s=t.createDiv();s.style.marginBottom="1em",s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="flex-start",s.style.gap="2em",s.style.flexWrap="wrap",s.style.borderBottom="1px solid var(--divider-color)";let l=s.createDiv();l.style.display="flex",l.style.flexDirection="column",l.style.gap="0.25em";let a="Not installed";try{let R=await this.app.vault.adapter.read(".version.json");a=JSON.parse(R).version??"Not installed"}catch(R){console.warn("Could not read .version.json from vault:",R)}let c=this.plugin.settings.latestToolkitVersion??"Could not fetch",p=a===c,u=l.createDiv();u.appendText("Vault Toolkit Version: "),this.versionValueEl=u.createSpan(),this.versionValueEl.textContent=a,this.versionValueEl.style.fontWeight="bold",this.versionValueEl.style.color=p?"var(--text-success)":"var(--text-error)",l.createEl("div",{text:"Latest Official Version: "}).createSpan({text:c,attr:{style:"font-weight: bold; color: var(--text-success);"}});let h=s.createDiv();h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="flex-end",h.style.gap="0.5em";let F=h.createDiv();if(F.style.display="flex",F.style.gap="0.5em",F.createEl("button",{text:a!==c?"Preview Update":"Check for Updates",cls:"mod-cta"}).addEventListener("click",async()=>{a!==c?this.plugin.previewUpdatesModal():await this.plugin.checkForUpdates()}),F.createEl("button",{text:"\u{1F4D6} View Changelog"}).addEventListener("click",()=>{new as(this.app,this.plugin.changelog).open()}),this.plugin.settings.lastChecked){let R=h.createDiv();R.style.fontSize="11px",R.style.color="var(--text-muted)",R.textContent=`Last checked: ${new Date(this.plugin.settings.lastChecked).toLocaleString()}`}let A=t.createEl("details",{cls:"vk-section"}),k=A.createEl("summary",{cls:"vk-section-header"});Object.assign(k.style,{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"0.5em 0",borderBottom:"1px solid var(--divider-color)",cursor:"pointer"});let _=k.createDiv({attr:{style:`
			display: flex;
			justify-content: space-between;
			align-items: flex-end;
			`}}),B=_.createDiv({attr:{style:"display: flex; flex-direction: column;"}});B.createEl("h5",{text:"Fix Your Vault"}),B.createEl("div",{text:"Fix and broken, deleted, or misplaced files in your toolkit.",cls:"setting-item-description",attr:{style:"margin-top: 0.25em;"}});let H=_.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(H.style,{fontWeight:"bold",display:"inline-block",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:A.open?"rotate(0deg)":"rotate(180deg)"}),A.ontoggle=()=>{H.style.transform=A.open?"rotate(0deg)":"rotate(180deg)"};let K=A.createDiv({cls:"vk-section-body"});K.style.paddingLeft="1em";let W=K.createDiv();W.style.display="flex",W.style.justifyContent="space-between",W.style.alignItems="center",W.style.marginTop="0.5em";let C=W.createDiv();this.forceWarningEl=C;let g="";try{let R=await this.plugin.app.vault.adapter.read(".version.json");g=(JSON.parse(R).version??"").trim()}catch{g=""}let w=(this.plugin.settings.latestToolkitVersion??"").trim();if(console.log("\u{1F9EA} Comparing versions:",g,w),g&&w&&g!==w){let R=C.createEl("div",{text:`\u26A0\uFE0F New version available (${g} \u2192 ${w}) \u2014 use regular update instead`});R.style.fontSize="0.85em",R.style.color="var(--text-muted)",R.style.fontStyle="italic",R.setAttr("title","Force updating while a new version is available may skip important changes.")}let P=W.createDiv();P.style.display="flex",P.style.gap="0.5em",P.createEl("button",{text:"Force Update Vault",cls:"mod-cta"}).onclick=async()=>{await this.plugin.forceUpdatePreviewAndConfirm(),this.plugin.settings.reparseGamesets&&await this.plugin.refreshGameSetData()},P.createEl("button",{text:"Undo Update"}).onclick=async()=>{await this.plugin.undoForceUpdate()};let I=K.createDiv();Object.assign(I.style,{textAlign:"right",fontSize:"11px",color:"var(--text-muted)",marginTop:"0.25em"}),I.textContent=`Last forced: ${this.plugin.settings.lastForceUpdate?new Date(this.plugin.settings.lastForceUpdate).toLocaleString():"Not forced yet"}`,K.createEl("div",{attr:{style:"border-top: 1px solid var(--divider-color); margin: 0.75em 0;"}});let N=K.createDiv();N.style.marginTop="0.5em",new G.Setting(N).setName("Re-parse Game Sets On Force Update").setDesc("Also re-parse your ruleset compendium and reference sets. This won't delete any files in the Compendium or Reference folders.").addToggle(R=>R.setValue(this.plugin.settings.reparseGamesets).onChange(async z=>{this.plugin.settings.reparseGamesets=z,await this.plugin.saveSettings()}));let j=t.createEl("details",{cls:"vk-section"}),y=j.createEl("summary",{cls:"vk-section-header"});Object.assign(y.style,{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"0.5em 0",borderBottom:"1px solid var(--divider-color)",cursor:"pointer"});let S=y.createDiv({attr:{style:`
			display: flex;
			justify-content: space-between;
			align-items: flex-end;
			`}}),m=S.createDiv({attr:{style:"display: flex; flex-direction: column;"}});m.createEl("h5",{text:"Vault Backups"}),m.createEl("div",{text:"The Toolkit will back up your vault automatically before updates. You can also back up manually anytime.",cls:"setting-item-description",attr:{style:"margin-top: 0.25em;"}});let E=S.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(E.style,{fontWeight:"bold",display:"inline-block",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:j.open?"rotate(0deg)":"rotate(180deg)"}),j.ontoggle=()=>{E.style.transform=j.open?"rotate(0deg)":"rotate(180deg)"};let D=j.createDiv({cls:"vk-section-body"});D.style.paddingLeft="1em",new G.Setting(D).setName("Auto-Backup Before Update").setDesc("Create a full .zip of the vault before applying version updates. Force updates will only back up the files that will be modified or removed.").addToggle(R=>R.setValue(this.plugin.settings.autoBackupBeforeUpdate).onChange(async z=>{this.plugin.settings.autoBackupBeforeUpdate=z,await this.plugin.saveSettings()})),new G.Setting(D).setName("Manual Backup").setDesc("Immediately create a zip backup of your vault").addButton(R=>R.setButtonText("Backup Vault Now").setCta().onClick(async()=>{let z=await this.plugin.backupManager.backupVaultToZip("manual");new G.Notice(`Backup created: ${z}`)})),new G.Setting(D).setName("Open Backups Folder").setDesc("Open the backups folder on disk. MacOS: Cant see it? Hit Shift+Cmd+(period).").addButton(R=>R.setButtonText("Open Folder").onClick(async()=>{try{let z=this.plugin.app.vault.adapter.getBasePath(),Ae=en.join(z,".vault-backups"),{shell:ke}=window.require("electron"),Z=await ke.openPath(Ae);typeof Z=="string"&&Z.length>0&&(console.error("\u274C shell.openPath error:",Z),new G.Notice("Could not open backups folder. See console."))}catch(z){console.error("\u274C Could not open backups folder:",z),new G.Notice("Could not open backups folder. See console.")}})),D.createEl("div",{attr:{style:"border-top: 1px solid var(--divider-color); margin-top: 1.5em;"}});let L=t.createEl("details",{cls:"vk-section"}),b=L.createEl("summary",{cls:"vk-section-header"});Object.assign(b.style,{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"0.5em 0",cursor:"pointer"});let Y=b.createDiv({attr:{style:`
			display: flex;
			width: 100%;
			justify-content: space-between;
			align-items: flex-end;
			`}}),$=Y.createDiv({attr:{style:"display: flex; flex-direction: column;"}});$.createEl("h5").appendText("Custom File Management "),$.createEl("div",{text:"Skip updates on certain files or remap relocated Toolkit files so they can update.",cls:"setting-item-description",attr:{style:"margin-top: 0.25em;"}});let T=Y.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(T.style,{fontWeight:"bold",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:L.open?"rotate(0deg)":"rotate(180deg)"}),L.ontoggle=()=>{T.style.transform=L.open?"rotate(0deg)":"rotate(180deg)"};let Q=L.createDiv({attr:{style:"padding-left: 1em; padding-right: 1em;"}}).createDiv({cls:"vk-section-body"}),V=Q.createDiv(),J=V.createDiv({cls:"setting-item"}),ee=J.createDiv({cls:"setting-item-info"});ee.createDiv({text:"Skip Toolkit Items",cls:"setting-item-name"}),ee.createDiv({text:"Files listed here will be ignored during toolkit updates.",cls:"setting-item-description"});let X=J.createDiv({cls:"setting-item-control"}),ae=new G.DropdownComponent(X);ae.selectEl.style.minWidth="220px",ae.addOption("","Select an item\u2026"),this.plugin.manifestCache.files.filter(R=>!R.optional).forEach(R=>ae.addOption(R.path,R.displayName??R.path.split("/").pop())),this.plugin.manifestCache.folders.filter(R=>!R.optional).forEach(R=>ae.addOption(R.path,(R.displayName??R.path.split("/").pop())+"/ (folder)")),new G.ButtonComponent(X).setButtonText("Add").setCta().onClick(async()=>{let R=ae.getValue();if(!R)return new G.Notice("Pick something to skip.");this.plugin.settings.customPaths.some(z=>z.manifestKey===R)||(this.plugin.settings.customPaths.push({vaultPath:R,manifestKey:R,doUpdate:!1}),await this.plugin.saveSettings(),de())});let Le=V.createDiv({cls:"vk-table-wrapper",attr:{style:"margin-top:0.75em"}}),de=()=>{Le.empty();let R=this.plugin.settings.customPaths.filter(Z=>!Z.doUpdate);if(R.length===0){let Z=Le.createEl("div",{text:"No items skipped."});Z.style.textAlign="center",Z.style.opacity="0.6",Z.style.padding="0.5em";return}let z=Le.createEl("table",{cls:"setting-table"}),Ae=z.createTHead().insertRow();Ae.insertCell().textContent="Skipped Files/Folders";let ke=z.createTBody();R.forEach(Z=>{let Se=ke.insertRow().insertCell();Se.colSpan=1,Se.style.display="flex",Se.style.justifyContent="space-between",Se.style.paddingLeft="4em",Se.style.alignItems="center",Se.style.gap="1em",Se.style.fontWeight="bold",Se.createSpan({text:Z.manifestKey});let ge=Se.createEl("a",{text:"Remove entry",href:"#"});ge.style.fontSize="0.8em",ge.style.color="var(--text-faint)",ge.style.textDecoration="underline",ge.onclick=async Ne=>{Ne.preventDefault(),this.plugin.settings.customPaths.remove(Z),await this.plugin.saveSettings(),de()}})};de(),Q.createEl("div",{attr:{style:"height: 1em; border-top: 1px solid var(--divider-color); margin: 1em 0;"}});let ht=Q.createDiv(),cs=ht.createDiv({cls:"setting-item"}).createDiv({cls:"setting-item-info"});cs.createDiv({text:"Remap File Paths",cls:"setting-item-name"}),cs.createDiv({text:"Remap toolkit files vault paths if you chose to move anything. Moving files without remapping will result in duplicate and/or out-of-date files after update.",cls:"setting-item-description"});let Ve=ht.createDiv({cls:"vk-inline-add-controls"});Ve.style.flexWrap="wrap",Ve.style.marginTop="0.5em";let Re,dt;Re=new G.DropdownComponent(Ve),Re.selectEl.style.minWidth="220px",Re.addOption("","Select an item\u2026"),this.plugin.manifestCache.files.forEach(R=>Re.addOption(R.path,R.displayName??R.path.split("/").pop())),this.plugin.manifestCache.folders.forEach(R=>Re.addOption(R.path,(R.displayName??R.path.split("/").pop())+"/ (folder)"));let nn=Ve.createDiv(),gt=new G.SearchComponent(nn);gt.setPlaceholder("Search vault path\u2026"),new os(this.app,gt.inputEl),dt=gt.inputEl,new G.ButtonComponent(Ve).setButtonText("Add Remap").setCta().onClick(async()=>{let R=Re.getValue(),z=dt.value.trim();if(!R||!z)return new G.Notice("Select an item and enter a vault path.");if(!this.app.vault.getAbstractFileByPath(z))return new G.Notice("Vault path not found.");this.plugin.settings.customPaths=this.plugin.settings.customPaths.filter(Ae=>Ae.manifestKey!==R),this.plugin.settings.customPaths.push({manifestKey:R,vaultPath:z,doUpdate:!0}),await this.plugin.saveSettings(),dt.value="",Re.setValue(""),Qe()});let mt=ht.createDiv({cls:"vk-table-wrapper",attr:{style:"margin-top: 0.75em"}}),Qe=()=>{mt.empty();let R=this.plugin.settings.customPaths.filter(Z=>Z.doUpdate);if(R.length===0){let Z=mt.createEl("div",{text:"No custom paths defined."});Z.style.textAlign="center",Z.style.opacity="0.6",Z.style.padding="0.5em";return}let z=mt.createEl("table",{cls:"setting-table"}),Ae=z.createTHead().insertRow();["Toolit Item","New Vault Path",""].forEach(Z=>Ae.insertCell().textContent=Z);let ke=z.createTBody();R.forEach(Z=>{let Ke=ke.insertRow();Ke.insertCell().textContent=Z.manifestKey,Ke.insertCell().textContent=Z.vaultPath;let ge=Ke.insertCell().createEl("a",{text:"Remove entry",href:"#"});ge.style.fontSize="0.8em",ge.style.color="var(--text-faint)",ge.style.textDecoration="underline",ge.onclick=async Ne=>{Ne.preventDefault(),this.plugin.settings.customPaths.remove(Z),await this.plugin.saveSettings(),Qe()}})};Qe(),Q.createEl("div",{attr:{style:"border-top: 1px solid var(--divider-color); margin: 0.5em 0;"}});let Be=t.createEl("details",{cls:"vk-section"}),ps=Be.createEl("summary",{cls:"vk-section-header"});Object.assign(ps.style,{display:"flex",flexDirection:"column",alignItems:"stretch",padding:"0.5em 0",borderBottom:"1px solid var(--divider-color)",cursor:"pointer"});let us=ps.createDiv({attr:{style:`
			display: flex;
			justify-content: space-between;
			align-items: flex-end;
			`}}),fs=us.createDiv({attr:{style:"display: flex; flex-direction: column;"}});fs.createEl("h5",{text:"File Highlights"}),fs.createEl("div",{text:"Toggle on/off the highlighting of Toolkit-specific files. Also make the highlights cool colors.",cls:"setting-item-description",attr:{style:"margin-top: 0.25em;"}});let hs=us.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(hs.style,{fontWeight:"bold",display:"inline-block",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:Be.open?"rotate(0deg)":"rotate(180deg)"}),Be.ontoggle=()=>{hs.style.transform=Be.open?"rotate(0deg)":"rotate(180deg)"};let yt=Be.createDiv({cls:"vk-section-body"});yt.style.paddingLeft="1em",new G.Setting(yt).setName("Enable File/Folder Highlighting").setDesc("Any file/folder installed by VVunderlore will have this background.").addToggle(R=>{R.setValue(this.plugin.settings.highlightEnabled).onChange(async z=>{this.plugin.settings.highlightEnabled=z,await this.plugin.saveSettings(),z?this.plugin.enableHighlight():this.plugin.disableHighlight(),ds()})});let At=yt.createDiv(),ds=()=>{At.empty(),this.plugin.settings.highlightEnabled&&(new G.Setting(At).setName("Light Mode Highlight Color").setDesc("Choose the background color for files/folders in Light mode.").addColorPicker(R=>{R.setValue(this.plugin.settings.highlightColorLight).onChange(async z=>{this.plugin.settings.highlightColorLight=z,await this.plugin.saveSettings(),this.plugin.disableHighlight(),this.plugin.enableHighlight()})}),new G.Setting(At).setName("Dark Mode Highlight Color").setDesc("Choose the background color for files/folders in Dark mode.").addColorPicker(R=>{R.setValue(this.plugin.settings.highlightColorDark).onChange(async z=>{this.plugin.settings.highlightColorDark=z,await this.plugin.saveSettings(),this.plugin.disableHighlight(),this.plugin.enableHighlight()})}))};ds(),de(),Qe();let gs=new G.Setting(t);gs.settingEl.style.borderTop="none",gs.setName("Remove Demo Files").setDesc("Delete every \u201Coptional\u201D demo file and folder from your vault.").addButton(R=>R.setButtonText("Remove Demo Files").onClick(async()=>{let z=this.plugin.manifestCache.files.filter(le=>le.optional),Ae=this.plugin.manifestCache.folders.filter(le=>le.optional),ke=z.length,Z=Ae.length;if(ke+Z===0){new G.Notice("No \u201Coptional\u201D demo files or folders to remove.");return}if(!await new Promise(le=>{new class extends G.Modal{constructor(ce){super(ce)}onOpen(){this.contentEl.empty(),this.contentEl.createEl("h2",{text:"Confirm Removal"}),this.contentEl.createEl("p",{text:`This will permanently delete ${ke} file(s) and ${Z} folder(s). Continue?`});let ce=this.contentEl.createEl("div");Object.assign(ce.style,{display:"flex",justifyContent:"flex-end",gap:"0.5em",marginTop:"1.5em"}),ce.createEl("button",{text:"Cancel"}).onclick=()=>{le(!1),this.close()},ce.createEl("button",{text:"Yes, Remove",cls:"mod-danger"}).onclick=()=>{le(!0),this.close()}}onClose(){this.contentEl.empty()}}(this.app).open()}))return;let ge=0;for(let le of z){let ce=this.plugin.settings.customPaths.find(Ee=>Ee.manifestKey===le.key)?.vaultPath??le.path;if(await this.app.vault.adapter.exists(ce))try{await this.app.vault.adapter.remove(ce),ge++}catch(Ee){console.error(`Failed to delete optional file ${ce}`,Ee)}}let Ne=0;for(let le of Ae){let ce=this.plugin.settings.customPaths.find(Ee=>Ee.manifestKey===le.key)?.vaultPath??le.path;if(await this.app.vault.adapter.exists(ce))try{await this.app.vault.adapter.rmdir(ce,!0),Ne++}catch(Ee){console.error(`Failed to delete optional folder ${ce}`,Ee)}}this.plugin.settings.customPaths=this.plugin.settings.customPaths.filter(le=>{let Je=z.some(Ee=>Ee.key===le.manifestKey),ce=Ae.some(Ee=>Ee.key===le.manifestKey);return!Je&&!ce}),await this.plugin.saveSettings(),new G.Notice(`Deleted ${ge} file(s) and ${Ne} folder(s).`),this.display()}));let St=t.createDiv({cls:"setting-item"});Object.assign(St.style,{fontSize:"0.85em",color:"var(--text-muted)",marginTop:"2em"}),St.createEl("span",{text:`VVunderlore Toolkit Plugin v${this.plugin.manifest.version} \u2022 `}),St.createEl("a",{text:"View on GitHub",href:"https://github.com/slamwise0001/vvunderlore-toolkit-plugin",attr:{target:"_blank"}}),t.scrollTop=r})()}async updateVersionDisplay(){if(!this.versionValueEl||!this.forceWarningEl)return;let t="";try{let o=await this.plugin.app.vault.adapter.read(".version.json");t=JSON.parse(o).version??""}catch{}let r=(this.plugin.settings.latestToolkitVersion??"").trim(),i=t===r;if(this.versionValueEl.textContent=t||"Not installed",this.versionValueEl.style.color=i?"var(--text-success)":"var(--text-error)",this.forceWarningEl.empty(),t&&r&&t!==r){let o=this.forceWarningEl.createDiv({text:`\u26A0\uFE0F New version available (${t} \u2192 ${r}) \u2014 use regular update instead`});o.style.cssText=`
			font-size: 0.85em;
			color: var(--text-muted);
			font-style: italic;
		  `,o.setAttr("title","Force updating while a new version is available may skip important changes.")}}};var tn=require("crypto"),Ye=class{constructor(n,t,r){this.vault=n,this.cache=t||{},this.save=r}hashContent(n){return(0,tn.createHash)("sha256").update(n).digest("hex")}async isUpToDate(n){let t=this.cache[n];if(!t||!await this.vault.adapter.exists(n))return!1;let i=await this.vault.adapter.read(n);return this.hashContent(i)===t.hash}async updateCache(n,t,r,i=!0){this.cache[n]={hash:this.hashContent(t),githubPath:r},i&&await this.save()}getCache(){return this.cache}getTrackedFiles(){return Object.keys(this.cache)}getGitHubPath(n){return this.cache[n]?.githubPath}resetCache(){this.cache={}}async removeFromCache(n){delete this.cache[n],await this.save()}};var Xe=require("obsidian"),xe=require("path"),sn=require("fs"),pt=class{constructor(n){this.vault=n}async backupVaultMirror(n,t=5){let r=new Date().toISOString().replace(/[:.]/g,"-"),i=n?`-${n}`:"",o=(0,Xe.normalizePath)(`.vault-backups/full/${r}${i}`);console.log(`[BackupManager] Starting mirror backup: ${o}`),await this.ensureFolderExists(o);for(let s of this.vault.getFiles()){if(s.path.startsWith(".vault-backups/")||s.path.startsWith(".obsidian/"))continue;let l=await this.vault.read(s),a=(0,Xe.normalizePath)(`${o}/${s.path}`);await this.ensureFolderExists((0,xe.dirname)(a)),await this.vault.create(a,l)}return console.log("[BackupManager] Mirror backup complete. Pruning old backups..."),await this.pruneFullBackups(o,t),o}async backupVaultToZip(n){return this.backupVaultMirror(n)}async pruneFullBackups(n,t){let r=(0,Xe.normalizePath)(".vault-backups/full");if(await this.ensureFolderExists(r),!await this.vault.adapter.exists(r))return;let i=await this.vault.adapter.list(r),l=[...(Array.isArray(i)?i:"folders"in i?i.folders:[]).map(p=>(0,xe.basename)(p))].sort((p,u)=>u.localeCompare(p)),a=this.vault.adapter,c=a.basePath?(0,xe.join)(a.basePath,r):null;if(c)for(let p=t;p<l.length;p++){let u=l[p],f=(0,Xe.normalizePath)(`${r}/${u}`);if(f===n)continue;let h=(0,xe.join)(c,u);try{await sn.promises.rm(h,{recursive:!0,force:!0})}catch{}let F=this.vault.getAbstractFileByPath(f);F&&await this.vault.delete(F)}}async ensureFolderExists(n){if(!n||await this.vault.adapter.exists(n))return;let t=(0,xe.dirname)(n);await this.ensureFolderExists(t),await this.vault.createFolder(n)}};function ls(e){return ve.find(t=>t.id===e)?.label??e}var Ai="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANEAAADRCAYAAABSOlfvAAAACXBIWXMAABcRAAAXEQHKJvM/AAAL5klEQVR4nO3dT6wdZRnH8V9hyguFYltKSgXxFAhoQqUUQiBGuBgxETG6qUFctBpN3NbEuDCR28T4Jy5AjQkLE0t0oSZGdOXC2INKMBrN3YALGzkQIEqUXrFCX5wWF2dMjM7znN73mZl7zu33k5zNPJl33nvP/fVMnvP2nU3C/6lSOiTpYMfDHq5zXul4TMyBar0nMKdGkpY6HnNbx+NhTpy33hMAFh0hAoIIERBEiIAgQgQE0Z1bu6OSHjVqByUdMmoPVSmt9jGhNnXOdw91rXMdIVq7Z+ucx22FKqUl57x9vcwG647bOSCIEAFBhAgIIkRAECECgujODeewpJJV3LdI2m7UDki6qq1QpXSs4Fq0xgsQouGsWK1xT5VSJWmXUf6HpNNGbWmt10IZbueAIEIEBBEiIIgQAUGECAiiO9ehOudlScsdD/s5lXXarJXmkvQHq1Cl9EbBtcbncmucTyIgiBABQYQICCJEQBAhAoIIERC0ab0nsGiqlJYlPdjxsPdIetyo1XXOrW3nZqX2knHeW5zrfdOpvdOpPWwc3yPp40Ztw7e/+SQCgggREESIgCBCBAQRIiCIEAFBG7rF3WzrW7Rhxxy5u2RvBk+V0nVWrc75uHPeAaskaYtRu0HSZ4zahmh/80kEBBEiIIgQAUGECAgiREDQQuyxUKW0TWUPyRpJGnc6mX46mjdJ2mbU9lUpWeet1DmXPH3vtYJzpOmOq20uknSZUXtV9nswcR6MtlrnXLLt8uAWosUdaFV33kKtUjpP9u/N+32ekWRtAnJM0l0F0+m8/e2pUhoZpd2S7jNqz9Q5f8sYb0n2+7ow7W9u54AgQgQEESIgiBABQYQICJqbFveMNvZIZa1qs0XadJpGBWNukt+Fs2pnnHPe5NRWJFlt7JL2tqqU3uaUTzm1S4zjm525nHTGW1VZ+3tS5zxxxh3U3LS4h2539rThSB/6WMX9baf8nFP7nXH8jKTXjdqJOuffntXE/suMv4cjzb7nc4HbOSCIEAFBhAgIIkRAECECggZvcTtty5HsdqfXqi5d4S3nep6RylrjHq+NnaqUrjZqJyXVbYU651ec63nv+8ipWVsdn9Z0tXYbbx4er/3t/R0N3v4evMXtPM6wqI0dWOFd1CbtqTVutrGrlD4qyQqRGb465yeti1UpPebM5YNObWQcP1Xn/BfnvE7NeA8Gb39zOwcEESIgiBABQYQICCJEQFAvLW6n/Sh138YeOWN6JgXn/Oc863oj2R2s0tXYuyVdY9TOyFglXSV7dxNJO53aE07tduP4S5IG687Nm76+JzJbznXOJW31fc6Yg25oUed8VNLRttqM1uvhwtXY75f9SMk+WLv2SNLfjONjLf6e58W4nQOCCBEQRIiAIEIEBBEiIKiXBajOIlOzO1eltFXTp6q1uUXSI0ZtbrabbVr71lzM38lZsN6nyJiWrzi1zxaMN2k6mmvStOgvN8r7m9dajfvYdnludvuRtFXSrUbt+iEnEvC4pF8YtZ+rbL/td8v+Lwhv1Dn3ESTLctvBWZvMyPhKYIYk6Sqj9vs6558Yc1mWv8p+XDAXF7dzQBAhAoIIERBEiIAgQgQEFXfnmi6I5YhzntWuvUz209ZOSvqSUXvGmcd6sLplR1W+2twac8jOnGci/z1fts5z2t9Z0vNG7ZIqJauTu9uaR1+Kvycq+S6oOc+qLWnaBm7zK0n3GrXTdc7WTjNYZ33ssd4E6BajfJ/sf4x72cSE2zkgiBABQYQICCJEQBAhAoLWYwHqknHc20/bexKb9xhHbEwvSzpu1CaSXjBq+512+9HSPbznKUQj55wzdc65+6lgQb2s6Sb6bZ6V/f3SfkkfMGpjFe4Axe0cEESIgCBCBAQRIiCIEAFBbncusFL7Ruc8a5+BVWfMiTMezj2nnNrTkn5m1O6UdGXXk5nV4jY3fJixUvt+Z0wrROOhHxOIxVTnfEpGkKqUnpb9/NirJL2r6/lwOwcEESIgiBABQYQICCJEQFBfC1CtPbVx7lmRvT/5qErJ2n9hpc75cFuhSumQpIPGeRc2rzZXWJOM6CtEW3saFwumznlVxi5HzSYmSwXDjgrP6wW3c0AQIQKCCBEQRIiAIEIEBPXVnbuzp3EByd/X/Kbm1WafpJuN2kNVSqtG7XCd84o1mb5CtLOncQE1u/JM2mrNHvGXGqeOnGG93aa2efPhdg4IIkRAECECgggREESIgKC+unMnexoXmOWM7C2G/+Scd7NmdOEsfYWo7mlc4GxYj0L9p6SXjJr1wISZuJ0DgggREESIgCBCBAQRIiCor+6ctY0r0Lf9kj5p1DZLusCobS+9YF8hsvr0QN+2S9oz5AW5nQOCCBEQRIiAIEIEBBEiIKiv7twPnRqbmKBPX5f0HaN2uez9P74oaW/JBfkkAoIIERBEiIAgQgQEESIgiBABQX21uH/k1L5gHL+t2QK2zbjO2XpkIeZY8zQ865GS4zrnTR1fcqukK43axyQd6vh6fBIBUYQICCJEQBAhAoIIERBEiIAgt8XttR+ddvSs835glHZLuteoXVCltMuovV7nfMK6HjaeKqVlSQ92POzddc7jkhP5JAKCCBEQRIiAIEIEBBEiIIgQAUF9reI21Tl/onUiKV0t6QHjtGsk/dmojSWxwnsd9bFSu0pJkqzznpL0faO2U9JlRu2K5tUpPomAIEIEBBEiIIgQAUGECAiKdOfG5qDTbk0rZ5FflvScUfuXc72Jc73VOucVay5YG+f3PJL9/pT+/i+QtMOobZN0kVHbIukSZ8zOdb1JhKTyFd6F11qS316l/d2RITeSaVbt32OU75B0u1Hb3bzWilXcwHohREAQIQKCCBEQRIiAoL4WoP7SvGD37ehVlbW/PZM650nBeQtvxu9rbBw337cqpW2S9hVMZbuktxu13ZIuNmqbnTEnzavN6lnNqkVfLW7rB5Skk8bxPtqkS7Lb354jdc7LXc5lUXT99UTgPfCcllRbl5R0vlHr5X3ldg4IIkRAECECgggREESIgKC+WtynndrYOO61o1+V9LxRe73O+a9GzWt/uxahNV6ltE/TFc1dGnc83inZq/PP13TVdZtK06feWawPgBckvWjUrL+hkF5a3CVmtEL/KOkho/ZinfOPO57Lssr2eh60NV6ldEzSUpdj9rDKfo+k1s1pNA3JDUZth6RbCy75NUkPG7XVOufi74Ms3M4BQYQICCJEQBAhAoIIERA0+DbCjlck/dqpXW/UdlQp/b3gel47eqJhW+OlJuq+JW0q/Nl2yd6692LZm5F47e2J7NXYxzVtq7exFq2GzFOL+0JNf+Ftbpf0vY4v2Xk7uqfHIHqKN9co4a3wdmRJ1vd4SdO9s9dqrlbZczsHBBEiIIgQAUGECAgiREDQPLW4a0lWq/opSUeM2lslHTJqL0v6jVWrUrLa5nubV5ux0xGzjvdlUnJS00VsNaPr9V3juLflbyXpUqNm7YUgTX+2R43a2DlvcHPT4i41Y/X3cUnfMGonmlebByR9xKjNVXu1ROlmJFVK7zVK75D01ei8/sfC7KPO7RwQRIiAIEIEBBEiIIgQAUHz1OIuNZHd/t4q6X1G7TXZq31vLJlIldIO2auS75G9wPZoyQYnVUqHNH3UY5tH1jpeM+ayU7a6etYcZpnIbmNPCscc3MKHqPnjW26rNe3vTw84nR2SrjVqn9K0FdxmrLI/moOyNyp5rGA8yV+F/lPjuPUPxyyTRf+6QOJ2DggjREAQIQKCCBEQRIiAoIXvzs0wkd3+luwFuHc1r9aa0wb29iCwVjJL0pYqJav+Htmt8Tc7Y3p7dHv7Vdzv1K4zjl/knDPRBmhjexZ+FXepKqVNsn/+ByV9vmDY482rzW2yW8EflvSkUfuy7P+Wca3sZ5d+yDgu+WHvdF9zLdBq7FLczgFBhAgIIkRAECECgggRELTRW9yzWF2qY07Ns1f2IlOvDXxA0h3OmFaLe7MzpteqLuV9XWCZdD2JeXPOtrj7sA57cQ+q60dRbhTczgFBhAgIIkRAECECgggREHSut7i7Nl7vCWB4/wYRBbn198/rpAAAAABJRU5ErkJggg==",ut=class extends U.Modal{constructor(n){super(n)}onOpen(){this.contentEl.empty();let n=this.contentEl.createEl("img",{attr:{src:Ai,alt:"Installing\u2026"}});Object.assign(n.style,{display:"block",margin:"1em auto 0.5em",width:"100px",height:"100px"}),n.animate([{transform:"rotate(0deg)"},{transform:"rotate(-360deg)"}],{duration:1500,iterations:1/0,easing:"linear"});let t=this.contentEl.createDiv({text:"Installing\u2026",cls:"mod-quiet"});t.style.cssText="font-style: italic; color: var(--text-muted); text-align: center; padding: 1em;"}onClose(){this.contentEl.empty()}},Si={installedVersion:"1.0.0",customizeUpdates:!1,updateTargets:{tools:!0,toolsPath:"Tools",templates:!0,templatesPath:"Extras/Templates",omninomicon:!0,omninomiconPath:"Adventures/Omninomicon.md",spellbook:!0,spellbookPath:"Compendium/Spells/_Spellbook.md"},latestDefaults:void 0,pathOverrides:{},backupFiles:{},backupPath:"",autoBackup:!1,lastBackupTime:"",backupError:"",customPaths:[],autoBackupBeforeUpdate:!0,highlightEnabled:!1,highlightColorLight:"rgb(107, 146, 120)",highlightColorDark:"rgb( 50,  70,  50)",rulesetCompendium:"",rulesetReference:[],reparseGamesets:!0},ft=class extends U.Plugin{constructor(){super(...arguments);this.manifestCache={files:[],folders:[]};this.changelog="";this.autoCheckInterval=null;this.oldPathsByGithub={};this.styleEl=null;this.excludedPaths=[".DS_Store",".gitignore",".gitattributes",".github","README.md","Compendium"];this.isFirstRun=!1;this.pendingRulesetKey="";this.pendingReferenceKeys=[]}resolveVaultPath(t){return this.settings.customPaths.find(i=>i.manifestKey===t||i.manifestKey===this.keyFor(t))?.vaultPath??t}keyFor(t){return t.replace(/[/\\]/g,"-").replace(/\.[^.]+$/,"").toLowerCase()}isExcluded(t){return this.excludedPaths.some(r=>t===r||t.startsWith(`${r}/`)||t.includes(`/${r}/`)||t.endsWith(`/${r}`)||t.includes(`/${r}`))}async performCustomInstall(t){if(this.app.vault.getAllLoadedFiles().filter(s=>s instanceof U.TFile).map(s=>s.path).filter(s=>s!==".vvunderlore_installed").length>0&&this.settings.autoBackupBeforeUpdate){let s=await this.backupManager.backupVaultMirror("pre-custom-install");new U.Notice(`Backup before custom\u2010install created at: ${s}`)}for(let s of t)if(s.isFolder)await this.app.vault.adapter.exists(s.path)||(await this.app.vault.createFolder(s.path),console.log(`Created folder: ${s.path}`));else{let l=this.manifestCache.files.find(a=>a.path===s.path);if(!l){console.warn(`Could not find manifest entry for file: ${s.path}`);continue}await this.updateEntryFromManifest(l,!0)}await this.updateVersionFile(),this.settings.installedVersion=this.settings.latestToolkitVersion??this.settings.installedVersion,this.settings.lastForceUpdate=new Date().toISOString(),await this.saveSettings();let o=".vvunderlore_installed";await this.app.vault.adapter.exists(o)||await this.app.vault.create(o,""),this.settings.highlightEnabled=!0,await this.saveSettings(),this.enableHighlight(),await this.updateVersionFile(),this.settingsTab&&this.settingsTab.display(),new U.Notice("\u2705 Custom install complete \u2026")}get highlightCSS(){let t=this.settings.highlightColorLight.trim()||"rgba(107,146,120,1)",r=this.settings.highlightColorDark.trim()||"rgba( 50, 70, 50,1)",i=this.manifestCache.files.map(l=>`.nav-file-title[data-path="${l.path.replace(/"/g,'\\"')}"]`),o=this.manifestCache.folders.map(l=>`.nav-folder-title[data-path="${l.path.replace(/"/g,'\\"')}"]`),s=[":root {",`  --vvunderlore-toolkit-highlight: ${t};`,"}","","body.theme-dark {",`  --vvunderlore-toolkit-highlight: ${r};`,"}",""];return i.length&&(s.push(`${i.join(", ")} {`),s.push("  background-color: var(--vvunderlore-toolkit-highlight);"),s.push("  border-radius: 3px;"),s.push("}"),s.push("")),o.length&&(s.push(`${o.join(", ")} {`),s.push("  background-color: var(--vvunderlore-toolkit-highlight);"),s.push("  border-radius: 3px;"),s.push("}"),s.push("")),s.join(`
`)}enableHighlight(){this.styleEl||(this.styleEl=document.createElement("style"),this.styleEl.id="vvunderlore-highlight-inject",this.styleEl.textContent=this.highlightCSS,document.head.appendChild(this.styleEl))}disableHighlight(){this.styleEl&&(this.styleEl.remove(),this.styleEl=null)}async fetchRemoteBaseline(){if(console.log("\u{1F501} fetchRemoteBaseline() called"),!this.manifestCache||!Array.isArray(this.manifestCache.files)){console.warn("\u26A0\uFE0F manifestCache is missing or invalid");return}for(let t of this.manifestCache.files)try{let r=`https://raw.githubusercontent.com/slamwise0001/VVunderlore-Toolkit-Full/main/${t.path}`,i=await(await fetch(r)).text(),o=this.resolveVaultPath(t.path);o!==t.path&&await this.fileCacheManager.removeFromCache(t.path),await this.fileCacheManager.updateCache(o,i,t.path,!1)}catch(r){console.error(`Failed to fetch raw baseline for ${t.path}`,r)}console.log("\u{1F4E6} Final cache:",this.fileCacheManager.getCache())}async checkMarkerFile(){let r=await this.app.vault.adapter.exists(".vvunderlore_installed");this.isFirstRun=!r,delete this.settings.needsInstall,await this.saveSettings(),this.settingsTab.display()}async syncManifest(){try{let t=await fetch("https://raw.githubusercontent.com/slamwise0001/VVunderlore-Toolkit-Full/main/manifest.json");if(!t.ok)throw new Error(`Failed to fetch manifest: ${t.statusText}`);let r=await t.json();this.settings.latestDefaults=r.defaultPaths||{},this.manifestCache=r;let i=JSON.stringify(r,null,2);await this.app.vault.adapter.write("manifest.json",i),await this.saveSettings(),console.log("Manifest synced and local manifest updated.")}catch(t){console.error("Error syncing manifest:",t),new U.Notice("Failed to sync manifest.")}}async onload(){await this.loadSettings(),this.backupManager=new pt(this.app.vault),this.fileCacheManager=new Ye(this.app.vault,this.settings.fileCache??{},async()=>await this.saveSettings());let t=console.error.bind(console);console.error=(r,...i)=>{typeof r=="string"&&r.includes("Cannot index file")&&r.includes("Dataview")||t(r,...i)},this.settingsTab=new ct(this.app,this),this.addSettingTab(this.settingsTab);try{let r=await this.app.vault.adapter.read("manifest.json");this.manifestCache=JSON.parse(r),console.log("\u2705 Loaded manifest from vault:",this.manifestCache)}catch{console.warn("Manifest not found in vault; will fetch from GitHub shortly.")}this.settings.highlightEnabled&&this.enableHighlight(),setTimeout(async()=>{await this.syncManifest(),await this.showIndexingModal(),await this.checkForUpdates(),this.oldPathsByGithub=Object.entries(this.fileCacheManager.getCache()).reduce((r,[i,o])=>(r[o.githubPath]=i,r),{}),console.log("\u{1F4E6} Cached Files:",this.fileCacheManager.getCache())},250),this.scheduleAutoUpdateCheck(),this.registerEvent(this.app.vault.on("delete",()=>this.app.commands.executeCommandById("dataview:clear-cache"))),this.registerEvent(this.app.vault.on("rename",()=>this.app.commands.executeCommandById("dataview:clear-cache"))),this.settings.customPaths||(this.settings.customPaths=[]);try{let r=await this.app.vault.adapter.read("manifest.json"),i=JSON.parse(r),o=[...i.folders||[],...i.files||[]];this.requiresGraph=new Map;for(let s of o)this.requiresGraph.set(s.key,s.requires??[])}catch{console.warn("Could not build requiresGraph (manifest.json missing or invalid)."),this.requiresGraph=new Map}if(this.isFirstRun){this.app.workspace.detachLeavesOfType("markdown");let r=this.app.vault.getAbstractFileByPath("Welcome.md");r instanceof U.TFile&&this.app.workspace.getLeaf(!0).openFile(r)}}onunload(){this.disableHighlight(),this.autoCheckInterval&&clearInterval(this.autoCheckInterval)}scheduleAutoUpdateCheck(){this.autoCheckInterval=window.setInterval(()=>{this.checkForUpdates()},60*60*1e3)}async backupFile(t,r){this.settings.backupFiles=this.settings.backupFiles||{},this.settings.backupFiles[t]=r,await this.saveSettings(),console.log(`Backup stored for ${t}`)}async undoForceUpdate(){if(!this.settings.backupFiles||Object.keys(this.settings.backupFiles).length===0){new U.Notice("No backups available to restore.");return}for(let[t,r]of Object.entries(this.settings.backupFiles))await this.app.vault.adapter.exists(t)?(await this.app.vault.adapter.write(t,r),console.log(`Restored ${t}`)):(await this.app.vault.create(t,r),console.log(`Recreated and restored ${t}`));new U.Notice("\u2705 Force update undone."),this.settings.backupFiles={},await this.saveSettings()}async syncMissingFolders(){if(this.manifestCache&&this.manifestCache.folders)for(let t of this.manifestCache.folders){let r=t.path;await this.app.vault.adapter.exists(r)||(await this.app.vault.createFolder(r),console.log(`\u{1F4C1} Created missing folder: ${r}`))}}async buildForceUpdatePreview(){let t=[],r=this.settings.customPaths.filter(i=>i.doUpdate===!1).map(i=>i.manifestKey);for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(l=>l.manifestKey===i.key),s=r.some(l=>i.path.startsWith(l+"/"));if(o?.doUpdate===!1||s){let l=o?.vaultPath??this.resolveVaultPath(i.path),a=await this.app.vault.adapter.exists(l),c=a&&await this.fileCacheManager.isUpToDate(l);(!a||!c)&&t.push({filePath:l,action:"deny-listed \u2013 will not update",selected:!1})}}if(!this.settings.customizeUpdates){for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(p=>p.manifestKey===i.key),s=r.some(p=>i.path.startsWith(p+"/"));if(o?.doUpdate===!1||s)continue;let l=this.resolveVaultPath(i.path),a="";l!==i.path&&(a=" (remapped)"),await this.app.vault.adapter.exists(l)?await this.fileCacheManager.isUpToDate(l)||t.push({filePath:l,action:`will be overwritten${a}`,selected:!0}):t.push({filePath:l,action:`new file${a}`,selected:!0})}for(let i of this.manifestCache.folders){if(i.optional)continue;let o=r.includes(i.path);!await this.app.vault.adapter.exists(i.path)&&!o&&t.push({filePath:i.path,action:"missing folder (will be created)",selected:!0,isFolder:!0})}return t}for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(u=>u.manifestKey===i.key),s=r.some(u=>i.path.startsWith(u+"/"));if(o?.doUpdate===!1||s)continue;let l=o?.vaultPath??this.resolveVaultPath(i.path),a=await this.app.vault.adapter.exists(l),c=a&&await this.fileCacheManager.isUpToDate(l),p="";l!==i.path&&(p=" (remapped)"),a?c||t.push({filePath:l,action:`will be overwritten${p}`,selected:!0}):t.push({filePath:l,action:`new file${p}`,selected:!0})}for(let i of this.manifestCache.folders){if(i.optional)continue;let o=r.includes(i.path);!await this.app.vault.adapter.exists(i.path)&&!o&&t.push({filePath:i.path,action:"missing folder (will be created)",selected:!0,isFolder:!0})}for(let i of this.manifestCache.files){if(i.optional)continue;let o=i.key,s=i.path,l=this.settings.customPaths.find(p=>p.manifestKey===o),a=this.oldPathsByGithub[s],c=r.some(p=>s.startsWith(p+"/"));l?.doUpdate===!1||c||l&&l.vaultPath&&l.vaultPath!==s||a&&a!==s&&(!l||l.vaultPath===s)&&t.push({filePath:a,action:`moved \u2192 ${s}`,selected:!0})}return t}async forceUpdatePreviewAndConfirm(){let t=await this.buildForceUpdatePreview(),r=[],i=[];for(let s of t)s.action.startsWith("deny-listed")?r.push(s):i.push(s);let o=new class extends U.Modal{constructor(s,l,a){super(s),this.normal=l,this.denied=a}onOpen(){if(this.contentEl.addEventListener("click",c=>c.stopPropagation()),this.contentEl.empty(),this.titleEl.setText("Force Update Preview"),this.contentEl.createEl("p",{text:'The following items will be updated. Uncheck any items you do NOT want to change, then click "Confirm and Update".'}),this.normal.length){let c=this.contentEl.createEl("div");Object.assign(c.style,{maxHeight:"300px",overflowY:"auto",marginTop:"1em"}),this.normal.forEach(p=>{let u=c.createDiv();Object.assign(u.style,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",padding:"6px 0",fontFamily:"monospace"});let f=u.createDiv();f.style.flexGrow="1",f.style.display="flex",f.style.flexDirection="column";let h=f.createDiv();h.textContent=p.filePath;let F=f.createDiv({text:p.action});F.style.fontSize="13px",F.style.color="var(--text-muted)",F.style.fontStyle="italic";let M=u.createEl("input",{type:"checkbox"});M.checked=p.selected,M.onchange=()=>{p.selected=M.checked}})}else{let c=this.contentEl.createEl("div");Object.assign(c.style,{display:"inline-block",fontFamily:"monospace",fontStyle:"italic",marginTop:"0.5em"}),c.textContent="No force-update candidates."}if(this.denied.length){let c=this.contentEl.createEl("details",{cls:"vk-section"});c.open=!1;let p=c.createEl("summary",{cls:"vk-section-header"});Object.assign(p.style,{cursor:"pointer",display:"flex",color:"var(--text-faint)",alignItems:"center",gap:"0.5em",marginTop:"1em"}),p.createEl("span",{text:`Deny-List Files (${this.denied.length})`});let u=p.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(u.style,{fontWeight:"bold",display:"inline-block",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:"rotate(180deg)"}),c.ontoggle=()=>{u.style.transform=c.open?"rotate(0deg)":"rotate(180deg)"};let f=c.createDiv({cls:"vk-section-body"});f.style.paddingLeft="1em",this.denied.forEach(h=>{let F=f.createDiv();Object.assign(F.style,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",padding:"6px 0",fontFamily:"monospace",color:"var(--text-faint)",fontStyle:"italic"});let M=F.createDiv();M.textContent=h.filePath,M.style.textDecoration="line-through";let d=F.createDiv({text:h.action});d.style.fontSize="13px",d.style.color="var(--text-faint)",d.style.fontStyle="italic";let A=F.createEl("input",{type:"checkbox"});A.checked=h.selected,A.disabled=!0,A.title="This item is deny-listed"})}this.plugin.settings.reparseGamesets&&this.contentEl.createDiv({cls:"mod-aux-text"}).setText("\u{1F504} Refreshing Gameset Data");let s=this.contentEl.createEl("div");Object.assign(s.style,{display:"flex",justifyContent:"flex-end",gap:"0.5em",marginTop:"1.5em"});let l=s.createEl("button",{text:"Cancel"});l.onclick=()=>this.close();let a=s.createEl("button",{text:"Confirm and Update",cls:"mod-cta"});a.onclick=async()=>{this.close(),await this.plugin.performForceUpdateWithSelection([...this.normal,...this.denied])}}onClose(){this.contentEl.empty()}}(this.app,i,r);o.plugin=this,o.open()}async updateEntryFromManifest(t,r=!1){let i=this.settings.customPaths.find(l=>l.manifestKey===t.key);if(i?.doUpdate===!1){console.log(`\u23ED\uFE0F Skipping ${t.key} (${t.displayName}) \u2014 blacklisted`);return}let o=i?.vaultPath??this.resolveVaultPath(t.path);if(!r&&await this.fileCacheManager.isUpToDate(o)){console.log(`\u2714\uFE0F Already up to date: ${t.displayName}`);return}let s=`https://raw.githubusercontent.com/slamwise0001/vvunderlore-toolkit-full/main/${t.path}`;try{let a=await(await fetch(s)).text();await this.app.vault.adapter.write(o,a),await this.fileCacheManager.updateCache(o,a,t.path),console.log(`\u2705 Updated ${t.displayName} \u2192 ${o}`)}catch(l){console.error(`\u274C Error updating ${t.displayName}:`,l)}}async performForceUpdateWithSelection(t){this.settings.autoBackupBeforeUpdate,this.settings.backupFiles={},await this.saveSettings();try{let r=t.filter(i=>i.selected&&!i.isFolder&&!this.settings.customPaths.some(o=>o.vaultPath===i.filePath&&o.doUpdate===!1));for(let i of r){let o=this.manifestCache.files.find(s=>this.resolveVaultPath(s.path)===i.filePath);if(!o){console.warn(`\u26A0\uFE0F Could not match preview item to manifest: ${i.filePath}`);continue}await this.updateEntryFromManifest(o,!0)}for(let i of this.manifestCache.folders)await this.app.vault.adapter.exists(i.path)||await this.app.vault.createFolder(i.path);await this.updateVersionFile(),this.settings.installedVersion=this.settings.latestToolkitVersion??"unknown",this.settings.lastForceUpdate=new Date().toISOString(),await this.saveSettings(),new U.Notice("\u2705 Toolkit force\u2010updated with your selections."),this.settings.reparseGamesets&&(new U.Notice("\u{1F504} Refreshing Game Set Data\u2026"),await this.refreshGameSetData()),this.settingsTab&&await this.settingsTab.updateVersionDisplay()}catch(r){console.error("\u274C Force update failed. Version not changed.",r),new U.Notice("\u274C One or more files failed. Version NOT updated.")}this.settings.highlightEnabled&&this.enableHighlight()}async updateSingleFileFromGitHub({githubPath:t,vaultPath:r},i=!1){if(this.settings.customizeUpdates){if(r=this.resolveVaultPath(t),this.settings.customPaths.find(c=>c.manifestKey===t)?.doUpdate===!1)return}else r=t;if(!r){console.error(`\u274C No valid vault path resolved for ${t}`);return}let o=this.oldPathsByGithub[t];if(o&&o!==r){if(await this.app.vault.adapter.exists(r)){let c=await this.app.vault.adapter.read(r);await this.backupFile(r,c),await this.app.vault.adapter.remove(r)}let a=this.app.vault.getAbstractFileByPath(o);if(a instanceof U.TFile){await this.app.vault.rename(a,r);let c=await this.app.vault.adapter.read(r);await this.fileCacheManager.updateCache(r,c,t);return}}let s=await this.app.vault.adapter.exists(r);if(i&&s){let a=await this.app.vault.adapter.read(r);await this.backupFile(r,a)}if(!i&&s&&await this.fileCacheManager.isUpToDate(r))return;let l=encodeURI(`https://api.github.com/repos/slamwise0001/VVunderlore-Toolkit-Full/contents/${t}?ref=main`);try{let a=await fetch(l);if(a.status===404){let u=encodeURI(`https://raw.githubusercontent.com/slamwise0001/VVunderlore-Toolkit-Full/main/${t}`);if(a=await fetch(u),!a.ok)throw new Error(`Raw fetch failed: ${a.statusText}`);let f=await a.text();s?await this.app.vault.adapter.write(r,f):await this.app.vault.create(r,f),await this.fileCacheManager.updateCache(r,f,t);return}if(!a.ok)throw new Error(`GitHub API error: ${a.statusText}`);let{download_url:c}=await a.json(),p=await(await fetch(c)).text();s?await this.app.vault.adapter.write(r,p):await this.app.vault.create(r,p),await this.fileCacheManager.updateCache(r,p,t)}catch(a){console.error(`\u274C Failed to update ${r}`,a)}}async previewUpdatesModal(){let t=new class extends U.Modal{constructor(l){super(l)}onOpen(){this.contentEl.empty(),this.contentEl.createDiv({text:"\u{1F504} Checking for updates\u2026",cls:"mod-warning"}).addEventListener("click",l=>l.stopPropagation())}}(this.app);t.open(),await this.syncManifest(),await this.fetchRemoteBaseline();let r=await this.buildUpdatePreview();t.close();let i=[],o=[];for(let l of r)l.startsWith("\u274C deny\u2010listed")?i.push(l):o.push(l);let s=new class extends U.Modal{constructor(l,a,c){super(l),this.normal=a,this.denied=c}onOpen(){if(this.contentEl.empty(),this.titleEl.setText("Update Preview"),this.contentEl.createEl("p",{text:"Only files whose contents differ from GitHub will be updated:"}),this.normal.length){let p=this.contentEl.createEl("ul");this.normal.forEach(u=>{let f=p.createEl("li",{text:u})})}else this.contentEl.createEl("div",{text:"\u2705 Everything is already up to date!",cls:"mod-info"});if(this.denied.length){let p=this.contentEl.createEl("details",{cls:"vk-section"});p.open=!1;let u=p.createEl("summary",{cls:"vk-section-header"});Object.assign(u.style,{cursor:"pointer",display:"flex",color:"var(--text-faint)",alignItems:"center",gap:"0.5em"}),u.createEl("span",{text:`Deny\u2010List Files (${this.denied.length})`});let f=u.createEl("span",{text:"VV",cls:"vk-toggle-icon"});Object.assign(f.style,{fontWeight:"bold",display:"inline-block",transition:"transform 0.2s ease",transformOrigin:"50% 50%",userSelect:"none",transform:"rotate(180deg)"}),p.ontoggle=()=>{f.style.transform=p.open?"rotate(0deg)":"rotate(180deg)"};let h=p.createDiv({cls:"vk-section-body"});h.style.paddingLeft="1em";let F=h.createEl("ul");this.denied.forEach(M=>{let d=F.createEl("li",{text:M});d.style.color="var(--text-faint)",d.style.fontStyle="italic"})}let l=this.contentEl.createEl("div");Object.assign(l.style,{display:"flex",justifyContent:"flex-end",marginTop:"1.25em"});let a=l.createEl("button",{text:"Confirm & Update",cls:"mod-cta"});a.onclick=async()=>{await this.plugin.updateSelectedToolkitContent(),this.close()};let c=l.createEl("button",{text:"Cancel"});c.onclick=()=>this.close()}onClose(){this.contentEl.empty()}}(this.app,o,i);s.plugin=this,s.open()}async buildUpdatePreview(){let t=[],r=this.settings.customPaths.filter(i=>i.doUpdate===!1).map(i=>i.manifestKey);for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(l=>l.manifestKey===i.path),s=r.some(l=>i.path.startsWith(l+"/"));if(o?.doUpdate===!1||s){let l=o?.vaultPath??this.resolveVaultPath(i.path),a=await this.app.vault.adapter.exists(l),c=a&&await this.fileCacheManager.isUpToDate(l);(!a||!c)&&t.push(`\u274C deny\u2010listed \u2013 will not update: ${l}`)}}if(!this.settings.customizeUpdates){for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(u=>u.manifestKey===i.path),s=r.some(u=>i.path.startsWith(u+"/"));if(o?.doUpdate===!1||s)continue;let l=this.resolveVaultPath(i.path),a="";l!==i.path&&(a=" (remapped)");let c=await this.app.vault.adapter.exists(l),p=c&&await this.fileCacheManager.isUpToDate(l);c?p||t.push(`\u{1F501} Will update: ${l}${a}`):t.push(`\u{1F4C4} New file: ${l}${a}`)}for(let i of this.manifestCache.folders){if(i.optional)continue;let o=r.includes(i.path);!await this.app.vault.adapter.exists(i.path)&&!o&&t.push(`\u{1F4C1} New folder: ${i.path}`)}return t.length?t:["\u2705 Everything is already up to date!"]}for(let i of this.manifestCache.files){if(i.optional)continue;let o=this.settings.customPaths.find(u=>u.manifestKey===i.path),s=r.some(u=>i.path.startsWith(u+"/"));if(o?.doUpdate===!1||s)continue;let l=o?.vaultPath??this.resolveVaultPath(i.path),a="";l!==i.path&&(a=" (remapped)");let c=await this.app.vault.adapter.exists(l),p=c&&await this.fileCacheManager.isUpToDate(l);c?p||t.push(`\u{1F501} Will update: ${l}${a}`):t.push(`\u{1F4C4} New file: ${l}${a}`)}for(let i of this.manifestCache.folders){if(i.optional)continue;let o=r.includes(i.path);!await this.app.vault.adapter.exists(i.path)&&!o&&t.push(`\u{1F4C1} New folder: ${i.path}`)}for(let i of this.manifestCache.files){if(i.optional)continue;let o=i.key,s=i.path,l=this.settings.customPaths.find(p=>p.manifestKey===o),a=this.oldPathsByGithub[s],c=r.some(p=>s.startsWith(p+"/"));l?.doUpdate===!1||c||l&&l.vaultPath&&l.vaultPath!==s||a&&a!==s&&(!l||l.vaultPath===s)&&t.push(`\u27A1\uFE0F Moved: ${a} \u2192 ${s}`)}return t.length?t:["\u2705 Everything is already up to date!"]}async checkForUpdates(){let t=(u,f)=>{let h=u.replace(/^v/,"").split(".").map(M=>parseInt(M,10)||0),F=f.replace(/^v/,"").split(".").map(M=>parseInt(M,10)||0);for(let M=0;M<Math.max(h.length,F.length);M++){if((h[M]||0)>(F[M]||0))return!0;if((h[M]||0)<(F[M]||0))return!1}return!1},r=".version.json",i="https://raw.githubusercontent.com/slamwise0001/vvunderlore-toolkit-full/main/.version.json",o="https://raw.githubusercontent.com/slamwise0001/vvunderlore-toolkit-plugin/main/version.json",s="https://raw.githubusercontent.com/slamwise0001/VVunderlore-Toolkit-Full/main/README.md",l="0.0.0";try{let u=await this.app.vault.adapter.read(r);l=JSON.parse(u).version||l}catch(u){console.error("\u274C Failed to read local toolkit version:",u)}let a="0.0.0";try{let f=await(await fetch(i)).json();a=f.version||a,this.settings.latestToolkitVersion=a,f.defaultPaths&&(this.settings.latestDefaults=f.defaultPaths),this.settings.lastChecked=new Date().toISOString(),await this.saveSettings()}catch(u){console.error("\u274C Failed to fetch remote toolkit version:",u)}console.log({localTK:l,remoteTK:a}),t(a,l)?(new U.Notice(`\u26A0\uFE0F Toolkit update available! Installed: v${l}, Latest: v${a}`),await this.fetchRemoteBaseline()):new U.Notice(`\u2705 Toolkit is up to date (v${l})`);let c=this.manifest.version,p=c;try{p=(await(await fetch(o)).json()).version||p}catch(u){console.error("\u274C Failed to fetch remote plugin version:",u)}console.log({localPL:c,remotePL:p}),t(p,c)?new U.Notice(`\u2699\uFE0F Plugin update available! Installed: v${c}, Latest: v${p}`):new U.Notice(`\u2705 Plugin is up to date (v${c})`);try{let u=await fetch(s);this.changelog=await u.text()}catch(u){console.error("\u274C Failed to fetch changelog:",u)}}async loadSettings(){let r=await this.loadData()??{};r.needsInstall!=null&&delete r.needsInstall,this.settings=Object.assign({},Si,r),this.isFirstRun=!await this.app.vault.adapter.exists(".vvunderlore_installed"),this.fileCacheManager=new Ye(this.app.vault,r.fileCache??{},async()=>await this.saveSettings()),await this.saveSettings(),typeof this.settings.rulesetCompendium!="string"&&(this.settings.rulesetCompendium=""),Array.isArray(this.settings.rulesetReference)||(this.settings.rulesetReference=[])}async saveSettings(){await this.saveData({...this.settings,fileCache:this.fileCacheManager.getCache()})}async getLocalToolkitVersion(){try{let t=await this.app.vault.adapter.read(".version.json");return JSON.parse(t).version||null}catch(t){return console.error("\u274C Failed to read .version.json:",t),null}}async updateFullToolkitRepo(){let t=[".obsidian",".gitignore",".gitattributes",".DS_Store","plugins","Compendium","README.md",".version.json",".github"],r=async()=>{let o=await fetch("https://api.github.com/repos/slamwise0001/VVunderlore-Toolkit-Full/contents/");if(!o.ok)throw new Error("Failed to fetch repo root");return await o.json()};try{let o=(await r()).filter(l=>!t.some(a=>l.path===a||l.path.startsWith(`${a}/`)));o.sort((l,a)=>l.type===a.type?0:l.type==="tree"?-1:1);for(let l of o)if(l.type==="dir"&&await this.updateFolderFromGitHub(l.path,l.path),l.type==="file"){let c=await(await fetch(l.download_url)).text(),p=l.path;await this.app.vault.adapter.exists(p)?await this.app.vault.adapter.read(p)!==c&&await this.app.vault.adapter.write(p,c):await this.app.vault.create(p,c),await this.fileCacheManager.updateCache(p,c,l.path,!1)}await this.saveSettings();let s=".vvunderlore_installed";await this.app.vault.adapter.exists(s)||await this.app.vault.create(s,""),this.settings.highlightEnabled&&this.enableHighlight(),new U.Notice("\u2705 VVunderlore Toolkit successfully installed!")}catch(i){console.error("\u274C updateFullToolkitRepo() error:",i),new U.Notice("\u274C Failed to install toolkit. See console for details.")}}async updateSelectedToolkitContent(){if(this.settings.autoBackupBeforeUpdate){let i=await this.backupManager.backupVaultMirror("pre-update");new U.Notice(`Vault mirror backup created at: ${i}`)}if(!this.settings.latestDefaults){new U.Notice("\u274C GitHub defaults not loaded yet.");return}let t=this.manifestCache.files.map(i=>i.path),r=Object.fromEntries(this.settings.customPaths.map(i=>[i.manifestKey,i]));try{for(let i of t){if(r[i]?.doUpdate===!1){console.log(`\u23ED\uFE0F Skipping deny-listed: ${i}`);continue}let s=this.settings.customizeUpdates?this.resolveVaultPath(i):i,l=this.manifestCache.files.find(a=>a.path===i);l&&await this.updateEntryFromManifest(l,!1)}for(let i of this.manifestCache.folders)await this.app.vault.adapter.exists(i.path)||await this.app.vault.createFolder(i.path);await this.updateVersionFile(),this.settings.installedVersion=this.settings.latestToolkitVersion,await this.saveSettings(),new U.Notice("\u2705 Toolkit content updated."),this.settingsTab&&await this.settingsTab.updateVersionDisplay()}catch(i){console.error("\u274C Update failed. Version not updated.",i),new U.Notice("\u274C Update failed. See console for details. Version file NOT changed.")}this.settings.highlightEnabled&&this.enableHighlight()}async updateFolderFromGitHub(t,r){let i=[".obsidian",".gitignore",".gitattributes",".DS_Store","plugins","Compendium","README.md",".version.json",".github"];if(i.some(s=>t===s||t.startsWith(`${s}/`)))return;let o=`https://api.github.com/repos/slamwise0001/VVunderlore-Toolkit-Full/contents/${t}`;try{let s=await fetch(o);if(!s.ok)throw new Error(`Failed to fetch folder: ${t}`);let l=await s.json();await this.app.vault.adapter.exists(r)||await this.app.vault.createFolder(r);for(let a of l){if(i.some(p=>a.path===p||a.path.startsWith(`${p}/`)))continue;let c=`${r}/${a.name}`;if(a.type==="file"){let u=await(await fetch(a.download_url)).text(),f=await this.app.vault.adapter.exists(c);if(f){let h=await this.app.vault.adapter.read(c);h!==u&&await this.backupFile(c,h)}f?await this.app.vault.adapter.read(c)!==u&&await this.app.vault.adapter.write(c,u):await this.app.vault.create(c,u),await this.fileCacheManager.updateCache(c,u,a.path,!1)}else a.type==="dir"&&await this.updateFolderFromGitHub(a.path,`${r}/${a.name}`)}await this.saveSettings(),new U.Notice(`\u2705 Folder synced: ${r}`)}catch(s){console.error(`\u274C Failed to sync folder: ${r}`,s),new U.Notice(`\u274C Failed to update folder: ${r}`)}}async rebuildFileCache(){let t=this.fileCacheManager,r=[];for(let o of this.manifestCache.files){let s=this.resolveVaultPath(o.path);await this.app.vault.adapter.exists(s)&&r.push((async()=>{let l=await this.app.vault.adapter.read(s);await t.updateCache(s,l,o.path,!1)})())}for(let o of this.manifestCache.folders){let s=o.path,l=this.app.vault.getAbstractFileByPath(s);l instanceof U.TFolder&&U.Vault.recurseChildren(l,a=>{if(a instanceof U.TFile&&a.extension==="md"){let c=a.path;r.push((async()=>{let p=await this.app.vault.adapter.read(c);await t.updateCache(c,p,c,!1)})())}})}let i=10;for(let o=0;o<r.length;o+=i)await Promise.all(r.slice(o,o+i));await this.saveSettings()}async showIndexingModal(){let t=new class extends U.Modal{constructor(r){super(r)}onOpen(){this.contentEl.addEventListener("click",r=>r.stopPropagation()),this.titleEl.setText("\u{1F504} Indexing Toolkit Files..."),this.contentEl.createEl("p",{text:"Indexing and caching your VVunderlore Vault for faster updates and safer syncing."})}}(this.app);t.open(),await this.rebuildFileCache(),t.close(),new U.Notice("\u2705 VVunderlore caching complete.")}async updateVersionFile(){if(!this.settings.latestToolkitVersion){console.warn("No latest version found; skipping version file update.");return}let t=".version.json",r=JSON.stringify({version:this.settings.latestToolkitVersion},null,2);await this.app.vault.adapter.exists(t)?await this.app.vault.adapter.write(t,r):await this.app.vault.create(t,r)}async installFullToolkit(t={compendium:"",references:[]}){let{compendium:r,references:i}=t;if(!r)throw new Error("No compendium edition selected");let o=new ut(this.app);o.open();let s=!1;try{let a=await fetch("https://api.github.com/repos/slamwise0001/VVunderlore-Toolkit-Full/git/trees/main?recursive=1");if(!a.ok)throw new Error(`Failed to list repo tree: ${a.statusText}`);let c=await a.json(),u=(Array.isArray(c.tree)?c.tree:[]).filter(d=>!this.excludedPaths.some(A=>d.path===A||d.path.startsWith(`${A}/`))).sort((d,A)=>d.type===A.type?0:d.type==="tree"?-1:1);for(let d of u)if(d.type==="tree")await this.app.vault.adapter.exists(d.path)||await this.app.vault.createFolder(d.path);else{let A=`https://raw.githubusercontent.com/slamwise0001/VVunderlore-Toolkit-Full/main/${encodeURIComponent(d.path)}`,k=await fetch(A);if(!k.ok)continue;let _=await k.text();await this.app.vault.adapter.exists(d.path)?await this.app.vault.adapter.read(d.path)!==_&&await this.app.vault.adapter.write(d.path,_):await this.app.vault.create(d.path,_)}this.settings.rulesetCompendium=r;let f=i.length>0?i:this.settings.rulesetReference;this.settings.rulesetReference=f,await this.saveSettings();let h=[$e({app:this.app,editionKey:r,targetPath:"Compendium"}),...f.map(d=>{let A=ls(d);return $e({app:this.app,editionKey:d,targetPath:`Resources/Rulesets/${A}`})})];await Promise.all(h);let F=[$e({app:this.app,editionKey:r,targetPath:"Compendium"}),...i.map(d=>{let A=ls(d);return $e({app:this.app,editionKey:d,targetPath:`Resources/Rulesets/${A}`})})];await Promise.all(F);let M=".vvunderlore_installed";await this.app.vault.adapter.exists(M)||await this.app.vault.create(M,""),this.settings.highlightEnabled=!0,await this.saveSettings(),this.enableHighlight(),s=!0}catch(l){console.error("\u274C installFullToolkit()",l)}finally{o.close(),this.settingsTab&&this.settingsTab.display(),new U.Notice(s?"\u2705 VVunderlore Toolkit successfully installed!":"\u274C Failed to install toolkit. See console for details.")}}async refreshGameSetData(){let{rulesetCompendium:t,rulesetReference:r}=this.settings;if(!t&&r.length===0){new U.Notice("\u26A0\uFE0F No gameset keys set; nothing to refresh.");return}let i=[];t&&i.push($e({app:this.app,editionKey:t,targetPath:"Compendium"}));for(let o of r){let s=ls(o);i.push($e({app:this.app,editionKey:o,targetPath:`Resources/Rulesets/${s}`}))}await Promise.all(i),new U.Notice("\u2705 Game Set Data refreshed.")}};0&&(module.exports={InstallingModal});
